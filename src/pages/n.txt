THemeEdiotr.jsx:
import { useThemeStore } from "../store/store";
import SectionLibrary from "../components/ui/theme/SectionLibrary";
import Canvas from "../components/ui/theme/Canvas";
import PropertiesPanel from "../components/ui/theme/PropertiesPanel";
import EditorHeader from "../components/ui/theme/EditorHeader";
import TemplateModal from "../components/ui/modals/theme/TemplateModal";
import SettingsModal from "../components/ui/modals/theme/SettingsModal";
import SkeletonLoader from "../components/ui/theme/SkeletonLoader";

export default function ThemeEditor() {
  const { useThemeEditor } = useThemeStore();

  const {
    theme,
    config,
    saving,
    loading,
    isLoading,
    isDirty,
    selectedTemplate,
    showSettings,
    showTemplateModal,
    canUndo,
    canRedo,
    templates,
    setShowSettings,
    setShowTemplateModal,
    handleSave,
    handleAddSection,
    handlePreview,
    handleClose,
    applyTemplate,
    handleThemeChange,
    undo,
    redo,
  } = useThemeEditor();

  if (isLoading || loading || !theme) {
    return <SkeletonLoader />;
  }

  return (
    <div className="h-screen flex flex-col bg-gray-50">
      <EditorHeader
        theme={theme}
        isDirty={isDirty}
        saving={saving}
        canUndo={canUndo}
        canRedo={canRedo}
        onClose={handleClose}
        onUndo={undo}
        onRedo={redo}
        onPreview={handlePreview}
        onSave={handleSave}
        onOpenTemplateModal={() => setShowTemplateModal(true)}
        onToggleSettings={() => setShowSettings(!showSettings)}
      />

      <div className="flex-1 flex overflow-hidden">
        <div className="w-64 flex-shrink-0">
          <SectionLibrary onAddSection={handleAddSection} />
        </div>

        <div className="flex-1 overflow-hidden">
          <Canvas selectedTemplate={selectedTemplate} />
        </div>

        <div className="w-80 flex-shrink-0">
          <PropertiesPanel />
        </div>
      </div>

      <TemplateModal
        isOpen={showTemplateModal}
        onClose={() => setShowTemplateModal(false)}
        onApplyTemplate={applyTemplate}
        selectedTemplate={selectedTemplate}
        templates={templates}
        currentSectionsCount={config.layout?.sections?.length}
      />

      <SettingsModal
        isOpen={showSettings}
        onClose={() => setShowSettings(false)}
        theme={theme}
        onThemeChange={handleThemeChange}
        config={config}
        onSave={handleSave}
        originalSlug={theme?.slug}
      />
    </div>
  );
}

SettingsModal.jsx:
import React, { useState } from "react";
import { X, Palette, Settings, Loader, Eye, EyeOff, Plus, Trash2, AlertCircle } from "lucide-react";
import { useEditorStore } from "../../../../store/store";
import FilePickerModal from "../FilePickerModal";
import { useWebsiteStore } from "../../../../store/store";

const INPUT_CLS = "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500";

export default function SettingsModal({ isOpen, onClose, theme, onThemeChange, config, onSave }) {
  const [isSaving, setIsSaving] = useState(false);
  const [activeTab, setActiveTab] = useState("theme");
  const [showFilePicker, setShowFilePicker] = useState(false);
  const [showEnvValues, setShowEnvValues] = useState({});
  const { selectedWebsite } = useWebsiteStore();
  const { updateConfig } = useEditorStore();

  if (!isOpen) return null;

  const loader = config.siteSettings?.loader || {};
  const envVars = config.siteSettings?.envVars || [];

  const updateLoader = (key, value) => updateConfig("siteSettings.loader", { ...loader, [key]: value });

  const addEnvVar = () => updateConfig("siteSettings.envVars", [...envVars, { id: Date.now().toString(), key: "MY_VARIABLE", value: "", description: "" }]);

  const updateEnvVar = (idx, field, value) => {
    const arr = [...envVars];
    arr[idx] = { ...arr[idx], [field]: value };
    updateConfig("siteSettings.envVars", arr);
  };

  const removeEnvVar = (idx) => {
    const arr = [...envVars];
    arr.splice(idx, 1);
    updateConfig("siteSettings.envVars", arr);
  };

  const handleLoaderFileSelect = (file) => {
    updateLoader("image", file.file_path);
    setShowFilePicker(false);
  };

  const handleSaveAndClose = async () => {
    setIsSaving(true);
    try {
      await onSave();
      onClose();
    } catch (error) {
      console.error("Failed to save theme:", error);
      alert("Failed to save theme. Please try again.");
    } finally {
      setIsSaving(false);
    }
  };

  const TABS = [
    { id: "theme", label: "Theme", icon: Palette },
    { id: "loader", label: "Loader", icon: Loader },
    { id: "env", label: "Variables", icon: Settings },
  ];

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col shadow-2xl">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <div>
            <h2 className="text-xl font-semibold text-gray-900">Theme Settings</h2>
            <p className="text-sm text-gray-500 mt-0.5">Configure colors, loader, and site variables</p>
          </div>
          <button onClick={onClose} disabled={isSaving} className="p-2 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50">
            <X className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        <div className="flex border-b border-gray-200 px-6">
          {TABS.map((tab) => {
            const Icon = tab.icon;
            return (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors -mb-px ${activeTab === tab.id ? "border-indigo-500 text-indigo-600" : "border-transparent text-gray-500 hover:text-gray-700"}`}
              >
                <Icon className="w-4 h-4" />
                {tab.label}
              </button>
            );
          })}
        </div>

        <div className="flex-1 overflow-y-auto p-6">
          {activeTab === "theme" && (
            <div className="space-y-6">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Theme Name</label>
                <input
                  type="text"
                  value={theme.name}
                  onChange={(e) => onThemeChange({ ...theme, name: e.target.value })}
                  disabled={isSaving}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
                />
              </div>

              <div className="pt-4 border-t border-gray-200">
                <h3 className="text-sm font-semibold text-gray-900 mb-4">Theme Colors</h3>
                <p className="text-xs text-gray-500 mb-4">These are global defaults. Individual sections can override colors in their Properties panel.</p>
                <div className="grid grid-cols-2 gap-4">
                  {[
                    { key: "primary", label: "Primary Color" },
                    { key: "secondary", label: "Secondary Color" },
                    { key: "accent", label: "Accent Color" },
                    { key: "background", label: "Background Color" },
                    { key: "text", label: "Text Color" },
                  ].map(({ key, label }) => (
                    <div key={key}>
                      <label className="block text-sm text-gray-700 mb-2">{label}</label>
                      <div className="flex gap-2">
                        <input
                          type="color"
                          value={config.theme?.colors?.[key] || "#6366f1"}
                          onChange={(e) => useEditorStore.getState().updateConfig(`theme.colors.${key}`, e.target.value)}
                          disabled={isSaving}
                          className="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer disabled:opacity-50"
                        />
                        <input
                          type="text"
                          value={config.theme?.colors?.[key] || ""}
                          onChange={(e) => useEditorStore.getState().updateConfig(`theme.colors.${key}`, e.target.value)}
                          disabled={isSaving}
                          className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm disabled:bg-gray-100"
                        />
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <div className="pt-4 border-t border-gray-200">
                <h3 className="text-sm font-semibold text-gray-900 mb-4">Typography</h3>
                <div className="grid grid-cols-2 gap-4">
                  {[
                    { key: "heading", label: "Heading Font" },
                    { key: "body", label: "Body Font" },
                  ].map(({ key, label }) => (
                    <div key={key}>
                      <label className="block text-sm text-gray-700 mb-2">{label}</label>
                      <select
                        value={config.theme?.fonts?.[key] || "Inter"}
                        onChange={(e) => useEditorStore.getState().updateConfig(`theme.fonts.${key}`, e.target.value)}
                        disabled={isSaving}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm disabled:bg-gray-100"
                      >
                        {["Inter", "Roboto", "Open Sans", "Lato", "Montserrat", "Poppins", "Raleway", "Nunito", "Playfair Display", "Merriweather", "Georgia", "system-ui"].map((f) => (
                          <option key={f} value={f}>{f}</option>
                        ))}
                      </select>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {activeTab === "loader" && (
            <div className="space-y-5">
              <div className="flex items-center gap-3 p-4 bg-indigo-50 rounded-xl">
                <Loader className="w-5 h-5 text-indigo-600 flex-shrink-0" />
                <p className="text-sm text-indigo-700">The startup loader appears while your page is loading. It fades out automatically after the set duration.</p>
              </div>

              <label className="flex items-center gap-3 cursor-pointer">
                <input type="checkbox" checked={loader.enabled || false} onChange={(e) => updateLoader("enabled", e.target.checked)} className="rounded border-gray-300 text-indigo-600 w-4 h-4" />
                <span className="text-sm font-medium text-gray-700">Enable Startup Loader</span>
              </label>

              {loader.enabled && (
                <div className="space-y-4 pl-4 border-l-2 border-indigo-100">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1.5">Loader Type</label>
                    <select value={loader.type || "spinner"} onChange={(e) => updateLoader("type", e.target.value)} className={INPUT_CLS}>
                      <option value="spinner">Spinner</option>
                      <option value="image">Image / Logo</option>
                      <option value="svg">Custom SVG</option>
                      <option value="progress">Progress Bar</option>
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1.5">Background Color</label>
                    <div className="flex gap-2">
                      <input type="color" value={loader.backgroundColor || "#ffffff"} onChange={(e) => updateLoader("backgroundColor", e.target.value)} className="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer" />
                      <input type="text" value={loader.backgroundColor || "#ffffff"} onChange={(e) => updateLoader("backgroundColor", e.target.value)} className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" />
                    </div>
                  </div>

                  {(loader.type === "spinner" || loader.type === "progress") && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1.5">{loader.type === "spinner" ? "Spinner Color" : "Bar Color"}</label>
                      <div className="flex gap-2">
                        <input type="color" value={loader.spinnerColor || "#6366f1"} onChange={(e) => updateLoader("spinnerColor", e.target.value)} className="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer" />
                        <input type="text" value={loader.spinnerColor || "#6366f1"} onChange={(e) => updateLoader("spinnerColor", e.target.value)} className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" />
                      </div>
                    </div>
                  )}

                  {loader.type === "image" && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1.5">Loader Image</label>
                      {loader.image && (
                        <div className="relative border-2 border-gray-200 rounded-lg p-3 mb-2 flex items-center justify-center" style={{ backgroundColor: loader.backgroundColor || "#ffffff" }}>
                          <img src={loader.image} alt="Loader" className="h-16 object-contain" />
                          <button onClick={() => updateLoader("image", "")} className="absolute top-2 right-2 p-1 bg-red-600 text-white rounded hover:bg-red-700"><X className="w-3 h-3" /></button>
                        </div>
                      )}
                      <button onClick={() => setShowFilePicker(true)} className="w-full px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-sm text-gray-600">
                        {loader.image ? "Change Image" : "Upload Loader Image"}
                      </button>
                    </div>
                  )}

                  {loader.type === "svg" && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1.5">Custom SVG Code</label>
                      <textarea
                        value={loader.svg || ""}
                        onChange={(e) => updateLoader("svg", e.target.value)}
                        rows={6}
                        placeholder={'<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 100 100">...</svg>'}
                        className={`${INPUT_CLS} font-mono text-xs`}
                      />
                    </div>
                  )}

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1.5">Duration (ms)</label>
                    <input type="number" value={loader.duration || 2000} min={500} step={100} onChange={(e) => updateLoader("duration", parseInt(e.target.value))} className={INPUT_CLS} />
                    <p className="text-xs text-gray-400 mt-1">How long the loader is visible before fading out</p>
                  </div>

                  <div className="p-4 bg-gray-50 rounded-xl">
                    <p className="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wide">Preview</p>
                    <div className="w-full h-28 rounded-lg flex items-center justify-center border border-gray-200" style={{ backgroundColor: loader.backgroundColor || "#ffffff" }}>
                      {loader.type === "spinner" && (
                        <div className="w-10 h-10 border-4 border-t-transparent rounded-full animate-spin" style={{ borderColor: `${loader.spinnerColor || "#6366f1"} transparent transparent transparent` }} />
                      )}
                      {loader.type === "progress" && (
                        <div className="w-40 h-2 bg-gray-200 rounded-full overflow-hidden">
                          <div className="h-full rounded-full animate-pulse" style={{ backgroundColor: loader.spinnerColor || "#6366f1", width: "65%" }} />
                        </div>
                      )}
                      {loader.type === "image" && loader.image && <img src={loader.image} alt="Loader" className="h-14 object-contain" />}
                      {loader.type === "image" && !loader.image && <p className="text-xs text-gray-400">Upload an image above</p>}
                      {loader.type === "svg" && loader.svg && <div dangerouslySetInnerHTML={{ __html: loader.svg }} />}
                      {loader.type === "svg" && !loader.svg && <p className="text-xs text-gray-400">Enter SVG code above</p>}
                    </div>
                  </div>
                </div>
              )}
            </div>
          )}

          {activeTab === "env" && (
            <div className="space-y-5">
              <div className="flex items-start gap-3 p-4 bg-amber-50 border border-amber-200 rounded-xl">
                <AlertCircle className="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" />
                <div>
                  <p className="text-sm font-medium text-amber-800 mb-1">How to use variables</p>
                  <p className="text-xs text-amber-700">Add your form endpoint URLs and API keys here. Then paste the value directly into the "Submit URL" field in your section's Properties panel. Variables are stored securely in your theme config.</p>
                </div>
              </div>

              <div className="flex items-center justify-between">
                <div>
                  <h3 className="text-sm font-semibold text-gray-900">Environment Variables</h3>
                  <p className="text-xs text-gray-500 mt-0.5">{envVars.length} variable{envVars.length !== 1 ? "s" : ""} configured</p>
                </div>
                <button onClick={addEnvVar} className="flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors">
                  <Plus className="w-4 h-4" />Add Variable
                </button>
              </div>

              {envVars.length === 0 ? (
                <div className="text-center py-10 border-2 border-dashed border-gray-200 rounded-xl">
                  <Settings className="w-8 h-8 text-gray-300 mx-auto mb-3" />
                  <p className="text-sm text-gray-500 font-medium">No variables yet</p>
                  <p className="text-xs text-gray-400 mt-1">Add form endpoints, API keys, and webhook URLs</p>
                </div>
              ) : (
                <div className="space-y-3">
                  {envVars.map((ev, idx) => (
                    <div key={ev.id || idx} className="bg-gray-50 p-4 rounded-xl border border-gray-200">
                      <div className="flex items-center gap-3 mb-3">
                        <div className="flex-1">
                          <label className="block text-xs text-gray-500 mb-1">Variable Name</label>
                          <input
                            type="text"
                            placeholder="FORM_ENDPOINT"
                            value={ev.key || ""}
                            onChange={(e) => updateEnvVar(idx, "key", e.target.value.toUpperCase().replace(/[^A-Z0-9_]/g, "_"))}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono bg-white"
                          />
                        </div>
                        <button onClick={() => removeEnvVar(idx)} className="mt-5 p-2 text-red-500 hover:bg-red-50 rounded-lg flex-shrink-0"><Trash2 className="w-4 h-4" /></button>
                      </div>
                      <div className="mb-2">
                        <label className="block text-xs text-gray-500 mb-1">Value</label>
                        <div className="relative">
                          <input
                            type={showEnvValues[idx] ? "text" : "password"}
                            placeholder="https://api.example.com/submit"
                            value={ev.value || ""}
                            onChange={(e) => updateEnvVar(idx, "value", e.target.value)}
                            className="w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg text-sm bg-white font-mono"
                          />
                          <button onClick={() => setShowEnvValues((prev) => ({ ...prev, [idx]: !prev[idx] }))} className="absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600">
                            {showEnvValues[idx] ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
                          </button>
                        </div>
                      </div>
                      <div>
                        <label className="block text-xs text-gray-500 mb-1">Description (optional)</label>
                        <input
                          type="text"
                          placeholder="e.g. Contact form submission endpoint"
                          value={ev.description || ""}
                          onChange={(e) => updateEnvVar(idx, "description", e.target.value)}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white text-gray-600"
                        />
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>

        <div className="flex gap-3 p-6 border-t border-gray-200">
          <button onClick={onClose} disabled={isSaving} className="flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium">
            Cancel
          </button>
          <button onClick={handleSaveAndClose} disabled={isSaving} className="flex-1 px-4 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center font-medium">
            {isSaving ? (
              <>
                <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Saving...
              </>
            ) : "Save Changes"}
          </button>
        </div>
      </div>

      {showFilePicker && selectedWebsite?.id && (
        <FilePickerModal isOpen={showFilePicker} onClose={() => setShowFilePicker(false)} onSelectFile={handleLoaderFileSelect} websiteId={selectedWebsite.id} allowedTypes={["image"]} />
      )}
    </div>
  );
}

ConfrimModal.jsx:
import { X } from "lucide-react";

const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message }) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/20 z-50 flex items-center justify-center p-4">
      <div className="bg-white border border-gray-200 rounded-lg max-w-md w-full shadow-xl">
        <div className="flex items-center justify-between p-4 border-b border-gray-100">
          <h3 className="text-lg font-semibold text-gray-900">{title}</h3>
          <button
            onClick={onClose}
            className="p-1 hover:bg-gray-100 rounded transition-colors text-gray-500 hover:text-gray-700"
          >
            <X size={20} />
          </button>
        </div>
        <div className="p-6">
          <p className="text-gray-600">{message}</p>
        </div>
        <div className="flex items-center justify-end gap-3 p-4 border-t border-gray-100">
          <button
            onClick={onClose}
            className="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors text-gray-700"
          >
            Cancel
          </button>
          <button
            onClick={() => {
              onConfirm();
              onClose();
            }}
            className="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 transition-colors text-white"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
  );
};

export default ConfirmModal;

Canvas.jsx:
import { useState } from "react";
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
} from "@dnd-kit/core";
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  verticalListSortingStrategy,
} from "@dnd-kit/sortable";
import { useEditorStore } from "../../../store/store";
import SortableSection from "./SortableSection";
import { Inbox } from "lucide-react";

export default function Canvas({ selectedTemplate }) {
  const { config, reorderSections, selectSection } = useEditorStore();
  const sections = config.layout?.sections || [];
  const themeColors = config.theme?.colors;

  const sensors = useSensors(
    useSensor(PointerSensor, { activationConstraint: { distance: 8 } }),
    useSensor(KeyboardSensor, { coordinateGetter: sortableKeyboardCoordinates }),
  );

  const handleDragEnd = (event) => {
    const { active, over } = event;
    if (!over || active.id === over.id) return;

    const oldIndex = sections.findIndex((s) => s.id === active.id);
    const newIndex = sections.findIndex((s) => s.id === over.id);
    const activeSection = sections[oldIndex];
    const overSection = sections[newIndex];

    reorderSections(arrayMove(sections, oldIndex, newIndex));
  };

  return (
    <div className="h-full overflow-y-auto bg-white">
      <div className="w-full">
        {sections.length === 0 ? (
          <div className="h-[500px] flex items-center justify-center bg-gray-50">
            <div className="text-center">
              <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Inbox className="w-8 h-8 text-gray-400" />
              </div>
              <h3 className="text-lg font-semibold text-gray-900 mb-2">Your canvas is empty</h3>
              <p className="text-sm text-gray-500">Add sections from the library on the left. Start with a Header!</p>
              <button
                onClick={() => window.dispatchEvent(new CustomEvent("open-template-modal"))}
                className="mt-4 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
              >
                Choose Template
              </button>
            </div>
          </div>
        ) : (
          <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
            <SortableContext items={sections.map((s) => s.id)} strategy={verticalListSortingStrategy}>
              <div>
                {sections.map((section) => (
                  <div key={section.id} id={section.id}>
                    <SortableSection
                      section={section}
                      onSelect={() => selectSection(section.id)}
                      themeColors={themeColors}
                      selectedTemplate={selectedTemplate}
                    />
                  </div>
                ))}
              </div>
            </SortableContext>
          </DndContext>
        )}
      </div>
    </div>
  );
}

PropertiesPanel.jsx:
import { useState } from "react";
import { useEditorStore } from "../../../store/store";
import {
  X,
  Plus,
  Trash2,
  ChevronDown,
  ChevronUp,
  Image as ImageIcon,
  Settings,
  Film,
  Layers,
  Link,
  AlertCircle,
} from "lucide-react";
import { useWebsiteStore } from "../../../store/store";
import FilePickerModal from "../modals/FilePickerModal";
import { v4 as uuidv4 } from "uuid";
import { SECTION_VARIANTS, SECTION_TYPES } from "../../../utils/sectionLibrary";

const INPUT_CLS =
  "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500";

export default function PropertiesPanel() {
  const { selectedWebsite } = useWebsiteStore();
  const {
    config,
    selectedSection,
    updateSection,
    updateConfig,
    selectSection,
  } = useEditorStore();

  const [expandedSections, setExpandedSections] = useState({});
  const [showFilePicker, setShowFilePicker] = useState(false);
  const [currentImageField, setCurrentImageField] = useState(null);

  const toggleExpanded = (key) =>
    setExpandedSections((prev) => ({ ...prev, [key]: !prev[key] }));

  const openFilePicker = (fieldInfo) => {
    setCurrentImageField(fieldInfo);
    setShowFilePicker(true);
  };

  const handleFileSelect = (file) => {
    if (!currentImageField) return;
    const fileUrl = file.file_path;
    if (currentImageField.sectionId) {
      if (currentImageField.arrayPath) {
        if (currentImageField.arrayPath === "carousel.slides") {
          const sec = config.layout.sections.find(
            (s) => s.id === currentImageField.sectionId,
          );
          if (!sec) return;
          const slides = [...(sec.props.carousel?.slides || [])];
          slides[currentImageField.index] = {
            ...slides[currentImageField.index],
            [currentImageField.field]: fileUrl,
          };
          updateSection(currentImageField.sectionId, {
            props: {
              ...sec.props,
              carousel: { ...sec.props.carousel, slides },
            },
          });
        } else {
          updateArrayItem(
            currentImageField.arrayPath,
            currentImageField.index,
            currentImageField.field,
            fileUrl,
          );
        }
      } else if (currentImageField.isStyle) {
        updateStyle(currentImageField.field, fileUrl);
      } else {
        updateProp(currentImageField.field, fileUrl);
      }
    }
    setShowFilePicker(false);
    setCurrentImageField(null);
  };

  if (!selectedSection) {
    return (
      <div className="h-full flex flex-col bg-white border-l border-gray-200">
        <div className="p-4 border-b border-gray-200">
          <h3 className="text-sm font-semibold text-gray-900 mb-0.5">
            Properties
          </h3>
          <p className="text-xs text-gray-500">Click on a section to edit</p>
        </div>
        <div className="flex-1 overflow-y-auto p-4">
          <div className="text-center py-8">
            <Settings className="w-8 h-8 text-gray-300 mx-auto mb-3" />
            <p className="text-xs text-gray-500">
              Select a section in the canvas to edit its properties
            </p>
          </div>
        </div>
      </div>
    );
  }

  const section = config.layout.sections.find((s) => s.id === selectedSection);
  if (!section) return null;

  const updateProp = (path, value) => {
    const keys = path.split(".");
    const newProps = { ...section.props };
    let cur = newProps;
    for (let i = 0; i < keys.length - 1; i++) {
      if (!cur[keys[i]]) cur[keys[i]] = {};
      cur = cur[keys[i]];
    }
    cur[keys[keys.length - 1]] = value;
    updateSection(section.id, { props: newProps });
  };

  const updateStyle = (path, value) => {
    const keys = path.split(".");
    const newStyle = { ...(section.style || {}) };
    let cur = newStyle;
    for (let i = 0; i < keys.length - 1; i++) {
      if (!cur[keys[i]]) cur[keys[i]] = {};
      cur = cur[keys[i]];
    }
    cur[keys[keys.length - 1]] = value;
    updateSection(section.id, { style: newStyle });
  };

  const updateArrayItem = (arrayPath, index, itemPath, value) => {
    const array = [...(section.props[arrayPath] || [])];
    const keys = itemPath.split(".");
    let cur = array[index];
    for (let i = 0; i < keys.length - 1; i++) {
      if (!cur[keys[i]]) cur[keys[i]] = {};
      cur = cur[keys[i]];
    }
    cur[keys[keys.length - 1]] = value;
    updateProp(arrayPath, array);
  };

  const addArrayItem = (arrayPath, template) => {
    const array = section.props[arrayPath] || [];
    const newItem =
      typeof template === "string" ? template : { ...template, id: uuidv4() };
    updateProp(arrayPath, [...array, newItem]);
  };

  const removeArrayItem = (arrayPath, index) => {
    const array = [...(section.props[arrayPath] || [])];
    array.splice(index, 1);
    updateProp(arrayPath, array);
  };

  const renderInput = (label, value, onChange, type = "text") => (
    <div className="mb-4">
      <label className="block text-sm font-medium text-gray-700 mb-1.5">
        {label}
      </label>
      {type === "textarea" ? (
        <textarea
          value={value || ""}
          onChange={(e) => onChange(e.target.value)}
          className={INPUT_CLS}
          rows={4}
        />
      ) : type === "select" ? (
        <select
          value={value || ""}
          onChange={(e) => onChange(e.target.value)}
          className={INPUT_CLS}
        >
          {(onChange.options || []).map((opt) => (
            <option key={opt.value} value={opt.value}>
              {opt.label}
            </option>
          ))}
        </select>
      ) : type === "image" ? (
        <div>
          {value && (
            <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
              <img
                src={value}
                alt="Preview"
                className="w-full h-32 object-cover rounded"
              />
              <button
                onClick={() => onChange("")}
                className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded hover:bg-red-700"
              >
                <X className="w-3 h-3" />
              </button>
            </div>
          )}
          <FileButton
            onClick={() =>
              openFilePicker({
                sectionId: section.id,
                field: label.toLowerCase().replace(/\s/g, ""),
              })
            }
            label={value ? "Change Image" : "Upload Image"}
          />
        </div>
      ) : (
        <input
          type={type}
          value={value || ""}
          onChange={(e) => onChange(e.target.value)}
          className={INPUT_CLS}
        />
      )}
    </div>
  );

  const renderArrayEditor = (label, arrayPath, itemTemplate, renderItem) => {
    const items = section.props[arrayPath] || [];
    const isExpanded = expandedSections[arrayPath];
    return (
      <div className="mb-6 pb-6 border-b border-gray-200">
        <div className="flex items-center justify-between mb-3">
          <button
            onClick={() => toggleExpanded(arrayPath)}
            className="flex items-center gap-2 text-sm font-medium text-gray-900"
          >
            {isExpanded ? (
              <ChevronUp className="w-4 h-4" />
            ) : (
              <ChevronDown className="w-4 h-4" />
            )}
            {label} ({items.length})
          </button>
          <button
            onClick={() => addArrayItem(arrayPath, itemTemplate)}
            className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
          >
            <Plus className="w-4 h-4" />
          </button>
        </div>
        {isExpanded && (
          <div className="space-y-4 pl-4">
            {items.map((item, idx) => (
              <div
                key={item.id || idx}
                className="bg-gray-50 p-4 rounded-lg relative"
              >
                <button
                  onClick={() => removeArrayItem(arrayPath, idx)}
                  className="absolute top-2 right-2 p-1.5 text-red-600 hover:bg-red-50 rounded-lg"
                >
                  <Trash2 className="w-4 h-4" />
                </button>
                {renderItem(item, idx, (path, value) =>
                  updateArrayItem(arrayPath, idx, path, value),
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    );
  };

  const variants = SECTION_VARIANTS[section.type];
  const renderVariantSelector = () => {
    if (!variants) return null;
    const applyVariant = (value) => {
      const newProps = { ...section.props, variant: value };
      if (newProps.carousel) {
        newProps.carousel = {
          ...newProps.carousel,
          enabled: value === "carousel",
        };
      } else if (value === "carousel") {
        newProps.carousel = {
          enabled: true,
          autoplay: true,
          interval: 5000,
          slides: [],
        };
      }
      updateSection(section.id, { props: newProps });
    };
    const activeVariant = section.props.variant || variants[0].value;
    return (
      <SectionBlock
        title="Layout / Style"
        icon={<Layers className="w-4 h-4 text-indigo-500" />}
      >
        <div className="grid grid-cols-1 gap-1.5">
          {variants.map((v) => (
            <button
              key={v.value}
              onClick={() => applyVariant(v.value)}
              className={`px-3 py-2 rounded-lg text-sm text-left font-medium transition-all border-2 ${activeVariant === v.value ? "border-indigo-500 bg-indigo-50 text-indigo-700" : "border-gray-200 text-gray-700 hover:border-indigo-300"}`}
            >
              {v.label}
            </button>
          ))}
        </div>
      </SectionBlock>
    );
  };

  const renderCarouselSettings = () => {
    const carousel = section.props.carousel;
    if (!carousel) return null;
    return (
      <SectionBlock
        title="Carousel Settings"
        icon={<Film className="w-4 h-4 text-indigo-500" />}
      >
        <div className="space-y-4">
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              checked={carousel.enabled || false}
              onChange={(e) => updateProp("carousel.enabled", e.target.checked)}
              className="rounded border-gray-300 text-indigo-600"
            />
            <span className="text-sm text-gray-700">Enable Carousel</span>
          </label>
          {carousel.enabled && (
            <>
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={carousel.autoplay || false}
                  onChange={(e) =>
                    updateProp("carousel.autoplay", e.target.checked)
                  }
                  className="rounded border-gray-300 text-indigo-600"
                />
                <span className="text-sm text-gray-700">Autoplay</span>
              </label>
              <LabeledField label="Interval (ms)">
                <input
                  type="number"
                  value={carousel.interval || 5000}
                  step={500}
                  min={1000}
                  onChange={(e) =>
                    updateProp("carousel.interval", parseInt(e.target.value))
                  }
                  className={INPUT_CLS}
                />
              </LabeledField>
              {section.type === "hero" && carousel.slides && (
                <div className="mt-2">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium text-gray-700">
                      Slides ({carousel.slides.length})
                    </span>
                    <button
                      onClick={() => {
                        const slides = [...(carousel.slides || [])];
                        slides.push({
                          id: uuidv4(),
                          image: "",
                          heading: `Slide ${slides.length + 1}`,
                          subheading: "",
                          ctaText: "Learn More",
                          ctaLink: "#",
                        });
                        updateProp("carousel.slides", slides);
                      }}
                      className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
                    >
                      <Plus className="w-4 h-4" />
                    </button>
                  </div>
                  <div className="space-y-4">
                    {carousel.slides.map((slide, idx) => (
                      <div
                        key={slide.id || idx}
                        className="bg-white border border-gray-200 p-3 rounded-lg relative"
                      >
                        <button
                          onClick={() => {
                            const slides = [...carousel.slides];
                            slides.splice(idx, 1);
                            updateProp("carousel.slides", slides);
                          }}
                          className="absolute top-2 right-2 p-1 text-red-500 hover:bg-red-50 rounded"
                        >
                          <Trash2 className="w-3.5 h-3.5" />
                        </button>
                        <p className="text-xs font-semibold text-gray-500 mb-2">
                          Slide {idx + 1}
                        </p>
                        {slide.image && (
                          <div className="relative border rounded-lg p-1 mb-2">
                            <img
                              src={slide.image}
                              alt=""
                              className="w-full h-16 object-cover rounded"
                            />
                            <button
                              onClick={() => {
                                const slides = [...carousel.slides];
                                slides[idx].image = "";
                                updateProp("carousel.slides", slides);
                              }}
                              className="absolute top-1 right-1 p-0.5 bg-red-600 text-white rounded"
                            >
                              <X className="w-2.5 h-2.5" />
                            </button>
                          </div>
                        )}
                        <button
                          onClick={() =>
                            openFilePicker({
                              sectionId: section.id,
                              arrayPath: "carousel.slides",
                              index: idx,
                              field: "image",
                            })
                          }
                          className="w-full mb-2 px-3 py-1.5 border border-dashed border-gray-300 rounded text-xs text-gray-500 hover:border-indigo-500 hover:text-indigo-600"
                        >
                          {slide.image ? "Change Image" : "Add Image"}
                        </button>
                        {["heading", "subheading", "ctaText", "ctaLink"].map(
                          (field) => (
                            <input
                              key={field}
                              type="text"
                              placeholder={field}
                              value={slide[field] || ""}
                              onChange={(e) => {
                                const slides = [...carousel.slides];
                                slides[idx] = {
                                  ...slides[idx],
                                  [field]: e.target.value,
                                };
                                updateProp("carousel.slides", slides);
                              }}
                              className={`${INPUT_CLS} mb-1.5`}
                            />
                          ),
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </>
          )}
        </div>
      </SectionBlock>
    );
  };

  const renderHeaderProperties = () => {
    const p = section.props;
    return (
      <>
        {renderVariantSelector()}

        <SectionBlock title="Logo">
          <label className="flex items-center gap-2 mb-3 cursor-pointer">
            <input
              type="checkbox"
              checked={p.showLogo !== false}
              onChange={(e) => updateProp("showLogo", e.target.checked)}
              className="rounded border-gray-300 text-indigo-600"
            />
            <span className="text-sm text-gray-700">Show Logo</span>
          </label>
          {p.showLogo !== false && (
            <>
              {p.logo && (
                <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                  <img
                    src={p.logo}
                    alt="Logo"
                    className="w-full h-16 object-contain"
                  />
                  <button
                    onClick={() => updateProp("logo", "")}
                    className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                  >
                    <X className="w-3 h-3" />
                  </button>
                </div>
              )}
              <FileButton
                label={p.logo ? "Change Logo" : "Upload Logo"}
                onClick={() =>
                  openFilePicker({ sectionId: section.id, field: "logo" })
                }
              />
              <div className="mt-3">
                <LabeledField label="Logo Text (fallback)">
                  <input
                    type="text"
                    value={p.logoText || ""}
                    onChange={(e) => updateProp("logoText", e.target.value)}
                    className={INPUT_CLS}
                  />
                </LabeledField>
              </div>
            </>
          )}
        </SectionBlock>

        <SectionBlock title="Appearance">
          <div className="space-y-4">
            <LabeledField label="Height (px)">
              <input
                type="number"
                value={parseInt(p.height) || 80}
                onChange={(e) => updateProp("height", `${e.target.value}px`)}
                className={INPUT_CLS}
              />
            </LabeledField>
            <ColorField
              label="Background Color"
              value={p.backgroundColor || "#ffffff"}
              onChange={(v) => updateProp("backgroundColor", v)}
            />
            <ColorField
              label="Text / Link Color"
              value={p.textColor || "#111827"}
              onChange={(v) => updateProp("textColor", v)}
            />
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={p.transparent || false}
                onChange={(e) => updateProp("transparent", e.target.checked)}
                className="rounded border-gray-300 text-indigo-600"
              />
              <span className="text-sm text-gray-700">
                Transparent Background
              </span>
            </label>
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={p.blur || false}
                onChange={(e) => updateProp("blur", e.target.checked)}
                className="rounded border-gray-300 text-indigo-600"
              />
              <span className="text-sm text-gray-700">
                Blur Effect (glassmorphism)
              </span>
            </label>
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={p.sticky !== false}
                onChange={(e) => updateProp("sticky", e.target.checked)}
                className="rounded border-gray-300 text-indigo-600"
              />
              <span className="text-sm text-gray-700">Sticky Header</span>
            </label>
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={p.borderBottom !== false}
                onChange={(e) => updateProp("borderBottom", e.target.checked)}
                className="rounded border-gray-300 text-indigo-600"
              />
              <span className="text-sm text-gray-700">Show Bottom Border</span>
            </label>
            {p.borderBottom !== false && (
              <ColorField
                label="Border Color"
                value={p.borderColor || "#e5e7eb"}
                onChange={(v) => updateProp("borderColor", v)}
              />
            )}
          </div>
        </SectionBlock>

        <SectionBlock title="Navigation">
          <div className="space-y-3 mb-3">
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={p.showNav !== false}
                onChange={(e) => updateProp("showNav", e.target.checked)}
                className="rounded border-gray-300 text-indigo-600"
              />
              <span className="text-sm text-gray-700">Show Navigation</span>
            </label>
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={p.showSearch || false}
                onChange={(e) => updateProp("showSearch", e.target.checked)}
                className="rounded border-gray-300 text-indigo-600"
              />
              <span className="text-sm text-gray-700">Show Search</span>
            </label>
          </div>
          <div className="flex items-center justify-between mb-3">
            <span className="text-xs font-semibold text-gray-500 uppercase tracking-wide">
              Menu Items ({(p.menu || []).length})
            </span>
            <button
              onClick={() =>
                updateProp("menu", [
                  ...(p.menu || []),
                  {
                    id: uuidv4(),
                    label: "New Link",
                    url: "#",
                    hasSubmenu: false,
                    submenu: [],
                  },
                ])
              }
              className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
            >
              <Plus className="w-4 h-4" />
            </button>
          </div>
          <div className="space-y-2">
            {(p.menu || []).map((item, idx) => (
              <div key={item.id || idx} className="bg-gray-50 p-3 rounded-lg">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-xs font-medium text-gray-600">
                    Item {idx + 1}
                  </span>
                  <button
                    onClick={() => {
                      const menu = [...p.menu];
                      menu.splice(idx, 1);
                      updateProp("menu", menu);
                    }}
                    className="p-1 text-red-600 hover:bg-red-50 rounded"
                  >
                    <Trash2 className="w-3 h-3" />
                  </button>
                </div>
                <input
                  type="text"
                  placeholder="Label"
                  value={item.label}
                  onChange={(e) => {
                    const menu = [...p.menu];
                    menu[idx] = { ...menu[idx], label: e.target.value };
                    updateProp("menu", menu);
                  }}
                  className={`${INPUT_CLS} mb-2`}
                />
                <input
                  type="text"
                  placeholder="URL"
                  value={item.url || ""}
                  onChange={(e) => {
                    const menu = [...p.menu];
                    menu[idx] = { ...menu[idx], url: e.target.value };
                    updateProp("menu", menu);
                  }}
                  className={`${INPUT_CLS} mb-2`}
                />
                <label className="flex items-center gap-2 cursor-pointer mb-2">
                  <input
                    type="checkbox"
                    checked={item.hasSubmenu || false}
                    onChange={(e) => {
                      const menu = [...p.menu];
                      menu[idx] = {
                        ...menu[idx],
                        hasSubmenu: e.target.checked,
                      };
                      updateProp("menu", menu);
                    }}
                    className="rounded border-gray-300 text-indigo-600"
                  />
                  <span className="text-xs text-gray-700">Has Submenu</span>
                </label>
                {item.hasSubmenu && (
                  <div className="ml-3 space-y-2">
                    {(item.submenu || []).map((sub, sIdx) => (
                      <div key={sub.id || sIdx} className="flex gap-2">
                        <input
                          type="text"
                          placeholder="Label"
                          value={sub.label || ""}
                          onChange={(e) => {
                            const menu = [...p.menu];
                            menu[idx].submenu[sIdx] = {
                              ...menu[idx].submenu[sIdx],
                              label: e.target.value,
                            };
                            updateProp("menu", menu);
                          }}
                          className="flex-1 px-2 py-1 border border-gray-300 rounded text-xs"
                        />
                        <input
                          type="text"
                          placeholder="URL"
                          value={sub.url || ""}
                          onChange={(e) => {
                            const menu = [...p.menu];
                            menu[idx].submenu[sIdx] = {
                              ...menu[idx].submenu[sIdx],
                              url: e.target.value,
                            };
                            updateProp("menu", menu);
                          }}
                          className="flex-1 px-2 py-1 border border-gray-300 rounded text-xs"
                        />
                        <button
                          onClick={() => {
                            const menu = [...p.menu];
                            menu[idx].submenu.splice(sIdx, 1);
                            updateProp("menu", menu);
                          }}
                          className="p-1 text-red-600 hover:bg-red-50 rounded"
                        >
                          <X className="w-3 h-3" />
                        </button>
                      </div>
                    ))}
                    <button
                      onClick={() => {
                        const menu = [...p.menu];
                        menu[idx].submenu = [
                          ...(menu[idx].submenu || []),
                          { id: uuidv4(), label: "Sub Item", url: "#" },
                        ];
                        updateProp("menu", menu);
                      }}
                      className="w-full px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-500 hover:border-indigo-500 hover:text-indigo-600"
                    >
                      + Add Sub Item
                    </button>
                  </div>
                )}
              </div>
            ))}
          </div>
        </SectionBlock>

        <SectionBlock title="CTA Button">
          <label className="flex items-center gap-2 mb-3 cursor-pointer">
            <input
              type="checkbox"
              checked={p.showCta !== false}
              onChange={(e) => updateProp("showCta", e.target.checked)}
              className="rounded border-gray-300 text-indigo-600"
            />
            <span className="text-sm text-gray-700">Show CTA Button</span>
          </label>
          {p.showCta !== false && (
            <div className="space-y-3">
              <input
                type="text"
                placeholder="Button Text"
                value={p.ctaText || ""}
                onChange={(e) => updateProp("ctaText", e.target.value)}
                className={INPUT_CLS}
              />
              <input
                type="text"
                placeholder="Button Link"
                value={p.ctaLink || ""}
                onChange={(e) => updateProp("ctaLink", e.target.value)}
                className={INPUT_CLS}
              />
              <LabeledField label="Style">
                <select
                  value={p.ctaStyle || "filled"}
                  onChange={(e) => updateProp("ctaStyle", e.target.value)}
                  className={INPUT_CLS}
                >
                  <option value="filled">Filled</option>
                  <option value="outline">Outline</option>
                </select>
              </LabeledField>
              <ColorField
                label="Button Color"
                value={p.ctaColor || "#6366f1"}
                onChange={(v) => updateProp("ctaColor", v)}
              />
              <ColorField
                label="Button Text Color"
                value={p.ctaTextColor || "#ffffff"}
                onChange={(v) => updateProp("ctaTextColor", v)}
              />
            </div>
          )}
        </SectionBlock>
      </>
    );
  };

  const renderFooterProperties = () => {
    const p = section.props;
    return (
      <>
        {renderVariantSelector()}

        <SectionBlock title="Logo & Brand">
          <label className="flex items-center gap-2 mb-3 cursor-pointer">
            <input
              type="checkbox"
              checked={p.showLogo !== false}
              onChange={(e) => updateProp("showLogo", e.target.checked)}
              className="rounded border-gray-300 text-indigo-600"
            />
            <span className="text-sm text-gray-700">Show Logo</span>
          </label>
          {p.showLogo !== false && (
            <>
              {p.logo && (
                <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                  <img
                    src={p.logo}
                    alt="Logo"
                    className="w-full h-16 object-contain"
                  />
                  <button
                    onClick={() => updateProp("logo", "")}
                    className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                  >
                    <X className="w-3 h-3" />
                  </button>
                </div>
              )}
              <FileButton
                label={p.logo ? "Change Logo" : "Upload Logo"}
                onClick={() =>
                  openFilePicker({ sectionId: section.id, field: "logo" })
                }
              />
              <div className="mt-3 space-y-3">
                <LabeledField label="Logo Text (fallback)">
                  <input
                    type="text"
                    value={p.logoText || ""}
                    onChange={(e) => updateProp("logoText", e.target.value)}
                    className={INPUT_CLS}
                  />
                </LabeledField>
                <ColorField
                  label="Logo Text Color"
                  value={p.logoTextColor || "#ffffff"}
                  onChange={(v) => updateProp("logoTextColor", v)}
                />
                <LabeledField label="Tagline">
                  <input
                    type="text"
                    value={p.tagline || ""}
                    onChange={(e) => updateProp("tagline", e.target.value)}
                    className={INPUT_CLS}
                  />
                </LabeledField>
                <ColorField
                  label="Tagline Color"
                  value={p.taglineColor || "rgba(255,255,255,0.6)"}
                  onChange={(v) => updateProp("taglineColor", v)}
                />
              </div>
            </>
          )}
        </SectionBlock>

        <SectionBlock title="Colors">
          <div className="space-y-4">
            <ColorField
              label="Background"
              value={p.backgroundColor || "#111827"}
              onChange={(v) => updateProp("backgroundColor", v)}
            />
            <ColorField
              label="Text Color"
              value={p.textColor || "#ffffff"}
              onChange={(v) => updateProp("textColor", v)}
            />
            <ColorField
              label="Link Color"
              value={p.linkColor || "#9ca3af"}
              onChange={(v) => updateProp("linkColor", v)}
            />
            <ColorField
              label="Column Title Color"
              value={p.columnTitleColor || "#ffffff"}
              onChange={(v) => updateProp("columnTitleColor", v)}
            />
            <ColorField
              label="Accent Color"
              value={p.accentColor || "#6366f1"}
              onChange={(v) => updateProp("accentColor", v)}
            />
            <ColorField
              label="Divider Color"
              value={p.dividerColor || "rgba(255,255,255,0.1)"}
              onChange={(v) => updateProp("dividerColor", v)}
            />
            <ColorField
              label="Copyright Color"
              value={p.copyrightColor || "rgba(255,255,255,0.4)"}
              onChange={(v) => updateProp("copyrightColor", v)}
            />
            <LabeledField label="Padding">
              <input
                type="text"
                value={p.padding || "3rem 0"}
                onChange={(e) => updateProp("padding", e.target.value)}
                placeholder="3rem 0"
                className={INPUT_CLS}
              />
            </LabeledField>
          </div>
        </SectionBlock>

        <SectionBlock
          title={`Columns (${(p.columns || []).length})`}
          action={
            <button
              onClick={() =>
                updateProp("columns", [
                  ...(p.columns || []),
                  { id: uuidv4(), title: "New Column", links: [] },
                ])
              }
              className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
            >
              <Plus className="w-4 h-4" />
            </button>
          }
        >
          <div className="space-y-3">
            {(p.columns || []).map((col, idx) => (
              <div key={col.id || idx} className="bg-gray-50 p-3 rounded-lg">
                <div className="flex items-center justify-between mb-2">
                  <input
                    type="text"
                    placeholder="Column Title"
                    value={col.title}
                    onChange={(e) => {
                      const cols = [...p.columns];
                      cols[idx] = { ...cols[idx], title: e.target.value };
                      updateProp("columns", cols);
                    }}
                    className="flex-1 px-3 py-1.5 border border-gray-300 rounded text-sm font-medium"
                  />
                  <button
                    onClick={() => {
                      const cols = [...p.columns];
                      cols.splice(idx, 1);
                      updateProp("columns", cols);
                    }}
                    className="ml-2 p-1 text-red-600 hover:bg-red-50 rounded"
                  >
                    <Trash2 className="w-3 h-3" />
                  </button>
                </div>
                <div className="space-y-1 mt-2">
                  {(col.links || []).map((link, lIdx) => (
                    <div key={lIdx} className="flex gap-1">
                      <input
                        type="text"
                        placeholder="Label"
                        value={link.label || ""}
                        onChange={(e) => {
                          const cols = [...p.columns];
                          cols[idx].links[lIdx] = {
                            ...cols[idx].links[lIdx],
                            label: e.target.value,
                          };
                          updateProp("columns", cols);
                        }}
                        className="flex-1 px-2 py-1 border border-gray-300 rounded text-xs"
                      />
                      <input
                        type="text"
                        placeholder="URL"
                        value={link.url || ""}
                        onChange={(e) => {
                          const cols = [...p.columns];
                          cols[idx].links[lIdx] = {
                            ...cols[idx].links[lIdx],
                            url: e.target.value,
                          };
                          updateProp("columns", cols);
                        }}
                        className="flex-1 px-2 py-1 border border-gray-300 rounded text-xs"
                      />
                      <button
                        onClick={() => {
                          const cols = [...p.columns];
                          cols[idx].links.splice(lIdx, 1);
                          updateProp("columns", cols);
                        }}
                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                      >
                        <X className="w-3 h-3" />
                      </button>
                    </div>
                  ))}
                  <button
                    onClick={() => {
                      const cols = [...p.columns];
                      cols[idx].links = [
                        ...(cols[idx].links || []),
                        { id: uuidv4(), label: "Link", url: "#" },
                      ];
                      updateProp("columns", cols);
                    }}
                    className="w-full px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-500 hover:border-indigo-500 hover:text-indigo-600"
                  >
                    + Add Link
                  </button>
                </div>
              </div>
            ))}
          </div>
        </SectionBlock>

        <SectionBlock title="Newsletter">
          <label className="flex items-center gap-2 mb-3 cursor-pointer">
            <input
              type="checkbox"
              checked={p.showNewsletter || false}
              onChange={(e) => updateProp("showNewsletter", e.target.checked)}
              className="rounded border-gray-300 text-indigo-600"
            />
            <span className="text-sm text-gray-700">
              Show Newsletter Signup
            </span>
          </label>
          {p.showNewsletter && p.newsletter && (
            <div className="space-y-3">
              <input
                type="text"
                placeholder="Section title"
                value={p.newsletter.title || ""}
                onChange={(e) =>
                  updateProp("newsletter", {
                    ...p.newsletter,
                    title: e.target.value,
                  })
                }
                className={INPUT_CLS}
              />
              <input
                type="text"
                placeholder="Placeholder text"
                value={p.newsletter.placeholder || ""}
                onChange={(e) =>
                  updateProp("newsletter", {
                    ...p.newsletter,
                    placeholder: e.target.value,
                  })
                }
                className={INPUT_CLS}
              />
              <input
                type="text"
                placeholder="Button text"
                value={p.newsletter.buttonText || ""}
                onChange={(e) =>
                  updateProp("newsletter", {
                    ...p.newsletter,
                    buttonText: e.target.value,
                  })
                }
                className={INPUT_CLS}
              />
              <LabeledField label="Success Message">
                <input
                  type="text"
                  value={p.newsletter.successMessage || ""}
                  onChange={(e) =>
                    updateProp("newsletter", {
                      ...p.newsletter,
                      successMessage: e.target.value,
                    })
                  }
                  className={INPUT_CLS}
                />
              </LabeledField>
              <LabeledField label="Error Message">
                <input
                  type="text"
                  value={p.newsletter.errorMessage || ""}
                  onChange={(e) =>
                    updateProp("newsletter", {
                      ...p.newsletter,
                      errorMessage: e.target.value,
                    })
                  }
                  className={INPUT_CLS}
                />
              </LabeledField>
            </div>
          )}
        </SectionBlock>

        <SectionBlock
          title={`Social Links (${(p.socialLinks || []).length})`}
          action={
            <button
              onClick={() =>
                updateProp("socialLinks", [
                  ...(p.socialLinks || []),
                  { id: uuidv4(), platform: "Twitter", url: "#" },
                ])
              }
              className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
            >
              <Plus className="w-4 h-4" />
            </button>
          }
        >
          <div className="space-y-2">
            {(p.socialLinks || []).map((social, idx) => (
              <div key={idx} className="flex gap-2">
                <input
                  type="text"
                  placeholder="Platform"
                  value={social.platform}
                  onChange={(e) => {
                    const links = [...(p.socialLinks || [])];
                    links[idx] = { ...links[idx], platform: e.target.value };
                    updateProp("socialLinks", links);
                  }}
                  className="w-1/3 px-2 py-1.5 border border-gray-300 rounded text-sm"
                />
                <input
                  type="text"
                  placeholder="URL"
                  value={social.url || ""}
                  onChange={(e) => {
                    const links = [...(p.socialLinks || [])];
                    links[idx] = { ...links[idx], url: e.target.value };
                    updateProp("socialLinks", links);
                  }}
                  className="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm"
                />
                <button
                  onClick={() => {
                    const links = [...(p.socialLinks || [])];
                    links.splice(idx, 1);
                    updateProp("socialLinks", links);
                  }}
                  className="p-1.5 text-red-600 hover:bg-red-50 rounded"
                >
                  <X className="w-3 h-3" />
                </button>
              </div>
            ))}
          </div>
        </SectionBlock>

        <SectionBlock title="Copyright">
          <textarea
            value={p.copyright || ""}
            rows={2}
            onChange={(e) => updateProp("copyright", e.target.value)}
            placeholder={` ${new Date().getFullYear()} Brand. All rights reserved.`}
            className={INPUT_CLS}
          />
        </SectionBlock>
      </>
    );
  };

  const isHeader = section.type === SECTION_TYPES.HEADER;
  const isFooter = section.type === SECTION_TYPES.FOOTER;

  return (
    <div className="h-full flex flex-col bg-white border-l border-gray-200">
      <PanelHeader
        title={
          isHeader
            ? "Header Settings"
            : isFooter
              ? "Footer Settings"
              : "Section Properties"
        }
        subtitle={
          !isHeader && !isFooter
            ? `${section.type} section${section.props.carousel?.enabled ? "  Carousel" : ""}`
            : undefined
        }
        onClose={() => selectSection(null)}
      />

      <div className="flex-1 overflow-y-auto p-4">
        {isHeader && renderHeaderProperties()}
        {isFooter && renderFooterProperties()}

        {!isHeader && !isFooter && (
          <>
            <SectionBlock title="Section ID">
              <div className="flex items-center gap-2">
                <input
                  type="text"
                  value={section.id}
                  readOnly
                  className="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm"
                />
                <button
                  onClick={() => navigator.clipboard.writeText(section.id)}
                  className="px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm"
                >
                  Copy
                </button>
              </div>
              <p className="text-xs text-gray-500 mt-1">
                Use #{section.id} for navigation links
              </p>
            </SectionBlock>

            {renderVariantSelector()}

            <SectionBlock title="Section Style">
              <div className="space-y-4">
                <LabeledField label="Background Type">
                  <select
                    value={section.style?.backgroundType || "color"}
                    onChange={(e) =>
                      updateStyle("backgroundType", e.target.value)
                    }
                    className={INPUT_CLS}
                  >
                    <option value="color">Solid Color</option>
                    <option value="gradient">Gradient</option>
                    <option value="image">Image</option>
                  </select>
                </LabeledField>
                {(!section.style?.backgroundType ||
                  section.style.backgroundType === "color") && (
                  <ColorField
                    label="Background Color"
                    value={section.style?.backgroundColor || "#ffffff"}
                    onChange={(v) => updateStyle("backgroundColor", v)}
                  />
                )}
                {section.style?.backgroundType === "gradient" && (
                  <LabeledField label="Gradient CSS">
                    <input
                      type="text"
                      value={
                        section.style?.backgroundGradient ||
                        "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
                      }
                      onChange={(e) =>
                        updateStyle("backgroundGradient", e.target.value)
                      }
                      placeholder="linear-gradient(...)"
                      className={INPUT_CLS}
                    />
                  </LabeledField>
                )}
                {section.style?.backgroundType === "image" && (
                  <div>
                    {section.style?.backgroundImage && (
                      <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                        <img
                          src={section.style.backgroundImage}
                          alt="Background"
                          className="w-full h-28 object-cover rounded"
                        />
                        <button
                          onClick={() => updateStyle("backgroundImage", "")}
                          className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                        >
                          <X className="w-3 h-3" />
                        </button>
                      </div>
                    )}
                    <FileButton
                      label={
                        section.style?.backgroundImage
                          ? "Change Image"
                          : "Upload Image"
                      }
                      onClick={() =>
                        openFilePicker({
                          sectionId: section.id,
                          field: "backgroundImage",
                          isStyle: true,
                        })
                      }
                    />
                    {section.style?.backgroundImage && (
                      <div className="mt-3">
                        <label className="block text-xs text-gray-600 mb-1">
                          Overlay Opacity
                        </label>
                        <input
                          type="range"
                          min={0}
                          max={100}
                          value={Math.round(
                            (section.style?.backgroundOverlay || 0) * 100,
                          )}
                          onChange={(e) =>
                            updateStyle(
                              "backgroundOverlay",
                              e.target.value / 100,
                            )
                          }
                          className="w-full"
                        />
                        <span className="text-xs text-gray-500">
                          {Math.round(
                            (section.style?.backgroundOverlay || 0) * 100,
                          )}
                          %
                        </span>
                      </div>
                    )}
                  </div>
                )}
                <LabeledField label="Padding Top (rem)">
                  <input
                    type="number"
                    step={0.5}
                    value={parseFloat(section.style?.padding?.top) ?? 4}
                    onChange={(e) =>
                      updateStyle("padding.top", `${e.target.value}rem`)
                    }
                    className={INPUT_CLS}
                  />
                </LabeledField>
                <LabeledField label="Padding Bottom (rem)">
                  <input
                    type="number"
                    step={0.5}
                    value={parseFloat(section.style?.padding?.bottom) ?? 4}
                    onChange={(e) =>
                      updateStyle("padding.bottom", `${e.target.value}rem`)
                    }
                    className={INPUT_CLS}
                  />
                </LabeledField>
              </div>
            </SectionBlock>

            {renderCarouselSettings()}

            <SectionBlock title="Content">
              {section.props.heading !== undefined &&
                renderInput("Heading", section.props.heading, (v) =>
                  updateProp("heading", v),
                )}
              {"headingColor" in section.props && (
                <ColorField
                  label="Heading Color"
                  value={section.props.headingColor || "#111827"}
                  onChange={(v) => updateProp("headingColor", v)}
                />
              )}
              {section.props.subheading !== undefined &&
                renderInput(
                  "Subheading",
                  section.props.subheading,
                  (v) => updateProp("subheading", v),
                  "textarea",
                )}
              {"subheadingColor" in section.props && (
                <ColorField
                  label="Subheading Color"
                  value={section.props.subheadingColor || "#6b7280"}
                  onChange={(v) => updateProp("subheadingColor", v)}
                />
              )}
              {section.props.content !== undefined &&
                renderInput(
                  "Content (HTML)",
                  section.props.content,
                  (v) => updateProp("content", v),
                  "textarea",
                )}
              {"contentColor" in section.props && (
                <ColorField
                  label="Content Color"
                  value={section.props.contentColor || "#374151"}
                  onChange={(v) => updateProp("contentColor", v)}
                />
              )}
              {section.props.image !== undefined &&
                renderInput(
                  "Image",
                  section.props.image,
                  (v) => updateProp("image", v),
                  "image",
                )}
              {section.props.imagePosition !== undefined &&
                renderInput(
                  "Image Position",
                  section.props.imagePosition,
                  Object.assign((v) => updateProp("imagePosition", v), {
                    options: [
                      { value: "left", label: "Left" },
                      { value: "right", label: "Right" },
                    ],
                  }),
                  "select",
                )}
              {section.props.ctaText !== undefined &&
                renderInput("CTA Text", section.props.ctaText, (v) =>
                  updateProp("ctaText", v),
                )}
              {"ctaColor" in section.props && (
                <ColorField
                  label="CTA Button Color"
                  value={section.props.ctaColor || "#6366f1"}
                  onChange={(v) => updateProp("ctaColor", v)}
                />
              )}
              {"ctaTextColor" in section.props && (
                <ColorField
                  label="CTA Text Color"
                  value={section.props.ctaTextColor || "#ffffff"}
                  onChange={(v) => updateProp("ctaTextColor", v)}
                />
              )}
              {section.props.ctaLink !== undefined &&
                renderInput("CTA Link", section.props.ctaLink, (v) =>
                  updateProp("ctaLink", v),
                )}
              {section.props.secondaryCtaText !== undefined &&
                renderInput(
                  "Secondary CTA Text",
                  section.props.secondaryCtaText,
                  (v) => updateProp("secondaryCtaText", v),
                )}
              {"secondaryCtaBorderColor" in section.props && (
                <ColorField
                  label="Secondary CTA Border"
                  value={section.props.secondaryCtaBorderColor || "#e5e7eb"}
                  onChange={(v) => updateProp("secondaryCtaBorderColor", v)}
                />
              )}
              {"secondaryCtaTextColor" in section.props && (
                <ColorField
                  label="Secondary CTA Text Color"
                  value={section.props.secondaryCtaTextColor || "#374151"}
                  onChange={(v) => updateProp("secondaryCtaTextColor", v)}
                />
              )}
              {section.props.secondaryCtaLink !== undefined &&
                renderInput(
                  "Secondary CTA Link",
                  section.props.secondaryCtaLink,
                  (v) => updateProp("secondaryCtaLink", v),
                )}
              {section.props.alignment !== undefined &&
                renderInput(
                  "Text Alignment",
                  section.props.alignment,
                  Object.assign((v) => updateProp("alignment", v), {
                    options: [
                      { value: "left", label: "Left" },
                      { value: "center", label: "Center" },
                      { value: "right", label: "Right" },
                    ],
                  }),
                  "select",
                )}
              {section.props.columns !== undefined &&
                typeof section.props.columns === "number" &&
                renderInput(
                  "Columns",
                  section.props.columns,
                  (v) => updateProp("columns", parseInt(v)),
                  "number",
                )}

              {section.props.primaryButton !== undefined && (
                <>
                  <div className="mb-3 p-3 bg-gray-50 rounded-lg">
                    <p className="text-xs font-semibold text-gray-600 mb-2">
                      Primary Button
                    </p>
                    <input
                      type="text"
                      placeholder="Text"
                      value={section.props.primaryButton?.text || ""}
                      onChange={(e) =>
                        updateProp("primaryButton.text", e.target.value)
                      }
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Link"
                      value={section.props.primaryButton?.link || "#"}
                      onChange={(e) =>
                        updateProp("primaryButton.link", e.target.value)
                      }
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <ColorField
                      label="Background"
                      value={
                        section.props.primaryButton?.backgroundColor ||
                        "#ffffff"
                      }
                      onChange={(v) =>
                        updateProp("primaryButton.backgroundColor", v)
                      }
                    />
                    <div className="mt-2">
                      <ColorField
                        label="Text Color"
                        value={
                          section.props.primaryButton?.textColor || "#6366f1"
                        }
                        onChange={(v) =>
                          updateProp("primaryButton.textColor", v)
                        }
                      />
                    </div>
                  </div>
                  <div className="mb-3 p-3 bg-gray-50 rounded-lg">
                    <p className="text-xs font-semibold text-gray-600 mb-2">
                      Secondary Button
                    </p>
                    <input
                      type="text"
                      placeholder="Text"
                      value={section.props.secondaryButton?.text || ""}
                      onChange={(e) =>
                        updateProp("secondaryButton.text", e.target.value)
                      }
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Link"
                      value={section.props.secondaryButton?.link || "#"}
                      onChange={(e) =>
                        updateProp("secondaryButton.link", e.target.value)
                      }
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <ColorField
                      label="Border Color"
                      value={
                        section.props.secondaryButton?.borderColor || "#ffffff"
                      }
                      onChange={(v) =>
                        updateProp("secondaryButton.borderColor", v)
                      }
                    />
                    <div className="mt-2">
                      <ColorField
                        label="Text Color"
                        value={
                          section.props.secondaryButton?.textColor || "#ffffff"
                        }
                        onChange={(v) =>
                          updateProp("secondaryButton.textColor", v)
                        }
                      />
                    </div>
                  </div>
                </>
              )}

              {section.props.submitText !== undefined &&
                renderInput(
                  "Submit Button Text",
                  section.props.submitText,
                  (v) => updateProp("submitText", v),
                )}
              {section.props.placeholder !== undefined &&
                renderInput(
                  "Placeholder Text",
                  section.props.placeholder,
                  (v) => updateProp("placeholder", v),
                )}
              {section.props.buttonText !== undefined &&
                renderInput("Button Text", section.props.buttonText, (v) =>
                  updateProp("buttonText", v),
                )}
            </SectionBlock>

            {"iconBackground" in section.props && (
              <SectionBlock title="Colors">
                <div className="space-y-3">
                  {"iconBackground" in section.props && (
                    <ColorField
                      label="Icon Background"
                      value={section.props.iconBackground || "#6366f1"}
                      onChange={(v) => updateProp("iconBackground", v)}
                    />
                  )}
                  {"iconColor" in section.props && (
                    <ColorField
                      label="Icon Color"
                      value={section.props.iconColor || "#ffffff"}
                      onChange={(v) => updateProp("iconColor", v)}
                    />
                  )}
                  {"cardBackground" in section.props && (
                    <ColorField
                      label="Card Background"
                      value={section.props.cardBackground || "#ffffff"}
                      onChange={(v) => updateProp("cardBackground", v)}
                    />
                  )}
                  {"cardBorderColor" in section.props && (
                    <ColorField
                      label="Card Border Color"
                      value={section.props.cardBorderColor || "#f3f4f6"}
                      onChange={(v) => updateProp("cardBorderColor", v)}
                    />
                  )}
                  {"titleColor" in section.props && (
                    <ColorField
                      label="Title Color"
                      value={section.props.titleColor || "#111827"}
                      onChange={(v) => updateProp("titleColor", v)}
                    />
                  )}
                  {"descriptionColor" in section.props && (
                    <ColorField
                      label="Description Color"
                      value={section.props.descriptionColor || "#6b7280"}
                      onChange={(v) => updateProp("descriptionColor", v)}
                    />
                  )}
                  {"metricColor" in section.props && (
                    <ColorField
                      label="Metric Color"
                      value={section.props.metricColor || "#6366f1"}
                      onChange={(v) => updateProp("metricColor", v)}
                    />
                  )}
                  {"valueColor" in section.props && (
                    <ColorField
                      label="Value Color"
                      value={section.props.valueColor || "#6366f1"}
                      onChange={(v) => updateProp("valueColor", v)}
                    />
                  )}
                  {"labelColor" in section.props && (
                    <ColorField
                      label="Label Color"
                      value={section.props.labelColor || "#111827"}
                      onChange={(v) => updateProp("labelColor", v)}
                    />
                  )}
                  {"quoteColor" in section.props && (
                    <ColorField
                      label="Quote Color"
                      value={section.props.quoteColor || "#374151"}
                      onChange={(v) => updateProp("quoteColor", v)}
                    />
                  )}
                  {"nameColor" in section.props && (
                    <ColorField
                      label="Name Color"
                      value={section.props.nameColor || "#111827"}
                      onChange={(v) => updateProp("nameColor", v)}
                    />
                  )}
                  {"roleColor" in section.props && (
                    <ColorField
                      label="Role Color"
                      value={section.props.roleColor || "#6366f1"}
                      onChange={(v) => updateProp("roleColor", v)}
                    />
                  )}
                  {"starColor" in section.props && (
                    <ColorField
                      label="Star Color"
                      value={section.props.starColor || "#f59e0b"}
                      onChange={(v) => updateProp("starColor", v)}
                    />
                  )}
                  {"bioColor" in section.props && (
                    <ColorField
                      label="Bio Color"
                      value={section.props.bioColor || "#6b7280"}
                      onChange={(v) => updateProp("bioColor", v)}
                    />
                  )}
                  {"buttonColor" in section.props && (
                    <ColorField
                      label="Button Color"
                      value={section.props.buttonColor || "#6366f1"}
                      onChange={(v) => updateProp("buttonColor", v)}
                    />
                  )}
                  {"buttonTextColor" in section.props && (
                    <ColorField
                      label="Button Text Color"
                      value={section.props.buttonTextColor || "#ffffff"}
                      onChange={(v) => updateProp("buttonTextColor", v)}
                    />
                  )}
                  {"highlightColor" in section.props && (
                    <ColorField
                      label="Highlight Color"
                      value={section.props.highlightColor || "#6366f1"}
                      onChange={(v) => updateProp("highlightColor", v)}
                    />
                  )}
                  {"checkColor" in section.props && (
                    <ColorField
                      label="Check Icon Color"
                      value={section.props.checkColor || "#22c55e"}
                      onChange={(v) => updateProp("checkColor", v)}
                    />
                  )}
                  {"badgeBackground" in section.props && (
                    <ColorField
                      label="Badge Background"
                      value={section.props.badgeBackground || "#6366f1"}
                      onChange={(v) => updateProp("badgeBackground", v)}
                    />
                  )}
                  {"badgeTextColor" in section.props && (
                    <ColorField
                      label="Badge Text Color"
                      value={section.props.badgeTextColor || "#ffffff"}
                      onChange={(v) => updateProp("badgeTextColor", v)}
                    />
                  )}
                  {"inputBackground" in section.props && (
                    <ColorField
                      label="Input Background"
                      value={
                        section.props.inputBackground || "rgba(255,255,255,0.1)"
                      }
                      onChange={(v) => updateProp("inputBackground", v)}
                    />
                  )}
                  {"inputBorderColor" in section.props && (
                    <ColorField
                      label="Input Border"
                      value={section.props.inputBorderColor || "#e5e7eb"}
                      onChange={(v) => updateProp("inputBorderColor", v)}
                    />
                  )}
                  {"benefitColor" in section.props && (
                    <ColorField
                      label="Benefit Text Color"
                      value={
                        section.props.benefitColor || "rgba(255,255,255,0.75)"
                      }
                      onChange={(v) => updateProp("benefitColor", v)}
                    />
                  )}
                </div>
              </SectionBlock>
            )}

            {(section.props.submitText !== undefined ||
              section.props.buttonText !== undefined) && (
              <SectionBlock
                title="Form Submission"
                icon={<Link className="w-4 h-4 text-indigo-500" />}
              >
                <div className="space-y-3">
                  {section.props.successMessage !== undefined && (
                    <LabeledField label="Success Message">
                      <input
                        type="text"
                        value={section.props.successMessage || ""}
                        onChange={(e) =>
                          updateProp("successMessage", e.target.value)
                        }
                        className={INPUT_CLS}
                      />
                    </LabeledField>
                  )}
                  {section.props.errorMessage !== undefined && (
                    <LabeledField label="Error Message">
                      <input
                        type="text"
                        value={section.props.errorMessage || ""}
                        onChange={(e) =>
                          updateProp("errorMessage", e.target.value)
                        }
                        className={INPUT_CLS}
                      />
                    </LabeledField>
                  )}
                </div>
              </SectionBlock>
            )}

            {section.props.features &&
              section.type !== "cta" &&
              renderArrayEditor(
                "Features",
                "features",
                {
                  icon: "zap",
                  title: "New Feature",
                  description: "Feature description",
                },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Icon name"
                      value={item.icon || ""}
                      onChange={(e) => update("icon", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Title"
                      value={item.title || ""}
                      onChange={(e) => update("title", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <textarea
                      placeholder="Description"
                      value={item.description || ""}
                      onChange={(e) => update("description", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                      rows={2}
                    />
                  </>
                ),
              )}
            {section.props.features &&
              section.type === "cta" &&
              renderArrayEditor(
                "Features List",
                "features",
                "New Feature",
                (item, idx) => (
                  <input
                    type="text"
                    value={item}
                    onChange={(e) => {
                      const arr = [...section.props.features];
                      arr[idx] = e.target.value;
                      updateProp("features", arr);
                    }}
                    className={INPUT_CLS}
                  />
                ),
              )}
            {section.props.benefits &&
              section.type !== "newsletter" &&
              renderArrayEditor(
                "Benefits",
                "benefits",
                {
                  icon: "check-circle",
                  title: "New Benefit",
                  description: "Benefit description",
                  metric: "",
                },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Icon name"
                      value={item.icon || ""}
                      onChange={(e) => update("icon", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Title"
                      value={item.title || ""}
                      onChange={(e) => update("title", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <textarea
                      placeholder="Description"
                      value={item.description || ""}
                      onChange={(e) => update("description", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                      rows={2}
                    />
                    <input
                      type="text"
                      placeholder="Metric"
                      value={item.metric || ""}
                      onChange={(e) => update("metric", e.target.value)}
                      className={INPUT_CLS}
                    />
                  </>
                ),
              )}
            {section.props.benefits &&
              section.type === "newsletter" &&
              renderArrayEditor(
                "Benefits",
                "benefits",
                "New Benefit",
                (item, idx) => (
                  <input
                    type="text"
                    value={item}
                    onChange={(e) => {
                      const arr = [...section.props.benefits];
                      arr[idx] = e.target.value;
                      updateProp("benefits", arr);
                    }}
                    className={INPUT_CLS}
                  />
                ),
              )}
            {section.props.stats &&
              renderArrayEditor(
                "Statistics",
                "stats",
                { value: "0", label: "Stat Label", description: "" },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Value"
                      value={item.value || ""}
                      onChange={(e) => update("value", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Label"
                      value={item.label || ""}
                      onChange={(e) => update("label", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Description"
                      value={item.description || ""}
                      onChange={(e) => update("description", e.target.value)}
                      className={INPUT_CLS}
                    />
                  </>
                ),
              )}
            {section.props.steps &&
              renderArrayEditor(
                "Process Steps",
                "steps",
                {
                  icon: "circle",
                  title: "Step",
                  description: "Description",
                  duration: "",
                  number: "",
                },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Icon name"
                      value={item.icon || ""}
                      onChange={(e) => update("icon", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Number"
                      value={item.number || ""}
                      onChange={(e) => update("number", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Title"
                      value={item.title || ""}
                      onChange={(e) => update("title", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <textarea
                      placeholder="Description"
                      value={item.description || ""}
                      onChange={(e) => update("description", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                      rows={2}
                    />
                    <input
                      type="text"
                      placeholder="Duration"
                      value={item.duration || ""}
                      onChange={(e) => update("duration", e.target.value)}
                      className={INPUT_CLS}
                    />
                  </>
                ),
              )}
            {section.props.logos &&
              renderArrayEditor(
                "Logos",
                "logos",
                { image: "", name: "Company", width: "120" },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Company Name"
                      value={item.name || ""}
                      onChange={(e) => update("name", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <div className="mb-3">
                      {item.image && (
                        <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                          <img
                            src={item.image}
                            alt={item.name}
                            className="w-full h-16 object-contain"
                          />
                          <button
                            onClick={() => update("image", "")}
                            className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                          >
                            <X className="w-3 h-3" />
                          </button>
                        </div>
                      )}
                      <FileButton
                        label={item.image ? "Change Logo" : "Upload Logo"}
                        onClick={() =>
                          openFilePicker({
                            sectionId: section.id,
                            arrayPath: "logos",
                            index: idx,
                            field: "image",
                          })
                        }
                      />
                    </div>
                  </>
                ),
              )}
            {section.props.testimonials &&
              renderArrayEditor(
                "Testimonials",
                "testimonials",
                {
                  name: "Name",
                  role: "Role",
                  content: "Testimonial content",
                  avatar: "",
                  rating: 5,
                },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Name"
                      value={item.name || ""}
                      onChange={(e) => update("name", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Role"
                      value={item.role || ""}
                      onChange={(e) => update("role", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <textarea
                      placeholder="Content"
                      value={item.content || ""}
                      onChange={(e) => update("content", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                      rows={3}
                    />
                    <div className="mb-3">
                      {item.avatar && (
                        <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                          <img
                            src={item.avatar}
                            alt="Avatar"
                            className="w-full h-24 object-cover rounded"
                          />
                          <button
                            onClick={() => update("avatar", "")}
                            className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                          >
                            <X className="w-3 h-3" />
                          </button>
                        </div>
                      )}
                      <FileButton
                        label={item.avatar ? "Change Avatar" : "Upload Avatar"}
                        onClick={() =>
                          openFilePicker({
                            sectionId: section.id,
                            arrayPath: "testimonials",
                            index: idx,
                            field: "avatar",
                          })
                        }
                      />
                    </div>
                    <input
                      type="number"
                      placeholder="Rating (1-5)"
                      value={item.rating || 5}
                      min={1}
                      max={5}
                      onChange={(e) =>
                        update("rating", parseInt(e.target.value))
                      }
                      className={`${INPUT_CLS} mb-2`}
                    />
                  </>
                ),
              )}
            {section.props.plans &&
              renderArrayEditor(
                "Pricing Plans",
                "plans",
                {
                  name: "Plan Name",
                  price: "$0",
                  period: "month",
                  description: "",
                  features: [],
                  ctaText: "Get Started",
                  ctaLink: "#",
                  highlighted: false,
                  badge: "",
                  savings: "",
                },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Name"
                      value={item.name || ""}
                      onChange={(e) => update("name", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Price"
                      value={item.price || ""}
                      onChange={(e) => update("price", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Period"
                      value={item.period || ""}
                      onChange={(e) => update("period", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Description"
                      value={item.description || ""}
                      onChange={(e) => update("description", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="CTA Text"
                      value={item.ctaText || ""}
                      onChange={(e) => update("ctaText", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="CTA Link"
                      value={item.ctaLink || ""}
                      onChange={(e) => update("ctaLink", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <div className="mb-3">
                      <label className="block text-xs font-medium text-gray-700 mb-1">
                        Features (one per line)
                      </label>
                      <textarea
                        value={(item.features || []).join("\n")}
                        rows={4}
                        onChange={(e) =>
                          update(
                            "features",
                            e.target.value.split("\n").filter((f) => f.trim()),
                          )
                        }
                        className={INPUT_CLS}
                      />
                    </div>
                    <label className="flex items-center gap-2 mb-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={item.highlighted || false}
                        onChange={(e) =>
                          update("highlighted", e.target.checked)
                        }
                        className="rounded border-gray-300 text-indigo-600"
                      />
                      <span className="text-sm text-gray-700">
                        Highlighted Plan
                      </span>
                    </label>
                    {item.highlighted && (
                      <input
                        type="text"
                        placeholder="Badge Text"
                        value={item.badge || ""}
                        onChange={(e) => update("badge", e.target.value)}
                        className={`${INPUT_CLS} mb-2`}
                      />
                    )}
                    <input
                      type="text"
                      placeholder="Savings Tag"
                      value={item.savings || ""}
                      onChange={(e) => update("savings", e.target.value)}
                      className={INPUT_CLS}
                    />
                  </>
                ),
              )}
            {section.props.fields &&
              renderArrayEditor(
                "Form Fields",
                "fields",
                {
                  type: "text",
                  label: "Field Label",
                  placeholder: "",
                  required: false,
                },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Label"
                      value={item.label || ""}
                      onChange={(e) => update("label", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Placeholder"
                      value={item.placeholder || ""}
                      onChange={(e) => update("placeholder", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <select
                      value={item.type || "text"}
                      onChange={(e) => update("type", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    >
                      <option value="text">Text</option>
                      <option value="email">Email</option>
                      <option value="tel">Phone</option>
                      <option value="textarea">Textarea</option>
                    </select>
                    <label className="flex items-center gap-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={item.required || false}
                        onChange={(e) => update("required", e.target.checked)}
                        className="rounded border-gray-300 text-indigo-600"
                      />
                      <span className="text-sm text-gray-700">Required</span>
                    </label>
                  </>
                ),
              )}
            {section.props.faqs &&
              renderArrayEditor(
                "FAQ Items",
                "faqs",
                { question: "Question?", answer: "Answer" },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Question"
                      value={item.question || ""}
                      onChange={(e) => update("question", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <textarea
                      placeholder="Answer"
                      value={item.answer || ""}
                      onChange={(e) => update("answer", e.target.value)}
                      className={INPUT_CLS}
                      rows={3}
                    />
                  </>
                ),
              )}
            {section.props.members &&
              renderArrayEditor(
                "Team Members",
                "members",
                { name: "Name", role: "Role", bio: "Short bio", image: "" },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Name"
                      value={item.name || ""}
                      onChange={(e) => update("name", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Role"
                      value={item.role || ""}
                      onChange={(e) => update("role", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <textarea
                      placeholder="Bio"
                      value={item.bio || ""}
                      onChange={(e) => update("bio", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                      rows={2}
                    />
                    <div className="mb-3">
                      {item.image && (
                        <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                          <img
                            src={item.image}
                            alt="Preview"
                            className="w-full h-28 object-cover rounded"
                          />
                          <button
                            onClick={() => update("image", "")}
                            className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                          >
                            <X className="w-3 h-3" />
                          </button>
                        </div>
                      )}
                      <FileButton
                        label={item.image ? "Change Photo" : "Upload Photo"}
                        onClick={() =>
                          openFilePicker({
                            sectionId: section.id,
                            arrayPath: "members",
                            index: idx,
                            field: "image",
                          })
                        }
                      />
                    </div>
                  </>
                ),
              )}
            {section.props.studies &&
              renderArrayEditor(
                "Case Studies",
                "studies",
                {
                  title: "Case Study",
                  client: "Client",
                  description: "Overview",
                  image: "",
                  link: "#",
                  results: [],
                  metrics: [],
                },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Title"
                      value={item.title || ""}
                      onChange={(e) => update("title", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Client"
                      value={item.client || ""}
                      onChange={(e) => update("client", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <textarea
                      placeholder="Description"
                      value={item.description || ""}
                      onChange={(e) => update("description", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                      rows={2}
                    />
                    <input
                      type="text"
                      placeholder="Link"
                      value={item.link || "#"}
                      onChange={(e) => update("link", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <div className="mb-3">
                      {item.image && (
                        <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                          <img
                            src={item.image}
                            alt="Cover"
                            className="w-full h-28 object-cover rounded"
                          />
                          <button
                            onClick={() => update("image", "")}
                            className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                          >
                            <X className="w-3 h-3" />
                          </button>
                        </div>
                      )}
                      <FileButton
                        label={item.image ? "Change Image" : "Upload Image"}
                        onClick={() =>
                          openFilePicker({
                            sectionId: section.id,
                            arrayPath: "studies",
                            index: idx,
                            field: "image",
                          })
                        }
                      />
                    </div>
                    <div className="mb-2">
                      <label className="block text-xs font-medium text-gray-700 mb-1">
                        Results (one per line)
                      </label>
                      <textarea
                        value={(item.results || []).join("\n")}
                        rows={3}
                        onChange={(e) =>
                          update(
                            "results",
                            e.target.value.split("\n").filter((r) => r.trim()),
                          )
                        }
                        className={INPUT_CLS}
                      />
                    </div>
                  </>
                ),
              )}
            {section.props.badges &&
              renderArrayEditor(
                "Trust Badges",
                "badges",
                {
                  icon: "shield",
                  title: "Certification",
                  description: "Description",
                },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Icon name"
                      value={item.icon || ""}
                      onChange={(e) => update("icon", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Title"
                      value={item.title || ""}
                      onChange={(e) => update("title", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Description"
                      value={item.description || ""}
                      onChange={(e) => update("description", e.target.value)}
                      className={INPUT_CLS}
                    />
                  </>
                ),
              )}
            {section.props.awards !== undefined && (
              <div className="mb-6 pb-6 border-b border-gray-200">
                <div className="flex items-center justify-between mb-3">
                  <span className="text-sm font-medium text-gray-900">
                    Awards ({(section.props.awards || []).length})
                  </span>
                  <button
                    onClick={() =>
                      updateProp("awards", [
                        ...(section.props.awards || []),
                        "New Award",
                      ])
                    }
                    className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
                  >
                    <Plus className="w-4 h-4" />
                  </button>
                </div>
                <div className="space-y-2">
                  {(section.props.awards || []).map((award, idx) => (
                    <div key={idx} className="flex gap-2">
                      <input
                        type="text"
                        value={award}
                        onChange={(e) => {
                          const arr = [...section.props.awards];
                          arr[idx] = e.target.value;
                          updateProp("awards", arr);
                        }}
                        className={`${INPUT_CLS} flex-1`}
                      />
                      <button
                        onClick={() => {
                          const arr = [...section.props.awards];
                          arr.splice(idx, 1);
                          updateProp("awards", arr);
                        }}
                        className="p-2 text-red-500 hover:bg-red-50 rounded"
                      >
                        <X className="w-3.5 h-3.5" />
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}
            {section.props.items &&
              section.type === "gallery" &&
              renderArrayEditor(
                "Gallery Items",
                "items",
                { image: "", title: "New Item", category: "", description: "" },
                (item, idx, update) => (
                  <>
                    <input
                      type="text"
                      placeholder="Title"
                      value={item.title || ""}
                      onChange={(e) => update("title", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <input
                      type="text"
                      placeholder="Category"
                      value={item.category || ""}
                      onChange={(e) => update("category", e.target.value)}
                      className={`${INPUT_CLS} mb-2`}
                    />
                    <div className="mb-3">
                      {item.image && (
                        <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                          <img
                            src={item.image}
                            alt={item.title}
                            className="w-full h-28 object-cover rounded"
                          />
                          <button
                            onClick={() => update("image", "")}
                            className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                          >
                            <X className="w-3 h-3" />
                          </button>
                        </div>
                      )}
                      <FileButton
                        label={item.image ? "Change Image" : "Upload Image"}
                        onClick={() =>
                          openFilePicker({
                            sectionId: section.id,
                            arrayPath: "items",
                            index: idx,
                            field: "image",
                          })
                        }
                      />
                    </div>
                    <textarea
                      placeholder="Description"
                      value={item.description || ""}
                      onChange={(e) => update("description", e.target.value)}
                      className={INPUT_CLS}
                      rows={2}
                    />
                  </>
                ),
              )}
          </>
        )}
      </div>

      {showFilePicker && selectedWebsite?.id && (
        <FilePickerModal
          isOpen={showFilePicker}
          onClose={() => {
            setShowFilePicker(false);
            setCurrentImageField(null);
          }}
          onSelectFile={handleFileSelect}
          websiteId={selectedWebsite.id}
          allowedTypes={["image"]}
        />
      )}
    </div>
  );
}

function PanelHeader({ title, subtitle, onClose }) {
  return (
    <div className="p-4 border-b border-gray-200">
      <div className="flex items-center justify-between mb-1">
        <h3 className="text-sm font-semibold text-gray-900">{title}</h3>
        <button
          onClick={onClose}
          className="p-1.5 hover:bg-gray-100 rounded-lg transition-colors"
        >
          <X className="w-4 h-4 text-gray-500" />
        </button>
      </div>
      {subtitle && (
        <p className="text-xs text-gray-500 capitalize">{subtitle}</p>
      )}
    </div>
  );
}

function SectionBlock({ title, children, action, icon }) {
  return (
    <div className="mb-6 pb-6 border-b border-gray-200">
      <div className="flex items-center justify-between mb-3">
        <h4 className="flex items-center gap-1.5 text-xs font-semibold text-gray-500 uppercase tracking-wide">
          {icon}
          {title}
        </h4>
        {action}
      </div>
      {children}
    </div>
  );
}

function LabeledField({ label, children }) {
  return (
    <div>
      <label className="block text-sm font-medium text-gray-700 mb-1.5">
        {label}
      </label>
      {children}
    </div>
  );
}

function ColorField({ label, value, onChange }) {
  return (
    <LabeledField label={label}>
      <div className="flex gap-2">
        <input
          type="color"
          value={value && value.startsWith("#") ? value : "#6366f1"}
          onChange={(e) => onChange(e.target.value)}
          className="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
        />
        <input
          type="text"
          value={value || ""}
          onChange={(e) => onChange(e.target.value)}
          className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"
        />
      </div>
    </LabeledField>
  );
}

function FileButton({ label, onClick }) {
  return (
    <button
      onClick={onClick}
      className="w-full px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all flex items-center justify-center gap-2 text-sm text-gray-600"
    >
      <ImageIcon className="w-4 h-4" />
      {label}
    </button>
  );
}

SectionLibrary.jsx:
import { SECTION_LIBRARY, SECTION_TYPES } from "../../../utils/sectionLibrary";
import * as LucideIcons from "lucide-react";

const CATEGORIES = [
  { name: "Structure", types: ["header", "footer"], icon: "layout-template" },
  { name: "Hero", types: ["hero"], icon: "layout" },
  { name: "Features & Benefits", types: ["features", "benefits"], icon: "zap" },
  { name: "Stats & Process", types: ["stats", "process"], icon: "bar-chart" },
  { name: "Content & Media", types: ["content", "gallery"], icon: "image" },
  { name: "Social Proof", types: ["testimonials", "team", "case-studies"], icon: "users" },
  { name: "Trust & Logos", types: ["logos", "trust"], icon: "shield" },
  { name: "Conversion", types: ["cta", "pricing", "contact", "newsletter"], icon: "target" },
  { name: "Information", types: ["faq"], icon: "help-circle" },
];

const getIcon = (iconName) => {
  if (!iconName) return LucideIcons.Box;
  const pascal = iconName
    .split("-")
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join("");
  return LucideIcons[pascal] || LucideIcons.Box;
};

export default function SectionLibrary({ onAddSection }) {
  return (
    <div className="h-full flex flex-col bg-white border-r border-gray-200">
      <div className="p-5 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50">
        <div className="flex items-center gap-3">
          <div className="w-9 h-9 bg-indigo-100 rounded-lg flex items-center justify-center">
            <LucideIcons.Plus className="w-5 h-5 text-indigo-600" />
          </div>
          <div>
            <h3 className="text-sm font-bold text-gray-900">Add Sections</h3>
            <p className="text-xs text-gray-500">Click to add to canvas</p>
          </div>
        </div>
      </div>

      <div className="flex-1 overflow-y-auto p-4 space-y-6">
        {CATEGORIES.map((cat) => {
          const items = SECTION_LIBRARY.filter((item) => cat.types.includes(item.type));
          if (items.length === 0) return null;
          const CatIcon = getIcon(cat.icon);
          return (
            <div key={cat.name}>
              <div className="flex items-center gap-2 mb-3">
                <div className="w-5 h-5 bg-gray-100 rounded flex items-center justify-center">
                  <CatIcon className="w-3.5 h-3.5 text-gray-500" />
                </div>
                <span className="text-[10px] font-bold text-gray-500 uppercase tracking-widest">{cat.name}</span>
              </div>
              <div className="space-y-2">
                {items.map((item) => {
                  const Icon = getIcon(item.icon);
                  const isStructural = item.type === SECTION_TYPES.HEADER || item.type === SECTION_TYPES.FOOTER;
                  return (
                    <button key={item.id} onClick={() => onAddSection(item)} className="w-full group relative overflow-hidden">
                      <div className={`flex items-center gap-3 p-3 rounded-xl border-2 transition-all bg-white ${isStructural ? "border-indigo-100 hover:border-indigo-400 hover:shadow-md bg-indigo-50/30" : "border-gray-100 hover:border-indigo-400 hover:shadow-md"}`}>
                        <div className={`w-10 h-10 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${isStructural ? "bg-indigo-100 group-hover:bg-indigo-200" : "bg-gray-50 group-hover:bg-indigo-50"}`}>
                          <Icon className={`w-5 h-5 transition-colors ${isStructural ? "text-indigo-600" : "text-gray-500 group-hover:text-indigo-600"}`} />
                        </div>
                        <div className="flex-1 text-left min-w-0">
                          <p className="text-sm font-semibold text-gray-800 group-hover:text-indigo-700 transition-colors">{item.name}</p>
                          <p className="text-xs text-gray-400 capitalize">{item.type} section</p>
                        </div>
                        <LucideIcons.Plus className="w-4 h-4 text-gray-300 group-hover:text-indigo-500 transition-colors flex-shrink-0" />
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          );
        })}
        <div className="pb-4">
          <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 border border-indigo-100">
            <div className="flex items-start gap-2">
              <LucideIcons.Lightbulb className="w-4 h-4 text-indigo-500 mt-0.5 flex-shrink-0" />
              <div>
                <p className="text-xs font-bold text-gray-800 mb-0.5">Pro Tip</p>
                <p className="text-xs text-gray-500 leading-relaxed">
                  Add a Header, then Hero, Features, Stats, Testimonials, CTA, and Footer. Use Properties to control colors and layout.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

SectionRenderer.jsx:
import { SECTION_TYPES } from "../../../utils/sectionLibrary";
import * as LucideIcons from "lucide-react";
import { useState, useEffect, useRef } from "react";
import axiosInstance from "../../../api/axiosInstance";
import { useWebsiteStore } from "../../../store/store";

export default function SectionRenderer({ section, themeColors }) {
  const { selectedWebsite } = useWebsiteStore();
  const [currentSlide, setCurrentSlide] = useState(0);
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const [openSubmenu, setOpenSubmenu] = useState(null);
  const [formState, setFormState] = useState({ loading: false, success: false, error: false, message: "" });
  const carousel = section.props.carousel;
  const variant = section.props.variant || "default";

  useEffect(() => { setCurrentSlide(0); }, [variant]);

  const primaryColor = themeColors?.primary || "#6366f1";

  const isCarousel = variant === "carousel" || carousel?.enabled === true;
  const isSplit = variant === "split";
  const isList = variant === "list";

  const getCarouselItems = () => {
    if (section.props.testimonials) return section.props.testimonials;
    if (section.props.items) return section.props.items;
    if (section.props.logos) return section.props.logos;
    return [];
  };

  useEffect(() => {
    let interval;
    if (isCarousel && carousel?.autoplay) {
      const slides = carousel.slides?.length > 0 ? carousel.slides : getCarouselItems();
      if (slides.length > 1) {
        interval = setInterval(() => {
          setCurrentSlide((p) => (p + 1) % slides.length);
        }, carousel.interval || 5000);
      }
    }
    return () => clearInterval(interval);
  }, [isCarousel, carousel?.autoplay, carousel?.interval]);

  const getIcon = (iconName) => {
    if (!iconName) return null;
    const pascal = iconName.split("-").map((w, i) => (i === 0 ? w : w.charAt(0).toUpperCase() + w.slice(1))).join("");
    return LucideIcons[pascal] || LucideIcons.Box;
  };

  const getSectionStyle = () => {
    const style = { position: "relative" };
    if (section.type === SECTION_TYPES.HEADER || section.type === SECTION_TYPES.FOOTER) return style;

    if (section.style?.padding) {
      if (section.style.padding.top != null) style.paddingTop = section.style.padding.top;
      else style.paddingTop = "4rem";
      if (section.style.padding.bottom != null) style.paddingBottom = section.style.padding.bottom;
      else style.paddingBottom = "4rem";
    } else {
      style.paddingTop = "4rem";
      style.paddingBottom = "4rem";
    }

    if (section.style?.backgroundType === "color") {
      style.backgroundColor = section.style?.backgroundColor || "transparent";
    } else if (section.style?.backgroundType === "gradient") {
      style.background = section.style?.backgroundGradient || "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
    } else if (section.style?.backgroundType === "image" && section.style?.backgroundImage) {
      style.backgroundImage = `url(${section.style.backgroundImage})`;
      style.backgroundSize = "cover";
      style.backgroundPosition = "center";
      style.backgroundRepeat = "no-repeat";
    }
    return style;
  };

  const getOverlayStyle = () => {
    if (section.style?.backgroundType === "image" && section.style?.backgroundImage && section.style?.backgroundOverlay > 0) {
      return { position: "absolute", top: 0, left: 0, right: 0, bottom: 0, backgroundColor: `rgba(0,0,0,${section.style.backgroundOverlay})`, zIndex: 1 };
    }
    return null;
  };

  const textOnBg = (fallback = "#111827") =>
    section.style?.backgroundType === "image" ? "#ffffff" : fallback;

  const CarouselDots = ({ slides, current, onDotClick }) => {
    if (!slides || slides.length <= 1) return null;
    return (
      <div className="absolute bottom-6 left-0 right-0 flex justify-center gap-2 z-20">
        {slides.map((_, i) => (
          <button key={i} onClick={() => onDotClick(i)}
            className={`rounded-full transition-all ${i === current ? "w-8 h-2.5 bg-white" : "w-2.5 h-2.5 bg-white/50 hover:bg-white/80"}`}
          />
        ))}
      </div>
    );
  };

  const CarouselArrows = ({ slides, onPrev, onNext }) => {
    if (!slides || slides.length <= 1) return null;
    return (
      <>
        <button onClick={onPrev} className="absolute left-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-all">
          <LucideIcons.ChevronLeft className="w-5 h-5" />
        </button>
        <button onClick={onNext} className="absolute right-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-all">
          <LucideIcons.ChevronRight className="w-5 h-5" />
        </button>
      </>
    );
  };

  const prev = (len) => setCurrentSlide((p) => (p - 1 + len) % len);
  const next = (len) => setCurrentSlide((p) => (p + 1) % len);

  const handleFormSubmit = async (e, successMessage, errorMessage, setLocalState) => {
    e.preventDefault();
    setLocalState({ loading: true, success: false, error: false, message: "" });
    try {
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      await axiosInstance.post("/forms/submit", {
        website_id: selectedWebsite?.id,
        section_id: section.id,
        section_type: section.type,
        data,
      });
      setLocalState({ loading: false, success: true, error: false, message: successMessage || "Message sent!" });
      e.target.reset();
    } catch {
      setLocalState({ loading: false, success: false, error: true, message: errorMessage || "Something went wrong. Please try again." });
    }
  };

  const renderHeader = () => {
    const p = section.props;
    const containerStyle = {
      height: p.height || "80px",
      backgroundColor: p.transparent ? "transparent" : p.backgroundColor || "#ffffff",
      backdropFilter: p.blur ? "blur(12px)" : "none",
      WebkitBackdropFilter: p.blur ? "blur(12px)" : "none",
      position: p.sticky ? "sticky" : "relative",
      top: 0,
      zIndex: 50,
      borderBottom: p.borderBottom ? `1px solid ${p.borderColor || "#e5e7eb"}` : "none",
    };

    const renderNavLinks = () => (
      <nav className="hidden md:flex items-center gap-6">
        {(p.menu || []).map((item, idx) => (
          <div key={idx} className="relative group/nav">
            <a
              href={item.url || "#"}
              onClick={(e) => e.preventDefault()}
              className="flex items-center gap-1 text-sm font-medium transition-colors hover:opacity-70"
              style={{ color: p.textColor || "#111827" }}
            >
              {item.label}
              {item.hasSubmenu && item.submenu?.length > 0 && (
                <LucideIcons.ChevronDown className="w-3.5 h-3.5" />
              )}
            </a>
            {item.hasSubmenu && item.submenu?.length > 0 && (
              <div className="absolute top-full left-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-100 py-2 opacity-0 invisible group-hover/nav:opacity-100 group-hover/nav:visible transition-all z-50">
                {item.submenu.map((sub, sIdx) => (
                  <a key={sIdx} href={sub.url || "#"} onClick={(e) => e.preventDefault()}
                    className="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 transition-colors">
                    {sub.label}
                  </a>
                ))}
              </div>
            )}
          </div>
        ))}
      </nav>
    );

    const renderSearch = () => p.showSearch && (
      <div className="hidden md:flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-lg">
        <LucideIcons.Search className="w-4 h-4 text-gray-400" />
        <input type="text" placeholder="Search..." className="bg-transparent text-sm outline-none w-32 text-gray-700 placeholder-gray-400" />
      </div>
    );

    const renderCta = () => p.showCta && p.ctaText && (
      <a
        href={p.ctaLink || "#"}
        onClick={(e) => e.preventDefault()}
        className="hidden md:inline-flex items-center px-5 py-2 rounded-lg text-sm font-semibold transition-all"
        style={p.ctaStyle === "outline"
          ? { border: `2px solid ${p.ctaColor || primaryColor}`, color: p.ctaColor || primaryColor, backgroundColor: "transparent" }
          : { backgroundColor: p.ctaColor || primaryColor, color: p.ctaTextColor || "#ffffff" }
        }
      >
        {p.ctaText}
      </a>
    );

    const renderLogo = () => p.showLogo && (
      <a href="/" onClick={(e) => e.preventDefault()} className="flex-shrink-0 flex items-center gap-2">
        {p.logo
          ? <img src={p.logo} alt="Logo" className="h-9 object-contain" />
          : <span className="text-lg font-bold" style={{ color: p.textColor || "#111827" }}>{p.logoText || "Brand"}</span>
        }
      </a>
    );

    const renderMobileToggle = () => (
      <button
        className="md:hidden p-2 rounded-lg transition-colors"
        style={{ color: p.textColor || "#111827" }}
        onClick={(e) => { e.stopPropagation(); setMobileMenuOpen(!mobileMenuOpen); }}
      >
        {mobileMenuOpen ? <LucideIcons.X className="w-6 h-6" /> : <LucideIcons.Menu className="w-6 h-6" />}
      </button>
    );

    const renderMobileMenu = () => mobileMenuOpen && (
      <div className="md:hidden absolute top-full left-0 right-0 shadow-lg border-t py-4 z-50"
        style={{ backgroundColor: p.backgroundColor || "#ffffff", borderColor: p.borderColor || "#e5e7eb" }}>
        <div className="px-4 space-y-1">
          {(p.menu || []).map((item, idx) => (
            <div key={idx}>
              <a href={item.url || "#"} onClick={(e) => { e.preventDefault(); if (item.hasSubmenu) setOpenSubmenu(openSubmenu === idx ? null : idx); }}
                className="flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium transition-colors"
                style={{ color: p.textColor || "#111827" }}>
                {item.label}
                {item.hasSubmenu && item.submenu?.length > 0 && (
                  <LucideIcons.ChevronDown className={`w-4 h-4 transition-transform ${openSubmenu === idx ? "rotate-180" : ""}`} />
                )}
              </a>
              {item.hasSubmenu && openSubmenu === idx && (
                <div className="ml-4 mt-1 space-y-1">
                  {item.submenu.map((sub, sIdx) => (
                    <a key={sIdx} href={sub.url || "#"} onClick={(e) => e.preventDefault()}
                      className="block px-3 py-2 text-sm text-gray-500 hover:text-gray-900 rounded-lg transition-colors">
                      {sub.label}
                    </a>
                  ))}
                </div>
              )}
            </div>
          ))}
          {p.showSearch && (
            <div className="flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg mt-2">
              <LucideIcons.Search className="w-4 h-4 text-gray-400" />
              <input type="text" placeholder="Search..." className="bg-transparent text-sm outline-none flex-1 text-gray-700 placeholder-gray-400" />
            </div>
          )}
          {p.showCta && p.ctaText && (
            <div className="pt-2">
              <a href={p.ctaLink || "#"} onClick={(e) => e.preventDefault()}
                className="block text-center px-5 py-2.5 rounded-lg text-sm font-semibold"
                style={{ backgroundColor: p.ctaColor || primaryColor, color: p.ctaTextColor || "#ffffff" }}>
                {p.ctaText}
              </a>
            </div>
          )}
        </div>
      </div>
    );

    let content;
    if (variant === "centered") {
      content = (
        <div className="flex flex-col items-center gap-4">
          {renderLogo()}
          <div className="flex items-center gap-6">
            {renderNavLinks()}
            {renderSearch()}
            {renderCta()}
          </div>
        </div>
      );
    } else if (variant === "nav-left") {
      content = (
        <div className="flex items-center justify-between w-full">
          <div className="flex items-center gap-8">
            {renderNavLinks()}
          </div>
          <div className="flex items-center gap-4">
            {renderLogo()}
          </div>
          <div className="flex items-center gap-4">
            {renderSearch()}
            {renderCta()}
            {renderMobileToggle()}
          </div>
        </div>
      );
    } else if (variant === "split") {
      const half = Math.ceil((p.menu || []).length / 2);
      const leftMenu = (p.menu || []).slice(0, half);
      const rightMenu = (p.menu || []).slice(half);
      content = (
        <div className="flex items-center justify-between w-full">
          <nav className="hidden md:flex items-center gap-6">
            {leftMenu.map((item, idx) => (
              <a key={idx} href={item.url || "#"} onClick={(e) => e.preventDefault()}
                className="text-sm font-medium transition-colors hover:opacity-70"
                style={{ color: p.textColor || "#111827" }}>{item.label}</a>
            ))}
          </nav>
          {renderLogo()}
          <div className="flex items-center gap-6">
            <nav className="hidden md:flex items-center gap-6">
              {rightMenu.map((item, idx) => (
                <a key={idx} href={item.url || "#"} onClick={(e) => e.preventDefault()}
                  className="text-sm font-medium transition-colors hover:opacity-70"
                  style={{ color: p.textColor || "#111827" }}>{item.label}</a>
              ))}
            </nav>
            {renderSearch()}
            {renderCta()}
            {renderMobileToggle()}
          </div>
        </div>
      );
    } else if (variant === "minimal") {
      content = (
        <div className="flex items-center justify-between w-full">
          {renderLogo()}
          <div className="flex items-center gap-4">
            {renderCta()}
            {renderMobileToggle()}
          </div>
        </div>
      );
    } else {
      content = (
        <div className="flex items-center justify-between w-full">
          {renderLogo()}
          <div className="hidden md:flex items-center gap-8">
            {renderNavLinks()}
          </div>
          <div className="flex items-center gap-4">
            {renderSearch()}
            {renderCta()}
            {renderMobileToggle()}
          </div>
        </div>
      );
    }

    return (
      <div style={containerStyle} className="relative">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex items-center">
          {content}
        </div>
        {renderMobileMenu()}
      </div>
    );
  };

  const renderFooter = () => {
    const p = section.props;
    const [newsletterState, setNewsletterState] = useState({ loading: false, success: false, error: false, message: "" });

    const containerStyle = {
      backgroundColor: p.backgroundColor || "#111827",
      color: p.textColor || "#ffffff",
      padding: p.padding || "3rem 0",
    };

    const handleNewsletterSubmit = async (e) => {
      e.preventDefault();
      const email = e.target.email?.value;
      setNewsletterState({ loading: true, success: false, error: false, message: "" });
      try {
        await axiosInstance.post("/forms/submit", {
          website_id: selectedWebsite?.id,
          section_id: section.id,
          section_type: "footer_newsletter",
          data: { email },
        });
        setNewsletterState({ loading: false, success: true, error: false, message: p.newsletter?.successMessage || "Subscribed!" });
        e.target.reset();
      } catch {
        setNewsletterState({ loading: false, success: false, error: true, message: p.newsletter?.errorMessage || "Something went wrong. Please try again." });
      }
    };

    if (variant === "simple") {
      return (
        <div style={containerStyle}>
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex flex-col md:flex-row items-center justify-between gap-6">
              <div className="flex items-center gap-3">
                {p.showLogo && (
                  p.logo
                    ? <img src={p.logo} alt="Logo" className="h-8 object-contain" />
                    : <span className="text-lg font-bold" style={{ color: p.logoTextColor || p.textColor || "#ffffff" }}>{p.logoText || "Brand"}</span>
                )}
                {p.tagline && <span className="text-sm" style={{ color: p.taglineColor || "rgba(255,255,255,0.6)" }}>{p.tagline}</span>}
              </div>
              <div className="flex flex-wrap gap-6">
                {(p.columns || []).flatMap((col) => col.links || []).map((link, i) => (
                  <a key={i} href={link.url || "#"} onClick={(e) => e.preventDefault()}
                    className="text-sm transition-colors hover:opacity-100"
                    style={{ color: p.linkColor || "#9ca3af" }}>{link.label}</a>
                ))}
              </div>
              {p.showSocial && (
                <div className="flex gap-3">
                  {(p.socialLinks || []).map((s, i) => (
                    <a key={i} href={s.url || "#"} target="_blank" rel="noopener noreferrer"
                      className="text-sm font-medium transition-colors hover:opacity-100"
                      style={{ color: p.linkColor || "#9ca3af" }}>{s.platform}</a>
                  ))}
                </div>
              )}
            </div>
            {p.copyright && (
              <div className="mt-6 pt-6 text-center text-sm" style={{ borderTop: `1px solid ${p.dividerColor || "rgba(255,255,255,0.1)"}`, color: p.copyrightColor || "rgba(255,255,255,0.4)" }}>
                {p.copyright}
              </div>
            )}
          </div>
        </div>
      );
    }

    if (variant === "centered") {
      return (
        <div style={containerStyle}>
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            {p.showLogo && (
              <div className="mb-6">
                {p.logo
                  ? <img src={p.logo} alt="Logo" className="h-10 object-contain mx-auto" />
                  : <span className="text-xl font-bold" style={{ color: p.logoTextColor || p.textColor || "#ffffff" }}>{p.logoText || "Brand"}</span>
                }
              </div>
            )}
            {p.tagline && <p className="mb-8 text-sm" style={{ color: p.taglineColor || "rgba(255,255,255,0.6)" }}>{p.tagline}</p>}
            <div className="flex flex-wrap justify-center gap-8 mb-8">
              {(p.columns || []).flatMap((col) => col.links || []).map((link, i) => (
                <a key={i} href={link.url || "#"} onClick={(e) => e.preventDefault()}
                  className="text-sm transition-colors hover:opacity-100"
                  style={{ color: p.linkColor || "#9ca3af" }}>{link.label}</a>
              ))}
            </div>
            {p.showSocial && (
              <div className="flex justify-center gap-4 mb-8">
                {(p.socialLinks || []).map((s, i) => (
                  <a key={i} href={s.url || "#"} target="_blank" rel="noopener noreferrer"
                    className="text-sm font-medium transition-colors hover:opacity-100"
                    style={{ color: p.linkColor || "#9ca3af" }}>{s.platform}</a>
                ))}
              </div>
            )}
            {p.copyright && (
              <p className="text-sm" style={{ color: p.copyrightColor || "rgba(255,255,255,0.4)" }}>{p.copyright}</p>
            )}
          </div>
        </div>
      );
    }

    if (variant === "minimal") {
      return (
        <div style={containerStyle}>
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row items-center justify-between gap-4">
            {p.showLogo && (
              p.logo
                ? <img src={p.logo} alt="Logo" className="h-7 object-contain" />
                : <span className="text-base font-bold" style={{ color: p.logoTextColor || p.textColor || "#ffffff" }}>{p.logoText || "Brand"}</span>
            )}
            {p.copyright && <p className="text-xs" style={{ color: p.copyrightColor || "rgba(255,255,255,0.4)" }}>{p.copyright}</p>}
            {p.showSocial && (
              <div className="flex gap-4">
                {(p.socialLinks || []).map((s, i) => (
                  <a key={i} href={s.url || "#"} target="_blank" rel="noopener noreferrer"
                    className="text-xs font-medium transition-colors hover:opacity-100"
                    style={{ color: p.linkColor || "#9ca3af" }}>{s.platform}</a>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    }

    return (
      <div style={containerStyle}>
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className={`grid gap-8 mb-8 ${
            (p.columns?.length || 0) === 0 ? "grid-cols-1"
            : (p.columns?.length || 0) <= 2 ? "grid-cols-1 md:grid-cols-2 lg:grid-cols-4"
            : (p.columns?.length || 0) === 3 ? "grid-cols-1 md:grid-cols-2 lg:grid-cols-4"
            : "grid-cols-1 md:grid-cols-2 lg:grid-cols-5"
          }`}>
            {(p.showLogo || p.tagline) && (
              <div className="lg:col-span-2">
                {p.showLogo && (
                  <div className="mb-4">
                    {p.logo
                      ? <img src={p.logo} alt="Logo" className="h-10 object-contain" />
                      : <span className="text-lg font-bold" style={{ color: p.logoTextColor || p.textColor || "#ffffff" }}>{p.logoText || "Brand"}</span>
                    }
                  </div>
                )}
                {p.tagline && <p className="text-sm leading-relaxed mb-6" style={{ color: p.taglineColor || "rgba(255,255,255,0.6)" }}>{p.tagline}</p>}
                {p.showSocial && (
                  <div className="flex gap-3 flex-wrap">
                    {(p.socialLinks || []).map((s, i) => (
                      <a key={i} href={s.url || "#"} target="_blank" rel="noopener noreferrer"
                        className="text-sm font-medium transition-colors hover:opacity-100"
                        style={{ color: p.linkColor || "#9ca3af" }}>{s.platform}</a>
                    ))}
                  </div>
                )}
              </div>
            )}
            {(p.columns || []).map((col, idx) => (
              <div key={idx}>
                <h4 className="font-semibold mb-4 text-sm uppercase tracking-wide" style={{ color: p.columnTitleColor || p.textColor || "#ffffff" }}>
                  {col.title}
                </h4>
                <ul className="space-y-3">
                  {(col.links || []).map((link, lIdx) => (
                    <li key={lIdx}>
                      <a href={link.url || "#"} onClick={(e) => e.preventDefault()}
                        className="text-sm transition-colors hover:opacity-100"
                        style={{ color: p.linkColor || "#9ca3af" }}>
                        {link.label}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>

          {p.showNewsletter && p.newsletter && (
            <div className="py-8" style={{ borderTop: `1px solid ${p.dividerColor || "rgba(255,255,255,0.1)"}`, borderBottom: `1px solid ${p.dividerColor || "rgba(255,255,255,0.1)"}` }}>
              <h4 className="font-semibold mb-4" style={{ color: p.textColor || "#ffffff" }}>{p.newsletter.title}</h4>
              {newsletterState.success ? (
                <p className="text-sm" style={{ color: "#86efac" }}>{newsletterState.message}</p>
              ) : (
                <form onSubmit={handleNewsletterSubmit} className="flex gap-2 max-w-md">
                  <input type="email" name="email" required placeholder={p.newsletter.placeholder || "Enter your email"}
                    className="flex-1 px-4 py-2 rounded-lg border border-gray-600 bg-transparent text-white placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 outline-none text-sm" />
                  <button type="submit" disabled={newsletterState.loading}
                    className="px-5 py-2 rounded-lg font-medium text-sm transition-colors"
                    style={{ backgroundColor: p.accentColor || primaryColor, color: "#ffffff" }}>
                    {newsletterState.loading ? "..." : p.newsletter.buttonText || "Subscribe"}
                  </button>
                </form>
              )}
              {newsletterState.error && <p className="text-sm mt-2 text-red-400">{newsletterState.message}</p>}
            </div>
          )}

          {p.copyright && (
            <div className="pt-8 flex flex-col md:flex-row items-center justify-between gap-4">
              <p className="text-sm" style={{ color: p.copyrightColor || "rgba(255,255,255,0.4)" }}>{p.copyright}</p>
            </div>
          )}
        </div>
      </div>
    );
  };

  const renderHero = () => {
    const { heading, subheading, ctaText, ctaLink, ctaColor, ctaTextColor, secondaryCtaText, secondaryCtaLink, secondaryCtaColor, secondaryCtaBorderColor, secondaryCtaTextColor, headingColor, subheadingColor, image, alignment = "center" } = section.props;
    const overlayStyle = getOverlayStyle();
    const hasImage = image && image.trim() !== "";

    if (isCarousel && carousel?.slides?.length > 0) {
      const slides = carousel.slides;
      const slide = slides[currentSlide] || {};
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="relative min-h-[600px] flex items-center overflow-hidden">
            {slide.image && (
              <div className="absolute inset-0">
                <img src={slide.image} alt="" className="w-full h-full object-cover" />
                <div className="absolute inset-0 bg-black/50" />
              </div>
            )}
            <CarouselDots slides={slides} current={currentSlide} onDotClick={setCurrentSlide} />
            <CarouselArrows slides={slides} onPrev={() => prev(slides.length)} onNext={() => next(slides.length)} />
            <div className="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white w-full">
              <h1 className="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight">{slide.heading || heading || "Slide Heading"}</h1>
              <p className="text-xl md:text-2xl mb-10 max-w-3xl mx-auto text-white/90">{slide.subheading || subheading || ""}</p>
              {slide.ctaText && (
                <a href={slide.ctaLink || "#"} className="inline-block px-10 py-4 bg-white text-gray-900 rounded-xl font-semibold text-lg hover:bg-gray-100 transition-all shadow-lg">{slide.ctaText}</a>
              )}
            </div>
          </div>
        </div>
      );
    }

    if (isSplit || (hasImage && variant !== "centered")) {
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
              <div>
                <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 leading-tight" style={{ color: headingColor || textOnBg() }}>{heading || "Hero Heading"}</h1>
                <p className="text-lg md:text-xl mb-8 leading-relaxed" style={{ color: subheadingColor || textOnBg("#6b7280") }}>{subheading || "Hero subheading goes here"}</p>
                <div className="flex flex-wrap gap-4">
                  {ctaText && <a href={ctaLink || "#"} className="inline-block px-8 py-4 rounded-xl font-semibold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1" style={{ backgroundColor: ctaColor || primaryColor, color: ctaTextColor || "#ffffff" }}>{ctaText}</a>}
                  {secondaryCtaText && <a href={secondaryCtaLink || "#"} className="inline-block px-8 py-4 border-2 rounded-xl font-semibold transition-all" style={{ borderColor: secondaryCtaBorderColor || "#e5e7eb", backgroundColor: secondaryCtaColor || "transparent", color: secondaryCtaTextColor || "#374151" }}>{secondaryCtaText}</a>}
                </div>
              </div>
              <div className="relative">
                {hasImage ? (
                  <>
                    <div className="absolute -inset-4 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-3xl opacity-20 blur-2xl" />
                    <img src={image} alt={heading} className="relative w-full h-auto rounded-2xl shadow-2xl" />
                  </>
                ) : (
                  <div className="w-full aspect-video rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                    <LucideIcons.Image className="w-16 h-16 text-gray-300" />
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className={`max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-${alignment} relative z-10`}>
          <h1 className="text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold mb-8 leading-tight" style={{ color: headingColor || textOnBg() }}>{heading || "Hero Heading"}</h1>
          <p className="text-xl md:text-2xl mb-10 max-w-3xl mx-auto leading-relaxed" style={{ color: subheadingColor || textOnBg("#6b7280") }}>{subheading || "Hero subheading goes here"}</p>
          <div className={`flex flex-wrap gap-4 justify-${alignment === "center" ? "center" : "start"}`}>
            {ctaText && <a href={ctaLink || "#"} className="inline-block px-10 py-4 rounded-xl font-semibold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1" style={{ backgroundColor: ctaColor || primaryColor, color: ctaTextColor || "#ffffff" }}>{ctaText}</a>}
            {secondaryCtaText && <a href={secondaryCtaLink || "#"} className="inline-block px-10 py-4 border-2 rounded-xl font-semibold transition-all" style={{ borderColor: secondaryCtaBorderColor || "#e5e7eb", backgroundColor: secondaryCtaColor || "transparent", color: secondaryCtaTextColor || "#374151" }}>{secondaryCtaText}</a>}
          </div>
        </div>
      </div>
    );
  };

  const renderFeatures = () => {
    const { heading, subheading, features = [], columns = 3, headingColor, subheadingColor, cardBackground, cardBorderColor, iconBackground, iconColor, titleColor, descriptionColor } = section.props;
    const overlayStyle = getOverlayStyle();
    const gridCls = `grid grid-cols-1 ${columns >= 2 ? "md:grid-cols-2" : ""} ${columns >= 3 ? "lg:grid-cols-3" : ""} ${columns >= 4 ? "xl:grid-cols-4" : ""} gap-8`;

    if (isList) {
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <SectionHeading heading={heading || "Features"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
            <div className="space-y-6">
              {features.map((feature) => {
                const Icon = getIcon(feature.icon);
                return (
                  <div key={feature.id} className="flex items-start gap-5 p-6 rounded-2xl shadow-sm border transition-all hover:shadow-md" style={{ backgroundColor: cardBackground || "#ffffff", borderColor: cardBorderColor || "#f3f4f6" }}>
                    {Icon && <div className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0" style={{ backgroundColor: iconBackground || primaryColor }}><Icon className="w-6 h-6" style={{ color: iconColor || "#ffffff" }} /></div>}
                    <div>
                      <h3 className="text-lg font-semibold mb-1" style={{ color: titleColor || "#111827" }}>{feature.title}</h3>
                      <p className="leading-relaxed" style={{ color: descriptionColor || "#6b7280" }}>{feature.description}</p>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Features"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className={gridCls}>
            {features.map((feature) => {
              const Icon = getIcon(feature.icon);
              return (
                <div key={feature.id} className="group text-center p-8 rounded-2xl transition-all hover:shadow-xl border" style={{ backgroundColor: cardBackground || "#ffffff", borderColor: cardBorderColor || "#f3f4f6" }}>
                  {Icon && <div className="w-14 h-14 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-md" style={{ backgroundColor: iconBackground || primaryColor }}><Icon className="w-7 h-7" style={{ color: iconColor || "#ffffff" }} /></div>}
                  <h3 className="text-xl font-semibold mb-3" style={{ color: titleColor || "#111827" }}>{feature.title}</h3>
                  <p className="leading-relaxed" style={{ color: descriptionColor || "#6b7280" }}>{feature.description}</p>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    );
  };

  const renderStats = () => {
    const { heading, subheading, stats = [], headingColor, subheadingColor, valueColor, labelColor, descriptionColor } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          {(heading || subheading) && <SectionHeading heading={heading} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />}
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-8">
            {stats.map((stat) => (
              <div key={stat.id} className="text-center group">
                <div className="text-4xl md:text-5xl lg:text-6xl font-black mb-2 group-hover:scale-110 transition-transform" style={{ color: valueColor || primaryColor }}>{stat.value}</div>
                <div className="text-lg font-semibold mb-1" style={{ color: labelColor || textOnBg() }}>{stat.label}</div>
                {stat.description && <div className="text-sm" style={{ color: descriptionColor || textOnBg("#6b7280") }}>{stat.description}</div>}
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const renderProcess = () => {
    const { heading, subheading, steps = [], headingColor, subheadingColor, iconBackground, iconColor, stepTitleColor, stepDescColor, stepDurationColor, numberColor } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Our Process"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className={`grid grid-cols-1 ${steps.length <= 3 ? "md:grid-cols-3" : "md:grid-cols-2 lg:grid-cols-4"} gap-8`}>
            {steps.map((step, idx) => {
              const Icon = getIcon(step.icon);
              return (
                <div key={step.id} className="relative group">
                  <div className="text-5xl font-black mb-3" style={{ color: numberColor || primaryColor, opacity: 0.15 }}>{step.number || String(idx + 1).padStart(2, "0")}</div>
                  <div className="w-14 h-14 rounded-2xl flex items-center justify-center mb-5" style={{ backgroundColor: iconBackground || primaryColor }}>
                    {Icon && <Icon className="w-7 h-7" style={{ color: iconColor || "#ffffff" }} />}
                  </div>
                  <h3 className="text-xl font-bold mb-2" style={{ color: stepTitleColor || textOnBg() }}>{step.title}</h3>
                  <p className="leading-relaxed" style={{ color: stepDescColor || textOnBg("#6b7280") }}>{step.description}</p>
                  {step.duration && <p className="text-sm font-medium mt-3" style={{ color: stepDurationColor || primaryColor }}> {step.duration}</p>}
                </div>
              );
            })}
          </div>
        </div>
      </div>
    );
  };

  const renderContent = () => {
    const { heading, content, image, imagePosition = "right", headingColor, contentColor } = section.props;
    const overlayStyle = getOverlayStyle();
    const hasImage = image && image.trim() !== "";

    if (isSplit || hasImage) {
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
              <div className={imagePosition === "left" ? "lg:order-2" : ""}>
                <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold mb-8" style={{ color: headingColor || textOnBg() }}>{heading || "Content Heading"}</h2>
                <div className="prose prose-lg prose-gray max-w-none" style={{ color: contentColor || textOnBg("#374151") }} dangerouslySetInnerHTML={{ __html: content || "<p>Content goes here...</p>" }} />
              </div>
              <div className={imagePosition === "left" ? "lg:order-1" : ""}>
                {hasImage ? (
                  <div className="relative">
                    <div className="absolute -inset-4 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-3xl opacity-20 blur-2xl" />
                    <img src={image} alt={heading} className="relative w-full h-auto rounded-2xl shadow-2xl" />
                  </div>
                ) : (
                  <div className="w-full aspect-video rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                    <LucideIcons.Image className="w-16 h-16 text-gray-300" />
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold mb-10" style={{ color: headingColor || textOnBg() }}>{heading || "Content Heading"}</h2>
          <div className="prose prose-lg prose-gray max-w-none" style={{ color: contentColor || textOnBg("#374151") }} dangerouslySetInnerHTML={{ __html: content || "<p>Content goes here...</p>" }} />
        </div>
      </div>
    );
  };

  const renderGallery = () => {
    const { heading, subheading, items = [], columns = 3, headingColor, subheadingColor, overlayColor, titleColor, categoryColor } = section.props;
    const overlayStyle = getOverlayStyle();
    const gridCls = `grid grid-cols-1 ${columns >= 2 ? "sm:grid-cols-2" : ""} ${columns >= 3 ? "lg:grid-cols-3" : ""} ${columns >= 4 ? "xl:grid-cols-4" : ""} gap-8`;

    const GalleryItem = ({ item, idx }) => (
      <div key={item.id || idx} className="group relative aspect-square bg-gray-200 rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all transform hover:-translate-y-2">
        {item.image ? <img src={item.image} alt={item.title || `Gallery ${idx + 1}`} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" /> : <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300" />}
        {item.title && (
          <div className="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-6" style={{ background: overlayColor || "rgba(0,0,0,0.7)" }}>
            <div>
              <h3 className="text-xl font-bold mb-1" style={{ color: titleColor || "#ffffff" }}>{item.title}</h3>
              {item.category && <p className="text-sm" style={{ color: categoryColor || "#d1d5db" }}>{item.category}</p>}
            </div>
          </div>
        )}
      </div>
    );

    if (isCarousel && items.length > 0) {
      const slide = items[currentSlide] || {};
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <SectionHeading heading={heading || "Gallery"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
            <div className="relative overflow-hidden rounded-2xl">
              <div className="aspect-video relative">
                {slide.image ? <img src={slide.image} alt={slide.title} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300" />}
                {slide.title && (
                  <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-8">
                    <h3 className="text-2xl font-bold" style={{ color: titleColor || "#ffffff" }}>{slide.title}</h3>
                    {slide.category && <p className="mt-1" style={{ color: categoryColor || "#d1d5db" }}>{slide.category}</p>}
                  </div>
                )}
              </div>
              <CarouselDots slides={items} current={currentSlide} onDotClick={setCurrentSlide} />
              <CarouselArrows slides={items} onPrev={() => prev(items.length)} onNext={() => next(items.length)} />
            </div>
          </div>
        </div>
      );
    }

    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Gallery"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className={gridCls}>
            {items.length > 0 ? items.map((item, idx) => <GalleryItem key={item.id || idx} item={item} idx={idx} />) : Array(6).fill(0).map((_, idx) => <div key={idx} className="aspect-square bg-gradient-to-br from-gray-200 to-gray-300 rounded-2xl" />)}
          </div>
        </div>
      </div>
    );
  };

  const renderTestimonials = () => {
    const { heading, subheading, testimonials = [], headingColor, subheadingColor, cardBackground, quoteColor, nameColor, roleColor, metricColor, starColor } = section.props;
    const overlayStyle = getOverlayStyle();

    if (isCarousel && testimonials.length > 0) {
      const slide = testimonials[currentSlide] || {};
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <SectionHeading heading={heading || "Testimonials"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
            <div className="relative rounded-3xl p-10 md:p-14 shadow-2xl" style={{ backgroundColor: cardBackground || "#ffffff" }}>
              <CarouselDots slides={testimonials} current={currentSlide} onDotClick={setCurrentSlide} />
              <div className="text-center">
                <div className="flex justify-center mb-5">
                  {[...Array(slide.rating || 5)].map((_, i) => <LucideIcons.Star key={i} className="w-6 h-6 fill-current" style={{ color: starColor || "#f59e0b" }} />)}
                </div>
                <p className="text-xl md:text-2xl mb-8 italic leading-relaxed" style={{ color: quoteColor || "#374151" }}>"{slide.content}"</p>
                <div className="flex items-center justify-center gap-4">
                  <div className="w-16 h-16 bg-gradient-to-br from-indigo-400 to-purple-400 rounded-full overflow-hidden">
                    {slide.avatar && <img src={slide.avatar} alt={slide.name} className="w-full h-full object-cover" />}
                  </div>
                  <div className="text-left">
                    <p className="font-bold text-lg" style={{ color: nameColor || "#111827" }}>{slide.name}</p>
                    <p style={{ color: roleColor || "#6b7280" }}>{slide.role}</p>
                    {slide.metric && <p className="font-bold mt-1" style={{ color: metricColor || primaryColor }}>{slide.metric}</p>}
                  </div>
                </div>
              </div>
            </div>
            {testimonials.length > 1 && (
              <div className="flex justify-center gap-3 mt-6">
                <button onClick={() => prev(testimonials.length)} className="w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center hover:border-indigo-500 transition-colors"><LucideIcons.ChevronLeft className="w-5 h-5 text-gray-600" /></button>
                <button onClick={() => next(testimonials.length)} className="w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center hover:border-indigo-500 transition-colors"><LucideIcons.ChevronRight className="w-5 h-5 text-gray-600" /></button>
              </div>
            )}
          </div>
        </div>
      );
    }

    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Testimonials"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            {testimonials.map((test) => (
              <div key={test.id} className="p-8 rounded-2xl shadow-lg hover:shadow-xl transition-all" style={{ backgroundColor: cardBackground || "#ffffff" }}>
                <div className="flex mb-4">
                  {[...Array(test.rating || 5)].map((_, i) => <LucideIcons.Star key={i} className="w-5 h-5 fill-current" style={{ color: starColor || primaryColor }} />)}
                </div>
                <p className="mb-6 text-lg leading-relaxed italic" style={{ color: quoteColor || "#374151" }}>"{test.content}"</p>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-12 h-12 bg-gray-200 rounded-full overflow-hidden">
                      {test.avatar && <img src={test.avatar} alt={test.name} className="w-full h-full object-cover" />}
                    </div>
                    <div>
                      <p className="font-semibold" style={{ color: nameColor || "#111827" }}>{test.name}</p>
                      <p className="text-sm" style={{ color: roleColor || "#6b7280" }}>{test.role}</p>
                    </div>
                  </div>
                  {test.metric && <span className="text-xl font-bold" style={{ color: metricColor || primaryColor }}>{test.metric}</span>}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const renderLogos = () => {
    const { heading, subheading, logos = [], columns = 4, headingColor, subheadingColor, logoFilter } = section.props;
    const overlayStyle = getOverlayStyle();

    if (isCarousel && logos.length > 0) {
      const doubled = [...logos, ...logos];
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="relative z-10">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <SectionHeading heading={heading || "Trusted by Industry Leaders"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
            </div>
            <div className="relative overflow-hidden">
              <div className="flex gap-12 animate-scroll" style={{ animationDuration: `${logos.length * 3}s` }}>
                {doubled.map((logo, idx) => (
                  <div key={idx} className="flex-shrink-0 flex items-center justify-center h-20 px-6">
                    {logo.image ? <img src={logo.image} alt={logo.name} className={`max-h-12 w-auto object-contain transition-all ${logoFilter === "grayscale" ? "grayscale hover:grayscale-0" : ""}`} /> : <div className="px-6 py-3 bg-gray-100 rounded-lg text-gray-500 text-sm font-medium whitespace-nowrap">{logo.name}</div>}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Trusted by Industry Leaders"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className={`grid grid-cols-2 md:grid-cols-${Math.min(columns, 6)} gap-10 items-center`}>
            {logos.map((logo) => (
              <div key={logo.id} className="flex justify-center">
                {logo.image ? <img src={logo.image} alt={logo.name} className={`max-h-14 w-auto object-contain transition-all ${logoFilter === "grayscale" ? "grayscale hover:grayscale-0" : ""}`} /> : <div className="px-6 py-3 bg-gray-100 rounded-lg text-gray-500 text-sm font-medium">{logo.name}</div>}
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const renderBenefits = () => {
    const { heading, subheading, benefits = [], headingColor, subheadingColor, cardBackground, iconBackground, iconColor, titleColor, descriptionColor, metricColor } = section.props;
    const overlayStyle = getOverlayStyle();

    if (isList) {
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <SectionHeading heading={heading || "Benefits"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
            <div className="space-y-4">
              {benefits.map((b) => {
                const Icon = getIcon(b.icon);
                return (
                  <div key={b.id} className="flex items-start gap-4 p-5 rounded-xl border shadow-sm hover:shadow-md transition-all" style={{ backgroundColor: cardBackground || "#ffffff" }}>
                    {Icon && <div className="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0" style={{ backgroundColor: iconBackground || primaryColor }}><Icon className="w-5 h-5" style={{ color: iconColor || "#ffffff" }} /></div>}
                    <div className="flex-1">
                      <h3 className="font-semibold mb-1" style={{ color: titleColor || "#111827" }}>{b.title}</h3>
                      <p className="text-sm leading-relaxed" style={{ color: descriptionColor || "#6b7280" }}>{b.description}</p>
                    </div>
                    {b.metric && <span className="text-xl font-black flex-shrink-0" style={{ color: metricColor || primaryColor }}>{b.metric}</span>}
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Benefits"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            {benefits.map((b) => {
              const Icon = getIcon(b.icon);
              return (
                <div key={b.id} className="flex gap-5 p-7 rounded-2xl shadow-lg hover:shadow-xl transition-all" style={{ backgroundColor: cardBackground || "#ffffff" }}>
                  <div className="flex-shrink-0">
                    <div className="w-14 h-14 rounded-xl flex items-center justify-center" style={{ backgroundColor: iconBackground || primaryColor }}>
                      {Icon && <Icon className="w-7 h-7" style={{ color: iconColor || "#ffffff" }} />}
                    </div>
                  </div>
                  <div className="flex-1">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-xl font-bold" style={{ color: titleColor || "#111827" }}>{b.title}</h3>
                      {b.metric && <span className="text-2xl font-black" style={{ color: metricColor || primaryColor }}>{b.metric}</span>}
                    </div>
                    <p className="leading-relaxed" style={{ color: descriptionColor || "#6b7280" }}>{b.description}</p>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    );
  };

  const renderCTA = () => {
    const { heading, subheading, primaryButton, secondaryButton, features, headingColor, subheadingColor, featureColor } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
          <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold mb-8 leading-tight" style={{ color: headingColor || "#ffffff" }}>{heading || "Ready to get started?"}</h2>
          {subheading && <p className="text-lg md:text-xl mb-12 max-w-2xl mx-auto" style={{ color: subheadingColor || "rgba(255,255,255,0.9)" }}>{subheading}</p>}
          <div className="flex flex-col sm:flex-row gap-4 justify-center mb-8">
            {primaryButton?.text && (
              <a href={primaryButton.link || "#"} className="px-10 py-4 rounded-xl font-semibold text-lg transition-all shadow-xl hover:shadow-2xl transform hover:-translate-y-1" style={{ backgroundColor: primaryButton.backgroundColor || "#ffffff", color: primaryButton.textColor || primaryColor }}>
                {primaryButton.text}
              </a>
            )}
            {secondaryButton?.text && (
              <a href={secondaryButton.link || "#"} className="px-10 py-4 border-2 rounded-xl font-semibold hover:bg-white/10 transition-all" style={{ borderColor: secondaryButton.borderColor || "#ffffff", color: secondaryButton.textColor || "#ffffff" }}>
                {secondaryButton.text}
              </a>
            )}
          </div>
          {features?.length > 0 && (
            <div className="flex flex-wrap gap-6 justify-center text-sm">
              {features.map((f, idx) => (
                <div key={idx} className="flex items-center gap-2">
                  <LucideIcons.Check className="w-4 h-4" style={{ color: featureColor || "rgba(255,255,255,0.8)" }} />
                  <span style={{ color: featureColor || "rgba(255,255,255,0.8)" }}>{f}</span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  };

  const renderPricing = () => {
    const { heading, subheading, plans = [], headingColor, subheadingColor, cardBackground, cardBorderColor, highlightColor, planNameColor, planPriceColor, planDescColor, featureColor, checkColor } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Pricing"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {plans.map((plan) => (
              <div key={plan.id} className={`relative rounded-3xl p-9 transition-all hover:shadow-2xl ${plan.highlighted ? "shadow-2xl lg:scale-105 z-10" : "border-2 hover:border-gray-300"}`}
                style={{ backgroundColor: cardBackground || "#ffffff", borderColor: !plan.highlighted ? (cardBorderColor || "#e5e7eb") : undefined, outline: plan.highlighted ? `4px solid ${highlightColor || primaryColor}` : undefined }}>
                {plan.badge && plan.highlighted && (
                  <div className="absolute -top-5 left-1/2 -translate-x-1/2 px-5 py-1.5 rounded-full text-white text-sm font-bold shadow-lg" style={{ backgroundColor: highlightColor || primaryColor }}>{plan.badge}</div>
                )}
                {plan.savings && <div className="absolute -top-3 -right-3 px-3 py-1 bg-green-500 text-white rounded-full text-xs font-bold shadow">{plan.savings}</div>}
                <h3 className="text-2xl font-bold mb-1" style={{ color: planNameColor || "#111827" }}>{plan.name}</h3>
                {plan.description && <p className="text-sm mb-6" style={{ color: planDescColor || "#6b7280" }}>{plan.description}</p>}
                <div className="mb-8">
                  <span className="text-5xl font-bold" style={{ color: planPriceColor || "#111827" }}>{plan.price}</span>
                  {plan.period && <span className="ml-1" style={{ color: planDescColor || "#6b7280" }}>/{plan.period}</span>}
                </div>
                <ul className="space-y-4 mb-10">
                  {plan.features.map((f, i) => (
                    <li key={i} className="flex items-start gap-3">
                      <LucideIcons.Check className="w-5 h-5 flex-shrink-0 mt-0.5" style={{ color: checkColor || "#22c55e" }} />
                      <span style={{ color: featureColor || "#374151" }}>{f}</span>
                    </li>
                  ))}
                </ul>
                <a href={plan.ctaLink || "#"} className={`block w-full py-4 rounded-xl font-bold text-lg text-center transition-all ${plan.highlighted ? "text-white shadow-lg hover:shadow-xl transform hover:-translate-y-1" : "bg-gray-100 hover:bg-gray-200"}`}
                  style={{ backgroundColor: plan.highlighted ? (highlightColor || primaryColor) : undefined, color: plan.highlighted ? "#ffffff" : (planNameColor || "#111827") }}>
                  {plan.ctaText}
                </a>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const renderContact = () => {
    const { heading, subheading, fields = [], submitText, successMessage, errorMessage, headingColor, subheadingColor, cardBackground, labelColor, inputBorderColor, inputFocusColor, buttonColor, buttonTextColor } = section.props;
    const [localState, setLocalState] = useState({ loading: false, success: false, error: false, message: "" });
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Contact Us"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className="rounded-3xl shadow-2xl p-10" style={{ backgroundColor: cardBackground || "#ffffff" }}>
            {localState.success ? (
              <div className="text-center py-8">
                <LucideIcons.CheckCircle className="w-16 h-16 mx-auto mb-4 text-green-500" />
                <p className="text-lg font-medium text-gray-900">{localState.message || successMessage || "Message sent!"}</p>
              </div>
            ) : (
              <form onSubmit={(e) => handleFormSubmit(e, successMessage, errorMessage, setLocalState)} className="space-y-6">
                {fields.map((field) => (
                  <div key={field.id}>
                    <label className="block text-sm font-semibold mb-2" style={{ color: labelColor || "#374151" }}>
                      {field.label}{field.required && <span className="text-red-500 ml-1">*</span>}
                    </label>
                    {field.type === "textarea" ? (
                      <textarea name={field.label.toLowerCase()} rows={5} required={field.required} placeholder={field.placeholder || ""} className="w-full px-4 py-3 border-2 rounded-xl outline-none transition-colors resize-none" style={{ borderColor: inputBorderColor || "#e5e7eb" }} />
                    ) : (
                      <input type={field.type} name={field.label.toLowerCase()} required={field.required} placeholder={field.placeholder || ""} className="w-full px-4 py-3 border-2 rounded-xl outline-none transition-colors" style={{ borderColor: inputBorderColor || "#e5e7eb" }} />
                    )}
                  </div>
                ))}
                {localState.error && <p className="text-red-500 text-sm">{localState.message}</p>}
                <button type="submit" disabled={localState.loading} className="w-full py-4 text-white rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1 disabled:opacity-60" style={{ backgroundColor: buttonColor || primaryColor, color: buttonTextColor || "#ffffff" }}>
                  {localState.loading ? "Sending..." : (submitText || "Submit")}
                </button>
              </form>
            )}
          </div>
        </div>
      </div>
    );
  };

  const renderTeam = () => {
    const { heading, subheading, members = [], columns = 3, headingColor, subheadingColor, nameColor, roleColor, bioColor } = section.props;
    const overlayStyle = getOverlayStyle();
    const gridCls = `grid grid-cols-1 ${columns >= 2 ? "sm:grid-cols-2" : ""} ${columns >= 3 ? "lg:grid-cols-3" : ""} ${columns >= 4 ? "xl:grid-cols-4" : ""} gap-10`;
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Our Team"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className={gridCls}>
            {members.map((m) => (
              <div key={m.id} className="text-center group">
                <div className="w-40 h-40 bg-gradient-to-br from-gray-200 to-gray-300 rounded-full mx-auto overflow-hidden shadow-xl group-hover:shadow-2xl transition-shadow mb-6">
                  {m.image && <img src={m.image} alt={m.name} className="w-full h-full object-cover" />}
                </div>
                <h3 className="text-xl font-semibold mb-1" style={{ color: nameColor || textOnBg() }}>{m.name}</h3>
                <p className="font-medium mb-3" style={{ color: roleColor || primaryColor }}>{m.role}</p>
                <p className="text-sm leading-relaxed" style={{ color: bioColor || textOnBg("#6b7280") }}>{m.bio}</p>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const renderFAQ = () => {
    const { heading, subheading, faqs = [], questions = [], headingColor, subheadingColor, cardBackground, cardBorderColor, questionColor, answerColor, badgeBackground, badgeTextColor } = section.props;
    const items = faqs.length > 0 ? faqs : questions;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "FAQ"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className="space-y-4">
            {items.map((q) => (
              <div key={q.id} className="border-2 rounded-2xl p-7 hover:shadow-lg hover:border-transparent transition-all" style={{ backgroundColor: cardBackground || "#ffffff", borderColor: cardBorderColor || "#e5e7eb" }}>
                <h3 className="text-lg font-bold mb-3 flex items-start gap-3" style={{ color: questionColor || "#111827" }}>
                  <span className="flex-shrink-0 w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold" style={{ backgroundColor: badgeBackground || primaryColor, color: badgeTextColor || "#ffffff" }}>Q</span>
                  <span className="flex-1">{q.question}</span>
                </h3>
                <p className="leading-relaxed pl-10" style={{ color: answerColor || "#6b7280" }}>{q.answer}</p>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const renderNewsletter = () => {
    const { heading, subheading, placeholder, buttonText, benefits = [], successMessage, errorMessage, headingColor, subheadingColor, inputBackground, inputTextColor, inputBorderColor, buttonColor, buttonTextColor, benefitColor } = section.props;
    const [localState, setLocalState] = useState({ loading: false, success: false, error: false, message: "" });
    const overlayStyle = getOverlayStyle();

    const handleSubmit = async (e) => {
      e.preventDefault();
      const email = e.target.email?.value;
      setLocalState({ loading: true, success: false, error: false, message: "" });
      try {
        await axiosInstance.post("/forms/submit", {
          website_id: selectedWebsite?.id,
          section_id: section.id,
          section_type: section.type,
          data: { email },
        });
        setLocalState({ loading: false, success: true, error: false, message: successMessage || "Subscribed!" });
        e.target.reset();
      } catch {
        setLocalState({ loading: false, success: false, error: true, message: errorMessage || "Something went wrong. Please try again." });
      }
    };

    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center">
          <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold mb-6" style={{ color: headingColor || "#ffffff" }}>{heading || "Stay Updated"}</h2>
          {subheading && <p className="text-lg mb-10" style={{ color: subheadingColor || "rgba(255,255,255,0.85)" }}>{subheading}</p>}
          {localState.success ? (
            <p className="text-lg font-medium py-4" style={{ color: "#86efac" }}>{localState.message}</p>
          ) : (
            <form onSubmit={handleSubmit} className="flex flex-col sm:flex-row gap-3 max-w-xl mx-auto mb-8">
              <input type="email" name="email" required placeholder={placeholder || "Enter your email"} className="flex-1 px-5 py-4 rounded-xl border-2 outline-none text-base" style={{ backgroundColor: inputBackground || "rgba(255,255,255,0.1)", color: inputTextColor || "#ffffff", borderColor: inputBorderColor || "transparent" }} />
              <button type="submit" disabled={localState.loading} className="px-8 py-4 rounded-xl font-bold whitespace-nowrap disabled:opacity-60" style={{ backgroundColor: buttonColor || "#ffffff", color: buttonTextColor || primaryColor }}>
                {localState.loading ? "..." : (buttonText || "Subscribe")}
              </button>
            </form>
          )}
          {localState.error && <p className="text-sm text-red-300 mb-4">{localState.message}</p>}
          {benefits.length > 0 && (
            <div className="flex flex-wrap gap-5 justify-center text-sm">
              {benefits.map((b, i) => (
                <div key={i} className="flex items-center gap-2">
                  <LucideIcons.Check className="w-4 h-4" style={{ color: benefitColor || "rgba(255,255,255,0.75)" }} />
                  <span style={{ color: benefitColor || "rgba(255,255,255,0.75)" }}>{b}</span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  };

  const renderCaseStudies = () => {
    const { heading, subheading, studies = [], headingColor, subheadingColor, cardBackground, titleColor, descriptionColor, clientBadgeBackground, clientBadgeColor, resultBadgeBackground, resultBadgeColor, metricValueColor, metricLabelColor } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Success Stories"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
            {studies.map((study) => (
              <div key={study.id} className="group rounded-3xl overflow-hidden shadow-xl hover:shadow-2xl transition-all transform hover:-translate-y-2" style={{ backgroundColor: cardBackground || "#ffffff" }}>
                <div className="relative h-56 overflow-hidden">
                  {study.image ? <img src={study.image} alt={study.title} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" /> : <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300" />}
                </div>
                <div className="p-7">
                  <div className="flex items-start justify-between mb-3">
                    <h3 className="text-xl font-bold" style={{ color: titleColor || "#111827" }}>{study.title}</h3>
                    {study.client && <span className="px-3 py-1 rounded-full text-xs flex-shrink-0 ml-3" style={{ backgroundColor: clientBadgeBackground || "#f3f4f6", color: clientBadgeColor || "#6b7280" }}>{study.client}</span>}
                  </div>
                  <p className="mb-5 leading-relaxed" style={{ color: descriptionColor || "#6b7280" }}>{study.description}</p>
                  {study.results?.length > 0 && (
                    <div className="flex flex-wrap gap-2 mb-4">
                      {study.results.map((r, i) => <span key={i} className="px-3 py-1 rounded-full text-xs font-medium" style={{ backgroundColor: resultBadgeBackground || "#dcfce7", color: resultBadgeColor || "#166534" }}>{r}</span>)}
                    </div>
                  )}
                  {study.metrics?.length > 0 && (
                    <div className="grid grid-cols-3 gap-4 pt-5 border-t border-gray-100">
                      {study.metrics.map((m, i) => (
                        <div key={i} className="text-center">
                          <div className="text-2xl font-bold" style={{ color: metricValueColor || primaryColor }}>{m.value}</div>
                          <div className="text-xs mt-0.5" style={{ color: metricLabelColor || "#6b7280" }}>{m.label}</div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const renderTrust = () => {
    const { heading, subheading, badges = [], testimonials = [], awards = [], headingColor, subheadingColor, iconBackground, iconColor, badgeTitleColor, badgeDescColor, awardBackground, awardBorderColor, awardTextColor } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading heading={heading || "Trusted & Secure"} subheading={subheading} headingColor={headingColor || textOnBg()} subheadingColor={subheadingColor} />
          {badges.length > 0 && (
            <div className="grid grid-cols-2 md:grid-cols-4 gap-8 mb-14">
              {badges.map((b) => {
                const Icon = getIcon(b.icon);
                return (
                  <div key={b.id} className="text-center">
                    <div className="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4" style={{ backgroundColor: iconBackground || "#eef2ff" }}>
                      {Icon && <Icon className="w-8 h-8" style={{ color: iconColor || primaryColor }} />}
                    </div>
                    <h3 className="font-bold mb-1" style={{ color: badgeTitleColor || "#111827" }}>{b.title}</h3>
                    <p className="text-sm" style={{ color: badgeDescColor || "#6b7280" }}>{b.description}</p>
                  </div>
                );
              })}
            </div>
          )}
          {awards.length > 0 && (
            <div className="text-center">
              <p className="text-xs font-semibold text-gray-400 uppercase tracking-widest mb-5">Recognized by</p>
              <div className="flex flex-wrap justify-center gap-3">
                {awards.map((award, i) => (
                  <span key={i} className="px-5 py-2.5 border-2 rounded-full font-medium text-sm" style={{ backgroundColor: awardBackground || "#ffffff", borderColor: awardBorderColor || "#e5e7eb", color: awardTextColor || "#374151" }}>
                     {award}
                  </span>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    );
  };

  switch (section.type) {
    case SECTION_TYPES.HEADER: return renderHeader();
    case SECTION_TYPES.FOOTER: return renderFooter();
    case SECTION_TYPES.HERO: return renderHero();
    case SECTION_TYPES.FEATURES: return renderFeatures();
    case SECTION_TYPES.CTA: return renderCTA();
    case SECTION_TYPES.CONTENT: return renderContent();
    case SECTION_TYPES.GALLERY: return renderGallery();
    case SECTION_TYPES.TESTIMONIALS: return renderTestimonials();
    case SECTION_TYPES.PRICING: return renderPricing();
    case SECTION_TYPES.CONTACT: return renderContact();
    case SECTION_TYPES.TEAM: return renderTeam();
    case SECTION_TYPES.FAQ: return renderFAQ();
    case SECTION_TYPES.STATS: return renderStats();
    case SECTION_TYPES.NEWSLETTER: return renderNewsletter();
    case SECTION_TYPES.PROCESS: return renderProcess();
    case SECTION_TYPES.BENEFITS: return renderBenefits();
    case SECTION_TYPES.LOGOS: return renderLogos();
    case SECTION_TYPES.CASE_STUDIES: return renderCaseStudies();
    case SECTION_TYPES.TRUST: return renderTrust();
    default: return <div className="py-16 text-center text-gray-400 bg-gray-50">Unknown section type: {section.type}</div>;
  }
}

function SectionHeading({ heading, subheading, headingColor, subheadingColor }) {
  if (!heading && !subheading) return null;
  return (
    <div className="text-center mb-16">
      {heading && <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold mb-5 leading-tight" style={{ color: headingColor || "#111827" }}>{heading}</h2>}
      {subheading && <p className="text-lg max-w-3xl mx-auto leading-relaxed" style={{ color: subheadingColor || "#6b7280" }}>{subheading}</p>}
    </div>
  );
}

sectionLibrary.jsx(utils):
import { v4 as uuidv4 } from "uuid";

export const SECTION_TYPES = {
  HERO: "hero",
  FEATURES: "features",
  CTA: "cta",
  CONTENT: "content",
  GALLERY: "gallery",
  TESTIMONIALS: "testimonials",
  PRICING: "pricing",
  CONTACT: "contact",
  TEAM: "team",
  FAQ: "faq",
  STATS: "stats",
  NEWSLETTER: "newsletter",
  PROCESS: "process",
  BENEFITS: "benefits",
  LOGOS: "logos",
  CASE_STUDIES: "case-studies",
  TRUST: "trust",
  HEADER: "header",
  FOOTER: "footer",
};

export const SECTION_VARIANTS = {
  [SECTION_TYPES.HEADER]: [
    { value: "default", label: "Logo Left, Nav Right" },
    { value: "centered", label: "Centered Logo" },
    { value: "nav-left", label: "Nav Left, Logo Right" },
    { value: "minimal", label: "Minimal" },
    { value: "split", label: "Split (Nav both sides)" },
  ],
  [SECTION_TYPES.FOOTER]: [
    { value: "columns", label: "Multi-Column" },
    { value: "simple", label: "Simple" },
    { value: "centered", label: "Centered" },
    { value: "minimal", label: "Minimal" },
  ],
  [SECTION_TYPES.HERO]: [
    { value: "centered", label: "Centered" },
    { value: "split", label: "Split (with image)" },
    { value: "carousel", label: "Carousel / Slideshow" },
  ],
  [SECTION_TYPES.FEATURES]: [
    { value: "grid", label: "Grid" },
    { value: "list", label: "List" },
  ],
  [SECTION_TYPES.GALLERY]: [
    { value: "grid", label: "Grid" },
    { value: "carousel", label: "Carousel" },
  ],
  [SECTION_TYPES.TESTIMONIALS]: [
    { value: "grid", label: "Grid" },
    { value: "carousel", label: "Carousel" },
  ],
  [SECTION_TYPES.LOGOS]: [
    { value: "grid", label: "Grid" },
    { value: "carousel", label: "Scrolling Carousel" },
  ],
  [SECTION_TYPES.PROCESS]: [
    { value: "timeline", label: "Timeline" },
    { value: "grid", label: "Grid" },
  ],
  [SECTION_TYPES.BENEFITS]: [
    { value: "grid", label: "Grid (with metrics)" },
    { value: "list", label: "List" },
  ],
  [SECTION_TYPES.CTA]: [
    { value: "simple", label: "Simple" },
    { value: "features", label: "With Features List" },
  ],
  [SECTION_TYPES.CONTENT]: [
    { value: "text", label: "Text Only" },
    { value: "image", label: "Text + Image" },
  ],
  [SECTION_TYPES.STATS]: [
    { value: "row", label: "Row" },
    { value: "headline", label: "With Headline" },
  ],
};

export const SECTION_LIBRARY = [
  {
    id: "header",
    type: SECTION_TYPES.HEADER,
    name: "Header / Navigation",
    icon: "layout",
    category: "structure",
    defaultProps: {
      variant: "default",
      showLogo: true,
      logo: "",
      logoText: "Brand",
      showNav: true,
      menu: [
        { id: uuidv4(), label: "Home", url: "/", hasSubmenu: false, submenu: [] },
        { id: uuidv4(), label: "About", url: "/about", hasSubmenu: false, submenu: [] },
        {
          id: uuidv4(), label: "Services", url: "/services", hasSubmenu: true,
          submenu: [
            { id: uuidv4(), label: "Web Design", url: "/services/web-design" },
            { id: uuidv4(), label: "Development", url: "/services/development" },
            { id: uuidv4(), label: "SEO", url: "/services/seo" },
          ],
        },
        { id: uuidv4(), label: "Contact", url: "/contact", hasSubmenu: false, submenu: [] },
      ],
      showCta: true,
      ctaText: "Get Started",
      ctaLink: "#",
      ctaStyle: "filled",
      showSearch: false,
      transparent: false,
      blur: false,
      sticky: true,
      textColor: "#111827",
      backgroundColor: "#ffffff",
      ctaColor: "#6366f1",
      ctaTextColor: "#ffffff",
      height: "80px",
      borderBottom: true,
      borderColor: "#e5e7eb",
    },
  },
  {
    id: "footer",
    type: SECTION_TYPES.FOOTER,
    name: "Footer",
    icon: "minus-square",
    category: "structure",
    defaultProps: {
      variant: "columns",
      showLogo: true,
      logo: "",
      logoText: "Brand",
      tagline: "Building amazing products since 2020.",
      columns: [
        {
          id: uuidv4(), title: "Company",
          links: [
            { id: uuidv4(), label: "About", url: "/about" },
            { id: uuidv4(), label: "Careers", url: "/careers" },
            { id: uuidv4(), label: "Blog", url: "/blog" },
          ],
        },
        {
          id: uuidv4(), title: "Product",
          links: [
            { id: uuidv4(), label: "Features", url: "#features" },
            { id: uuidv4(), label: "Pricing", url: "#pricing" },
            { id: uuidv4(), label: "FAQ", url: "#faq" },
          ],
        },
        {
          id: uuidv4(), title: "Legal",
          links: [
            { id: uuidv4(), label: "Privacy Policy", url: "/privacy" },
            { id: uuidv4(), label: "Terms of Service", url: "/terms" },
          ],
        },
      ],
      showNewsletter: false,
      newsletter: {
        title: "Stay Updated",
        placeholder: "Enter your email",
        buttonText: "Subscribe",
        successMessage: "Thanks for subscribing!",
        errorMessage: "Something went wrong.",
      },
      showSocial: true,
      socialLinks: [
        { id: uuidv4(), platform: "Twitter", icon: "twitter", url: "#" },
        { id: uuidv4(), platform: "LinkedIn", icon: "linkedin", url: "#" },
        { id: uuidv4(), platform: "GitHub", icon: "github", url: "#" },
      ],
      copyright: ` ${new Date().getFullYear()} Brand. All rights reserved.`,
      backgroundColor: "#111827",
      textColor: "#ffffff",
      linkColor: "#9ca3af",
      linkHoverColor: "#ffffff",
      accentColor: "#6366f1",
      logoTextColor: "#ffffff",
      taglineColor: "#9ca3af",
      columnTitleColor: "#ffffff",
      padding: "3rem 0",
      showDivider: true,
      dividerColor: "rgba(255,255,255,0.1)",
      copyrightColor: "rgba(255,255,255,0.5)",
    },
  },
  {
    id: "hero",
    type: SECTION_TYPES.HERO,
    name: "Hero",
    icon: "layout",
    defaultProps: {
      variant: "centered",
      heading: "Transform Your Digital Presence",
      subheading: "Build amazing websites in minutes with our intuitive platform",
      ctaText: "Get Started Free",
      ctaLink: "#",
      ctaColor: "#6366f1",
      ctaTextColor: "#ffffff",
      secondaryCtaText: "",
      secondaryCtaLink: "#",
      secondaryCtaColor: "transparent",
      secondaryCtaBorderColor: "#e5e7eb",
      secondaryCtaTextColor: "#374151",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      alignment: "center",
      image: "",
      carousel: {
        enabled: false,
        autoplay: true,
        interval: 5000,
        slides: [
          { id: uuidv4(), image: "", heading: "Transform Your Digital Presence", subheading: "Build amazing websites in minutes", ctaText: "Get Started", ctaLink: "#" },
          { id: uuidv4(), image: "", heading: "Powerful Features", subheading: "Everything you need to succeed online", ctaText: "Learn More", ctaLink: "#" },
        ],
      },
    },
  },
  {
    id: "features",
    type: SECTION_TYPES.FEATURES,
    name: "Features",
    icon: "zap",
    defaultProps: {
      variant: "grid",
      heading: "Everything You Need",
      subheading: "Powerful features to help you succeed",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      cardBackground: "#ffffff",
      cardBorderColor: "#f3f4f6",
      iconBackground: "#6366f1",
      iconColor: "#ffffff",
      titleColor: "#111827",
      descriptionColor: "#6b7280",
      features: [
        { id: uuidv4(), icon: "zap", title: "Lightning Fast", description: "Optimized for speed with instant load times" },
        { id: uuidv4(), icon: "shield", title: "Secure & Safe", description: "Enterprise-grade security built-in" },
        { id: uuidv4(), icon: "smartphone", title: "Mobile Ready", description: "Perfect on every device and screen size" },
        { id: uuidv4(), icon: "globe", title: "Global CDN", description: "Fast delivery worldwide" },
        { id: uuidv4(), icon: "code", title: "Developer Friendly", description: "Custom code when you need it" },
        { id: uuidv4(), icon: "trending-up", title: "SEO Optimized", description: "Rank higher in search results" },
      ],
      columns: 3,
    },
  },
  {
    id: "stats",
    type: SECTION_TYPES.STATS,
    name: "Stats & Numbers",
    icon: "bar-chart",
    defaultProps: {
      variant: "row",
      heading: "Our Impact",
      subheading: "Numbers speak louder than words",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      valueColor: "#6366f1",
      labelColor: "#111827",
      descriptionColor: "#6b7280",
      stats: [
        { id: uuidv4(), value: "100K+", label: "Active Users", description: "Worldwide" },
        { id: uuidv4(), value: "99.9%", label: "Uptime", description: "Guaranteed" },
        { id: uuidv4(), value: "4.9/5", label: "Rating", description: "Customer satisfaction" },
        { id: uuidv4(), value: "24/7", label: "Support", description: "Always available" },
      ],
    },
  },
  {
    id: "process",
    type: SECTION_TYPES.PROCESS,
    name: "Process",
    icon: "clock",
    defaultProps: {
      variant: "timeline",
      heading: "How It Works",
      subheading: "Simple steps to get started",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      iconBackground: "#6366f1",
      iconColor: "#ffffff",
      stepTitleColor: "#111827",
      stepDescColor: "#6b7280",
      stepDurationColor: "#6366f1",
      numberColor: "#6366f1",
      steps: [
        { id: uuidv4(), icon: "edit", title: "Plan", description: "Define your goals and requirements", duration: "12 days", number: "01" },
        { id: uuidv4(), icon: "code", title: "Build", description: "Create your website with our tools", duration: "35 days", number: "02" },
        { id: uuidv4(), icon: "rocket", title: "Launch", description: "Deploy and go live instantly", duration: "Same day", number: "03" },
      ],
    },
  },
  {
    id: "content",
    type: SECTION_TYPES.CONTENT,
    name: "Content / About",
    icon: "file-text",
    defaultProps: {
      variant: "text",
      heading: "Our Story",
      headingColor: "#111827",
      contentColor: "#374151",
      content: "<p>We believe in building tools that empower everyone to create amazing websites. Our platform combines simplicity with powerful features.</p><p>Join thousands of creators who have already transformed their online presence.</p>",
      image: "",
      imagePosition: "right",
    },
  },
  {
    id: "gallery",
    type: SECTION_TYPES.GALLERY,
    name: "Gallery / Portfolio",
    icon: "image",
    defaultProps: {
      variant: "grid",
      heading: "Our Work",
      subheading: "Explore our latest projects",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      overlayColor: "rgba(0,0,0,0.7)",
      titleColor: "#ffffff",
      categoryColor: "#d1d5db",
      items: [
        { id: uuidv4(), image: "", title: "Project Alpha", category: "Design", description: "A modern web design project" },
        { id: uuidv4(), image: "", title: "Project Beta", category: "Development", description: "Custom web application" },
        { id: uuidv4(), image: "", title: "Project Gamma", category: "Branding", description: "Complete brand identity" },
        { id: uuidv4(), image: "", title: "Project Delta", category: "Marketing", description: "Digital marketing campaign" },
        { id: uuidv4(), image: "", title: "Project Epsilon", category: "E-commerce", description: "Online store platform" },
        { id: uuidv4(), image: "", title: "Project Zeta", category: "Mobile", description: "Cross-platform app" },
      ],
      columns: 3,
      carousel: { enabled: false, autoplay: true, interval: 5000 },
    },
  },
  {
    id: "testimonials",
    type: SECTION_TYPES.TESTIMONIALS,
    name: "Testimonials",
    icon: "message-square",
    defaultProps: {
      variant: "grid",
      heading: "What Our Customers Say",
      subheading: "Real feedback from real people",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      cardBackground: "#ffffff",
      quoteColor: "#374151",
      nameColor: "#111827",
      roleColor: "#6b7280",
      metricColor: "#6366f1",
      starColor: "#f59e0b",
      testimonials: [
        { id: uuidv4(), name: "Sarah Mitchell", role: "Creative Director", content: "This platform transformed how we build websites.", avatar: "", rating: 5 },
        { id: uuidv4(), name: "James Chen", role: "Startup Founder", content: "Finally, a website builder that doesn't limit creativity.", avatar: "", rating: 5 },
        { id: uuidv4(), name: "Emily Rodriguez", role: "Marketing Manager", content: "The ROI has been incredible. We launched in days.", avatar: "", rating: 5, metric: "300% increase" },
      ],
      carousel: { enabled: false, autoplay: true, interval: 5000 },
    },
  },
  {
    id: "logos",
    type: SECTION_TYPES.LOGOS,
    name: "Logos / Partners",
    icon: "shield",
    defaultProps: {
      variant: "grid",
      heading: "Trusted by Industry Leaders",
      subheading: "Join thousands of companies using our platform",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      logoFilter: "grayscale",
      logos: [
        { id: uuidv4(), image: "", name: "Company 1", width: "120" },
        { id: uuidv4(), image: "", name: "Company 2", width: "120" },
        { id: uuidv4(), image: "", name: "Company 3", width: "120" },
        { id: uuidv4(), image: "", name: "Company 4", width: "120" },
        { id: uuidv4(), image: "", name: "Company 5", width: "120" },
        { id: uuidv4(), image: "", name: "Company 6", width: "120" },
      ],
      columns: 4,
      carousel: { enabled: false, autoplay: true, interval: 3000 },
    },
  },
  {
    id: "benefits",
    type: SECTION_TYPES.BENEFITS,
    name: "Benefits",
    icon: "award",
    defaultProps: {
      variant: "grid",
      heading: "Why Choose Us",
      subheading: "The advantages of working with us",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      cardBackground: "#ffffff",
      iconBackground: "#6366f1",
      iconColor: "#ffffff",
      titleColor: "#111827",
      descriptionColor: "#6b7280",
      metricColor: "#6366f1",
      benefits: [
        { id: uuidv4(), icon: "zap", title: "Lightning Fast", description: "10x faster performance", metric: "99.9%" },
        { id: uuidv4(), icon: "shield", title: "Bank Level Security", description: "Enterprise encryption", metric: "256-bit" },
        { id: uuidv4(), icon: "headphones", title: "24/7 Support", description: "Always here to help", metric: "< 5min" },
        { id: uuidv4(), icon: "trending-up", title: "Proven Results", description: "Average 3x ROI", metric: "+300%" },
      ],
    },
  },
  {
    id: "cta",
    type: SECTION_TYPES.CTA,
    name: "Call to Action",
    icon: "target",
    defaultProps: {
      variant: "simple",
      heading: "Ready to Get Started?",
      subheading: "Join thousands of satisfied customers today",
      headingColor: "#ffffff",
      subheadingColor: "rgba(255,255,255,0.85)",
      featureColor: "rgba(255,255,255,0.75)",
      primaryButton: { text: "Start Free Trial", link: "#", backgroundColor: "#ffffff", textColor: "#6366f1" },
      secondaryButton: { text: "Contact Sales", link: "#", borderColor: "#ffffff", textColor: "#ffffff" },
      features: ["No credit card required", "14-day free trial", "Cancel anytime"],
    },
  },
  {
    id: "pricing",
    type: SECTION_TYPES.PRICING,
    name: "Pricing",
    icon: "dollar-sign",
    defaultProps: {
      heading: "Choose Your Plan",
      subheading: "Flexible pricing that grows with you",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      cardBackground: "#ffffff",
      cardBorderColor: "#e5e7eb",
      highlightColor: "#6366f1",
      planNameColor: "#111827",
      planPriceColor: "#111827",
      planDescColor: "#6b7280",
      featureColor: "#374151",
      checkColor: "#22c55e",
      plans: [
        { id: uuidv4(), name: "Starter", price: "$12", period: "month", description: "Perfect for individuals", features: ["5 Projects", "10GB Storage", "Basic Support"], ctaText: "Get Started", ctaLink: "#", highlighted: false },
        { id: uuidv4(), name: "Pro", price: "$39", period: "month", description: "For professionals", features: ["Unlimited Projects", "100GB Storage", "Priority Support", "Advanced Features"], ctaText: "Start Trial", ctaLink: "#", highlighted: true, badge: "Most Popular" },
        { id: uuidv4(), name: "Enterprise", price: "Custom", period: "", description: "For large teams", features: ["Everything in Pro", "Unlimited Storage", "Dedicated Support", "Custom Features"], ctaText: "Contact Us", ctaLink: "#", highlighted: false },
      ],
    },
  },
  {
    id: "contact",
    type: SECTION_TYPES.CONTACT,
    name: "Contact Form",
    icon: "mail",
    defaultProps: {
      heading: "Get In Touch",
      subheading: "We'd love to hear from you",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      cardBackground: "#ffffff",
      labelColor: "#374151",
      inputBorderColor: "#e5e7eb",
      inputFocusColor: "#6366f1",
      buttonColor: "#6366f1",
      buttonTextColor: "#ffffff",
      submitText: "Send Message",
      successMessage: "Thanks! We'll get back to you soon.",
      errorMessage: "Something went wrong. Please try again.",
      fields: [
        { id: uuidv4(), type: "text", label: "Name", placeholder: "Your name", required: true },
        { id: uuidv4(), type: "email", label: "Email", placeholder: "your@email.com", required: true },
        { id: uuidv4(), type: "textarea", label: "Message", placeholder: "Your message...", required: true },
      ],
    },
  },
  {
    id: "team",
    type: SECTION_TYPES.TEAM,
    name: "Team",
    icon: "users",
    defaultProps: {
      heading: "Meet Our Team",
      subheading: "The people behind the product",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      nameColor: "#111827",
      roleColor: "#6366f1",
      bioColor: "#6b7280",
      members: [
        { id: uuidv4(), name: "Olivia Chen", role: "Creative Director", bio: "Leading design with passion and precision", image: "", socials: {} },
        { id: uuidv4(), name: "Marcus Thompson", role: "Head of Product", bio: "Building tools that empower creators", image: "", socials: {} },
        { id: uuidv4(), name: "Yuki Tanaka", role: "Lead Engineer", bio: "Crafting elegant technical solutions", image: "", socials: {} },
      ],
      columns: 3,
    },
  },
  {
    id: "faq",
    type: SECTION_TYPES.FAQ,
    name: "FAQ",
    icon: "help-circle",
    defaultProps: {
      heading: "Frequently Asked Questions",
      subheading: "Everything you need to know",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      cardBackground: "#ffffff",
      cardBorderColor: "#e5e7eb",
      questionColor: "#111827",
      answerColor: "#6b7280",
      badgeBackground: "#6366f1",
      badgeTextColor: "#ffffff",
      faqs: [
        { id: uuidv4(), question: "Do I need coding knowledge?", answer: "Not at all! Our platform is designed for everyone." },
        { id: uuidv4(), question: "Can I use my own domain?", answer: "Yes! You can connect any domain you own or purchase a new one." },
        { id: uuidv4(), question: "What kind of websites can I build?", answer: "Anything you can imagine! From portfolios to online stores." },
      ],
    },
  },
  {
    id: "newsletter",
    type: SECTION_TYPES.NEWSLETTER,
    name: "Newsletter",
    icon: "mail",
    defaultProps: {
      heading: "Stay Updated",
      subheading: "Get the latest news and updates delivered to your inbox",
      headingColor: "#ffffff",
      subheadingColor: "rgba(255,255,255,0.85)",
      inputBackground: "rgba(255,255,255,0.1)",
      inputTextColor: "#ffffff",
      inputBorderColor: "transparent",
      buttonColor: "#ffffff",
      buttonTextColor: "#6366f1",
      benefitColor: "rgba(255,255,255,0.75)",
      placeholder: "Enter your email",
      buttonText: "Subscribe",
      successMessage: "Thanks for subscribing!",
      errorMessage: "Something went wrong. Please try again.",
      benefits: ["Weekly insights", "Exclusive content", "Early access"],
    },
  },
  {
    id: "case-studies",
    type: SECTION_TYPES.CASE_STUDIES,
    name: "Case Studies",
    icon: "book-open",
    defaultProps: {
      heading: "Success Stories",
      subheading: "See how our clients have grown",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      cardBackground: "#ffffff",
      titleColor: "#111827",
      descriptionColor: "#6b7280",
      clientBadgeBackground: "#f3f4f6",
      clientBadgeColor: "#6b7280",
      resultBadgeBackground: "#dcfce7",
      resultBadgeColor: "#166534",
      metricValueColor: "#6366f1",
      metricLabelColor: "#6b7280",
      studies: [
        { id: uuidv4(), title: "Platform Redesign", client: "Acme Inc.", description: "Complete redesign resulting in 3x conversion improvement.", image: "", link: "#", results: ["3x Conversion", "50% Bounce Reduction"], metrics: [{ value: "+300%", label: "Conversion" }, { value: "-50%", label: "Bounce Rate" }, { value: "2mo", label: "Timeline" }] },
        { id: uuidv4(), title: "E-Commerce Launch", client: "ShopCo", description: "Launched a new online store from zero to $1M ARR in six months.", image: "", link: "#", results: ["$1M ARR", "100K Users"], metrics: [{ value: "$1M", label: "ARR" }, { value: "100K", label: "Users" }, { value: "6mo", label: "To Launch" }] },
      ],
    },
  },
  {
    id: "trust",
    type: SECTION_TYPES.TRUST,
    name: "Trust & Security",
    icon: "shield-check",
    defaultProps: {
      heading: "Trusted & Secure",
      subheading: "Your data is safe with us",
      headingColor: "#111827",
      subheadingColor: "#6b7280",
      iconBackground: "#eef2ff",
      iconColor: "#6366f1",
      badgeTitleColor: "#111827",
      badgeDescColor: "#6b7280",
      awardBackground: "#ffffff",
      awardBorderColor: "#e5e7eb",
      awardTextColor: "#374151",
      badges: [
        { id: uuidv4(), icon: "shield", title: "SOC 2 Certified", description: "Enterprise security standards" },
        { id: uuidv4(), icon: "lock", title: "256-bit Encryption", description: "Bank-level data protection" },
        { id: uuidv4(), icon: "check-circle", title: "GDPR Compliant", description: "Full privacy regulation adherence" },
        { id: uuidv4(), icon: "award", title: "ISO 27001", description: "International security certification" },
      ],
      testimonials: [],
      awards: ["G2 Leader 2024", "Product Hunt #1", "Forbes Top 100"],
    },
  },
];

export const createNewSection = (libraryItem) => {
  const isStructural = libraryItem.type === SECTION_TYPES.HEADER || libraryItem.type === SECTION_TYPES.FOOTER;
  return {
    id: `section-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
    type: libraryItem.type,
    templateId: libraryItem.id,
    props: JSON.parse(JSON.stringify(libraryItem.defaultProps)),
    style: isStructural ? {} : {
      padding: { top: "4rem", bottom: "4rem" },
      backgroundType: "color",
      backgroundColor: "transparent",
      backgroundGradient: "",
      backgroundImage: "",
      backgroundOverlay: 0,
    },
  };
};

prompt:
i want it that i want to be able to control the logo size u get
i want this u know they is colors in the setting modal i want it that in the PropertiesPanel where they want to choose color it will bring the list of the color from the settingModal they can choose and they can add there thousands
in the header i want to be able to add search u get, like an icon u get
 and i want that i must be able to control all the color no default color u get
and also that link to oother sections i want it to be like a dropdown to all the sections available u get so they should not be wasting they time trying to copy and paste it one by one but there can still do that o, like in any nav they can choose ok to features u get


give me full code of the page changed with no comments