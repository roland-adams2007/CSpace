FIlePickerModal.jsx:
import { useState, useEffect } from "react";
import {
  X,
  Upload,
  Image as ImageIcon,
  File,
  Loader2,
  Search,
  Trash2,
} from "lucide-react";
import { useAssetStore } from "../../../store/store";
import { fileToBase64 } from "../../../utils/fileToBase64";
import Pagination from "./Pagination"; // Make sure to import the Pagination component

export default function FilePickerModal({
  isOpen,
  onClose,
  onSelectFile,
  websiteId,
  allowedTypes = ["image"],
}) {
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedFile, setSelectedFile] = useState(null);
  const [uploading, setUploading] = useState(false);
  const [currentPage, setCurrentPage] = useState(1);
  const [itemsPerPage] = useState(20); // You can adjust this value

  const {
    assets,
    loading,
    totalPages,
    totalItems,
    fetchAssets,
    uploadAsset,
    deleteAsset
  } = useAssetStore();

  useEffect(() => {
    if (isOpen && websiteId) {
      fetchAssets(websiteId, currentPage, itemsPerPage);
    }
  }, [isOpen, websiteId, currentPage, itemsPerPage, fetchAssets]);

  // Reset page when search changes
  useEffect(() => {
    setCurrentPage(1);
  }, [searchQuery]);

  const handleFileUpload = async (event) => {
    const file = event.target.files?.[0];
    if (!file) return;

    if (allowedTypes.includes("image") && !file.type.startsWith("image/")) {
      alert("Please select an image file");
      return;
    }

    setUploading(true);
    try {
      const base64Data = await fileToBase64(file);

      const payload = {
        file: base64Data,
        filename: file.name,
        filetype: file.type,
        website_id: websiteId,
        file_size: file.size,
        file_original_name: file.name,
      };

      const newFile = await uploadAsset(payload);
      setSelectedFile(newFile);
      // Refresh the current page to show the new file
      fetchAssets(websiteId, currentPage, itemsPerPage);
    } catch (error) {
      console.error("Failed to upload file:", error);
      alert("Failed to upload file");
    } finally {
      setUploading(false);
    }
  };

  const handleDeleteFile = async (fileId) => {
    if (!confirm("Are you sure you want to delete this file?")) return;

    try {
      await deleteAsset(fileId);
      if (selectedFile?.id === fileId) {
        setSelectedFile(null);
      }
      // Refresh the current page after deletion
      fetchAssets(websiteId, currentPage, itemsPerPage);
    } catch (error) {
      console.error("Failed to delete file:", error);
      alert("Failed to delete file");
    }
  };

  const handleSelect = () => {
    if (selectedFile) {
      onSelectFile(selectedFile);
      onClose();
    }
  };

  const handlePageChange = (page) => {
    setCurrentPage(page);
  };

  // Filter assets based on search query and allowed types
  const filteredAssets = assets.filter((file) => {
    const matchesSearch = file.file_original_name
      ?.toLowerCase()
      .includes(searchQuery.toLowerCase());
    const matchesType =
      allowedTypes.includes("all") ||
      (allowedTypes.includes("image") && file.mime_type?.startsWith("image"));
    return matchesSearch && matchesType;
  });

  const getFileUrl = (file) => {
    if (file.file_path && file.file_path.startsWith("http")) {
      return file.file_path;
    }
    return `${import.meta.env.VITE_APP_URL}${file.file_path}`;
  };

  const formatFileSize = (bytes) => {
    if (!bytes) return "0 KB";
    const kb = bytes / 1024;
    if (kb < 1024) return `${kb.toFixed(1)} KB`;
    return `${(kb / 1024).toFixed(1)} MB`;
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4">
      <div className="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] flex flex-col">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <div>
            <h2 className="text-xl font-semibold text-gray-900">Select File</h2>
            <p className="text-sm text-gray-500 mt-1">
              Choose a file or upload a new one
            </p>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <X className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        <div className="p-6 border-b border-gray-200">
          <div className="flex gap-3">
            <div className="flex-1 relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
              <input
                type="text"
                placeholder="Search files..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <label className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors cursor-pointer flex items-center gap-2">
              {uploading ? (
                <>
                  <Loader2 className="w-4 h-4 animate-spin" />
                  <span>Uploading...</span>
                </>
              ) : (
                <>
                  <Upload className="w-4 h-4" />
                  <span>Upload</span>
                </>
              )}
              <input
                type="file"
                className="hidden"
                onChange={handleFileUpload}
                accept={allowedTypes.includes("image") ? "image/*" : "*"}
                disabled={uploading}
              />
            </label>
          </div>
        </div>

        <div className="flex-1 overflow-y-auto p-6">
          {loading ? (
            <div className="flex items-center justify-center h-64">
              <Loader2 className="w-8 h-8 text-indigo-600 animate-spin" />
            </div>
          ) : filteredAssets.length > 0 ? (
            <>
              <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                {filteredAssets.map((file) => {
                  const isImage =
                    file.mime_type?.startsWith("image/") ||
                    file.mime_type === "image";
                  const isSelected = selectedFile?.id === file.id;

                  return (
                    <div
                      key={file.id}
                      onClick={() => setSelectedFile(file)}
                      className={`group relative border-2 rounded-lg overflow-hidden cursor-pointer transition-all ${
                        isSelected
                          ? "border-indigo-500 ring-2 ring-indigo-100"
                          : "border-gray-200 hover:border-gray-300"
                      }`}
                    >
                      <div className="aspect-square bg-gray-50 flex items-center justify-center">
                        {isImage ? (
                          <img
                            src={getFileUrl(file)}
                            loading="lazy"
                            alt={file.file_original_name}
                            className="w-full h-full object-cover"
                            onError={(e) => {
                              e.target.onerror = null;
                              e.target.src =
                                "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIGZpbGw9IiNGRjVFNTAiLz48cGF0aCBkPSJNMzAgMzVMMjUgMjVMMjAgMzVIMzVaTTM1IDQwSDI1TDMwIDMwTDM1IDQwWiIgZmlsbD0id2hpdGUiLz48L3N2Zz4=";
                            }}
                          />
                        ) : (
                          <File className="w-12 h-12 text-gray-400" />
                        )}
                      </div>

                      {isSelected && (
                        <div className="absolute top-2 right-2 w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center">
                          <svg
                            className="w-4 h-4 text-white"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                          >
                            <path
                              fillRule="evenodd"
                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                              clipRule="evenodd"
                            />
                          </svg>
                        </div>
                      )}

                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          handleDeleteFile(file.id);
                        }}
                        className="absolute top-2 left-2 p-1.5 bg-red-600 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700"
                        title="Delete file"
                      >
                        <Trash2 className="w-3 h-3" />
                      </button>

                      <div className="p-2 border-t border-gray-200 bg-white">
                        <p className="text-xs font-medium text-gray-900 truncate">
                          {file.file_original_name}
                        </p>
                        <p className="text-xs text-gray-500">
                          {formatFileSize(file.file_size)}
                        </p>
                      </div>
                    </div>
                  );
                })}
              </div>

              {/* Pagination Component */}
              <Pagination
                currentPage={currentPage}
                totalPages={totalPages}
                onPageChange={handlePageChange}
                loading={loading}
                totalItems={totalItems}
                itemsPerPage={itemsPerPage}
              />
            </>
          ) : (
            <div className="flex flex-col items-center justify-center h-64 text-center">
              <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                <ImageIcon className="w-8 h-8 text-gray-400" />
              </div>
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                No files found
              </h3>
              <p className="text-sm text-gray-500 mb-4">
                Upload your first file to get started
              </p>
            </div>
          )}
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-between items-center">
          <p className="text-sm text-gray-500">
            {selectedFile
              ? `Selected: ${selectedFile.file_original_name}`
              : "No file selected"}
          </p>
          <div className="flex gap-3">
            <button
              onClick={onClose}
              className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              onClick={handleSelect}
              disabled={!selectedFile}
              className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Select File
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

assetSTore:
import { create } from "zustand";
import axiosInstance from "./../../api/axiosInstance";

export const useAssetStore = create((set, get) => ({
  assets: [],
  loading: false,
  error: null,

  fetchAssets: async (websiteId, page = 1, limit = 10) => {
    set({ loading: true, error: null });

    try {
      const response = await axiosInstance.get(`/assets`, {
        params: {
          website_id: websiteId,
          page,
          per_page: limit,
        },
      });

      const { assets, meta } = response.data.data;

      set({
        assets: assets || [],
        pagination: {
          currentPage: meta?.current_page || page,
          lastPage: meta?.last_page || 1,
          total: meta?.total || 0,
          perPage: meta?.per_page || limit,
        },
        loading: false,
      });

      return assets;
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to load assets",
        loading: false,
      });
      throw error;
    }
  },
  uploadAsset: async (payload) => {
    set({ loading: true, error: null });
    try {
      const response = await axiosInstance.post("/assets/upload", payload, {
        headers: { "Content-Type": "application/json" },
      });
      const newAsset = response.data.data.asset;
      set((state) => ({
        assets: [newAsset, ...state.assets],
        loading: false,
      }));
      return newAsset;
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to upload asset",
        loading: false,
      });
      throw error;
    }
  },

  deleteAsset: async (assetId) => {
    set({ loading: true, error: null });
    try {
      await axiosInstance.delete(`/assets/${assetId}`);
      set((state) => ({
        assets: state.assets.filter((asset) => asset.id !== assetId),
        loading: false,
      }));
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to delete asset",
        loading: false,
      });
      throw error;
    }
  },

  clearAssets: () => {
    set({ assets: [], error: null });
  },
}));


Pagination:
import { ChevronLeft, ChevronRight } from "lucide-react";

const Pagination = ({ 
  currentPage, 
  totalPages, 
  onPageChange, 
  loading = false,
  totalItems = 0,
  itemsPerPage = 20
}) => {
  if (totalPages <= 1) return null;

  const pageNumbers = [];
  const maxVisiblePages = 5;
  
  let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
  let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
  
  if (endPage - startPage + 1 < maxVisiblePages) {
    startPage = Math.max(1, endPage - maxVisiblePages + 1);
  }

  for (let i = startPage; i <= endPage; i++) {
    pageNumbers.push(i);
  }

  const startItem = (currentPage - 1) * itemsPerPage + 1;
  const endItem = Math.min(currentPage * itemsPerPage, totalItems);

  return (
    <div className="flex flex-col sm:flex-row items-center justify-between mt-8 pt-6 border-t border-gray-800">
      <div className="text-sm text-gray-400 mb-4 sm:mb-0">
        Showing {startItem}-{endItem} of {totalItems} files
      </div>
      
      <div className="flex items-center space-x-2">
        <button
          onClick={() => onPageChange(currentPage - 1)}
          disabled={currentPage === 1 || loading}
          className={`p-2 rounded-lg border border-gray-700 ${
            currentPage === 1 || loading
              ? 'opacity-50 cursor-not-allowed text-gray-500'
              : 'hover:bg-gray-800 text-gray-300 hover:border-blue-500'
          }`}
        >
          <ChevronLeft size={18} />
        </button>

        {startPage > 1 && (
          <>
            <button
              onClick={() => onPageChange(1)}
              disabled={loading}
              className={`px-3 py-1.5 rounded-lg text-sm ${
                1 === currentPage
                  ? 'bg-blue-600 text-white'
                  : 'border border-gray-700 hover:bg-gray-800 text-gray-300'
              } ${loading ? 'opacity-50' : ''}`}
            >
              1
            </button>
            {startPage > 2 && (
              <span className="text-gray-500 px-1">...</span>
            )}
          </>
        )}

        {pageNumbers.map((page) => (
          <button
            key={page}
            onClick={() => onPageChange(page)}
            disabled={loading}
            className={`px-3 py-1.5 rounded-lg text-sm min-w-[40px] ${
              page === currentPage
                ? 'bg-blue-600 text-white'
                : 'border border-gray-700 hover:bg-gray-800 text-gray-300'
            } ${loading ? 'opacity-50' : ''}`}
          >
            {page}
          </button>
        ))}

        {endPage < totalPages && (
          <>
            {endPage < totalPages - 1 && (
              <span className="text-gray-500 px-1">...</span>
            )}
            <button
              onClick={() => onPageChange(totalPages)}
              disabled={loading}
              className={`px-3 py-1.5 rounded-lg text-sm ${
                totalPages === currentPage
                  ? 'bg-blue-600 text-white'
                  : 'border border-gray-700 hover:bg-gray-800 text-gray-300'
              } ${loading ? 'opacity-50' : ''}`}
            >
              {totalPages}
            </button>
          </>
        )}

        <button
          onClick={() => onPageChange(currentPage + 1)}
          disabled={currentPage === totalPages || loading}
          className={`p-2 rounded-lg border border-gray-700 ${
            currentPage === totalPages || loading
              ? 'opacity-50 cursor-not-allowed text-gray-500'
              : 'hover:bg-gray-800 text-gray-300 hover:border-blue-500'
          }`}
        >
          <ChevronRight size={18} />
        </button>
      </div>
    </div>
  );
};

export default Pagination;

asset.controller.js:
const asyncHandler = require("express-async-handler");
const { responseHandler } = require("../middleware/responseHandler.js");
const Asset = require("../models/asset.model.js");
const Website = require("../models/website.model.js");
const { v4: uuidv4 } = require("uuid");
const axios = require("axios");
const { file_config } = require("../config/config.inc.js");

const getAssets = asyncHandler(async function (req, res) {
  const { website_id, page = 1, per_page = 10 } = req.query;
  const userId = req.user?.id;

  if (!userId) {
    res.status(401);
    throw new Error("User not authenticated");
  }

  if (!website_id) {
    res.status(400);
    throw new Error("Website ID is required");
  }

  const hasAccess = await Website.checkUserAccess(website_id, userId);
  if (!hasAccess) {
    res.status(403);
    throw new Error("Access denied to this website");
  }

  const currentPage = parseInt(page);
  const limit = parseInt(per_page);
  const offset = (currentPage - 1) * limit;

  const { assets, total } = await Asset.findByWebsite(
    website_id,
    limit,
    offset,
  );

  res.status(200);
  responseHandler(
    res,
    {
      assets,
      meta: {
        current_page: currentPage,
        per_page: limit,
        total,
        last_page: Math.ceil(total / limit),
      },
    },
    "Assets retrieved",
  );
});

const uploadAsset = asyncHandler(async function (req, res) {
  const { website_id, file } = req.body;
  const userId = req.user?.id;

  if (!userId) {
    res.status(401);
    throw new Error("User not authenticated");
  }

  if (!website_id) {
    res.status(400);
    throw new Error("Website ID is required");
  }

  const hasAccess = await Website.checkUserAccess(website_id, userId);
  if (!hasAccess) {
    res.status(403);
    throw new Error("Access denied to this website");
  }

  if (!file) {
    res.status(400);
    throw new Error("No file uploaded");
  }

  try {
    const response = await axios.post(
      "https://projectapi.tixora.com.ng/fileflow/files/api/upload",
      {
        image: file,
        folderName: String(userId) || "general",
      },
      {
        headers: {
          Authorization: `Bearer ${file_config.apiKey}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (!response.data || !response.data.data) {
      throw new Error("Invalid response from file upload service");
    }

    const uploadData = response.data.data;
    const nowUtc = new Date().toISOString().slice(0, 19).replace("T", " ");

    const assetId = await Asset.create({
      website_id,
      file_uuid: uploadData.uuid || uuidv4(),
      file_original_name: uploadData.file_original_name,
      file_url: uploadData.file_url,
      file_name: uploadData.file_name,
      file_size: uploadData.file_size,
      mime_type: uploadData.type,
      extension: uploadData.extension,
      created_at: nowUtc,
    });

    if (!assetId) {
      res.status(500);
      throw new Error("Failed to save asset");
    }

    const asset = await Asset.findById(assetId);

    res.status(201);
    responseHandler(res, { asset }, "File uploaded successfully");
  } catch (error) {
    res.status(500);
    throw new Error(`File upload failed: ${error.message}`);
  }
});

const deleteAsset = asyncHandler(async function (req, res) {
  const { assetId } = req.params;
  const userId = req.user?.id;

  if (!userId) {
    res.status(401);
    throw new Error("User not authenticated");
  }

  const asset = await Asset.findById(assetId);

  if (!asset) {
    res.status(404);
    throw new Error("Asset not found");
  }

  const hasAccess = await Website.checkUserAccess(asset.website_id, userId);
  if (!hasAccess) {
    res.status(403);
    throw new Error("Access denied");
  }

  const deleted = await Asset.delete(assetId);

  if (!deleted) {
    res.status(500);
    throw new Error("Failed to delete asset");
  }

  res.status(200);
  responseHandler(res, null, "Asset deleted successfully");
});

module.exports = {
  getAssets,
  uploadAsset,
  deleteAsset,
};


prompt:
help me do the FilePickerModal an assetStore to match the controller, and use pagination limit of 10 picture tho


give me full code with no comments