ThemeEditor.jsx:
import { useThemeStore } from "../store/store";
import SectionLibrary from "../components/ui/theme/SectionLibrary";
import Canvas from "../components/ui/theme/Canvas";
import PropertiesPanel from "../components/ui/theme/PropertiesPanel";
import EditorHeader from "../components/ui/theme/EditorHeader";
import TemplateModal from "../components/ui/modals/theme/TemplateModal";
import SettingsModal from "../components/ui/modals/theme/SettingsModal";
import SkeletonLoader from "../components/ui/theme/SkeletonLoader";

export default function ThemeEditor() {
  const { useThemeEditor } = useThemeStore();

  const {
    theme,
    config,
    saving,
    loading,
    isLoading,
    isDirty,
    selectedTemplate,
    showSettings,
    showTemplateModal,
    canUndo,
    canRedo,
    templates,
    setShowSettings,
    setShowTemplateModal,
    handleSave,
    handleAddSection,
    handlePreview,
    handleClose,
    applyTemplate,
    handleThemeChange,
    undo,
    redo,
  } = useThemeEditor();

  if (isLoading || loading || !theme) {
    return <SkeletonLoader />;
  }

  return (
    <div className="h-screen flex flex-col bg-gray-50">
      <EditorHeader
        theme={theme}
        isDirty={isDirty}
        saving={saving}
        canUndo={canUndo}
        canRedo={canRedo}
        onClose={handleClose}
        onUndo={undo}
        onRedo={redo}
        onPreview={handlePreview}
        onSave={handleSave}
        onOpenTemplateModal={() => setShowTemplateModal(true)}
        onToggleSettings={() => setShowSettings(!showSettings)}
      />

      <div className="flex-1 flex overflow-hidden">
        <div className="w-64 flex-shrink-0">
          <SectionLibrary onAddSection={handleAddSection} />
        </div>

        <div className="flex-1 overflow-hidden">
          <Canvas selectedTemplate={selectedTemplate} />
        </div>

        <div className="w-80 flex-shrink-0">
          <PropertiesPanel />
        </div>
      </div>

      <TemplateModal
        isOpen={showTemplateModal}
        onClose={() => setShowTemplateModal(false)}
        onApplyTemplate={applyTemplate}
        selectedTemplate={selectedTemplate}
        templates={templates}
        currentSectionsCount={config.layout?.sections?.length}
      />

      <SettingsModal
        isOpen={showSettings}
        onClose={() => setShowSettings(false)}
        theme={theme}
        onThemeChange={handleThemeChange}
        config={config}
        onSave={handleSave}
        originalSlug={theme?.slug}
      />
    </div>
  );
}

SectionLibrary.jsx:
import { SECTION_LIBRARY } from "../../../utils/sectionLibrary";
import * as LucideIcons from "lucide-react";

const CATEGORIES = [
  { name: "Hero", types: ["hero"], icon: "layout" },
  { name: "Features & Benefits", types: ["features", "benefits"], icon: "zap" },
  { name: "Stats & Process", types: ["stats", "process"], icon: "bar-chart" },
  { name: "Content & Media", types: ["content", "gallery"], icon: "image" },
  { name: "Social Proof", types: ["testimonials", "team", "case-studies"], icon: "users" },
  { name: "Trust & Logos", types: ["logos", "trust"], icon: "shield" },
  { name: "Conversion", types: ["cta", "pricing", "contact", "newsletter"], icon: "target" },
  { name: "Information", types: ["faq"], icon: "help-circle" },
];

const getIcon = (iconName) => {
  if (!iconName) return LucideIcons.Box;
  const pascal = iconName
    .split("-")
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join("");
  return LucideIcons[pascal] || LucideIcons.Box;
};

export default function SectionLibrary({ onAddSection }) {
  return (
    <div className="h-full flex flex-col bg-white border-r border-gray-200">
      {/* Header */}
      <div className="p-5 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50">
        <div className="flex items-center gap-3">
          <div className="w-9 h-9 bg-indigo-100 rounded-lg flex items-center justify-center">
            <LucideIcons.Plus className="w-5 h-5 text-indigo-600" />
          </div>
          <div>
            <h3 className="text-sm font-bold text-gray-900">Add Sections</h3>
            <p className="text-xs text-gray-500">Click to add to canvas</p>
          </div>
        </div>
      </div>

      {/* Section list */}
      <div className="flex-1 overflow-y-auto p-4 space-y-6">
        {CATEGORIES.map((cat) => {
          const items = SECTION_LIBRARY.filter((item) =>
            cat.types.includes(item.type)
          );
          if (items.length === 0) return null;
          const CatIcon = getIcon(cat.icon);

          return (
            <div key={cat.name}>
              <div className="flex items-center gap-2 mb-3">
                <div className="w-5 h-5 bg-gray-100 rounded flex items-center justify-center">
                  <CatIcon className="w-3.5 h-3.5 text-gray-500" />
                </div>
                <span className="text-[10px] font-bold text-gray-500 uppercase tracking-widest">
                  {cat.name}
                </span>
              </div>

              <div className="space-y-2">
                {items.map((item) => {
                  const Icon = getIcon(item.icon);
                  return (
                    <button
                      key={item.id}
                      onClick={() => onAddSection(item)}
                      className="w-full group relative overflow-hidden"
                    >
                      <div className="flex items-center gap-3 p-3 rounded-xl border-2 border-gray-100 hover:border-indigo-400 hover:shadow-md transition-all bg-white">
                        <div className="w-10 h-10 bg-gray-50 rounded-lg flex items-center justify-center group-hover:bg-indigo-50 transition-colors flex-shrink-0">
                          <Icon className="w-5 h-5 text-gray-500 group-hover:text-indigo-600 transition-colors" />
                        </div>
                        <div className="flex-1 text-left min-w-0">
                          <p className="text-sm font-semibold text-gray-800 group-hover:text-indigo-700 transition-colors">
                            {item.name}
                          </p>
                          <p className="text-xs text-gray-400 capitalize">
                            {item.type} section
                          </p>
                        </div>
                        <LucideIcons.Plus className="w-4 h-4 text-gray-300 group-hover:text-indigo-500 transition-colors flex-shrink-0" />
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          );
        })}

        {/* Tip */}
        <div className="pb-4">
          <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 border border-indigo-100">
            <div className="flex items-start gap-2">
              <LucideIcons.Lightbulb className="w-4 h-4 text-indigo-500 mt-0.5 flex-shrink-0" />
              <div>
                <p className="text-xs font-bold text-gray-800 mb-0.5">Pro Tip</p>
                <p className="text-xs text-gray-500 leading-relaxed">
                  Start with a Hero, add Features, build trust with Stats & Testimonials, then close with a strong CTA. Use the Properties panel to switch layout variants.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

PropertiesPanel.jsx:
import { useState } from "react";
import { useEditorStore } from "../../../store/store";
import {
  X,
  Plus,
  Trash2,
  ChevronDown,
  ChevronUp,
  Image as ImageIcon,
  Settings,
  Film,
  Layers,
} from "lucide-react";
import { useWebsiteStore } from "../../../store/store";
import FilePickerModal from "../modals/FilePickerModal";
import { v4 as uuidv4 } from "uuid";
import { SECTION_VARIANTS } from "../../../utils/sectionLibrary";

export default function PropertiesPanel() {
  const { selectedWebsite } = useWebsiteStore();
  const {
    config,
    selectedSection,
    selectedHeader,
    selectedFooter,
    updateSection,
    updateConfig,
    selectSection,
    selectHeader,
    selectFooter,
  } = useEditorStore();

  const [expandedSections, setExpandedSections] = useState({});
  const [showFilePicker, setShowFilePicker] = useState(false);
  const [currentImageField, setCurrentImageField] = useState(null);

  const toggleExpanded = (key) =>
    setExpandedSections((prev) => ({ ...prev, [key]: !prev[key] }));

  const openFilePicker = (fieldInfo) => {
    setCurrentImageField(fieldInfo);
    setShowFilePicker(true);
  };

  const handleFileSelect = (file) => {
    if (!currentImageField) return;
    const fileUrl = file.file_path;

    if (currentImageField.type === "header") {
      if (currentImageField.field === "logo")
        updateConfig("header.props.logo", fileUrl);
    } else if (currentImageField.sectionId) {
      if (currentImageField.arrayPath) {
        if (currentImageField.arrayPath === "carousel.slides") {
          const sec = config.layout.sections.find(
            (s) => s.id === currentImageField.sectionId,
          );
          if (!sec) return;
          const slides = [...(sec.props.carousel?.slides || [])];
          slides[currentImageField.index] = {
            ...slides[currentImageField.index],
            [currentImageField.field]: fileUrl,
          };
          const newProps = {
            ...sec.props,
            carousel: { ...sec.props.carousel, slides },
          };
          updateSection(currentImageField.sectionId, { props: newProps });
        } else {
          updateArrayItem(
            currentImageField.arrayPath,
            currentImageField.index,
            currentImageField.field,
            fileUrl,
          );
        }
      } else if (currentImageField.isStyle) {
        updateStyle(currentImageField.field, fileUrl);
      } else {
        updateProp(currentImageField.field, fileUrl);
      }
    }
    setShowFilePicker(false);
    setCurrentImageField(null);
  };

  // ── No selection ──────────────────────────────────────────────
  if (!selectedSection && !selectedHeader && !selectedFooter) {
    return (
      <div className="h-full flex flex-col bg-white border-l border-gray-200">
        <div className="p-4 border-b border-gray-200">
          <h3 className="text-sm font-semibold text-gray-900 mb-0.5">
            Theme Settings
          </h3>
          <p className="text-xs text-gray-500">Configure your theme</p>
        </div>
        <div className="flex-1 overflow-y-auto p-4 space-y-3">
          <button
            onClick={() => selectHeader()}
            className="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-left"
          >
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                <Settings className="w-5 h-5 text-indigo-600" />
              </div>
              <div>
                <p className="text-sm font-medium text-gray-900">
                  Header Settings
                </p>
                <p className="text-xs text-gray-500">
                  Logo, navigation & style
                </p>
              </div>
            </div>
          </button>
          <button
            onClick={() => selectFooter()}
            className="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-left"
          >
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                <Settings className="w-5 h-5 text-indigo-600" />
              </div>
              <div>
                <p className="text-sm font-medium text-gray-900">
                  Footer Settings
                </p>
                <p className="text-xs text-gray-500">
                  Columns, newsletter & style
                </p>
              </div>
            </div>
          </button>
          <div className="pt-4 border-t border-gray-200">
            <p className="text-xs text-gray-500 text-center">
              Click on a section in the canvas to edit its properties
            </p>
          </div>
        </div>
      </div>
    );
  }

  // ── Header ────────────────────────────────────────────────────
  if (selectedHeader) {
    return (
      <div className="h-full flex flex-col bg-white border-l border-gray-200">
        <PanelHeader
          title="Header Settings"
          onClose={() => selectHeader(false)}
        />
        <div className="flex-1 overflow-y-auto p-4">
          {/* Style */}
          <SectionBlock title="Style">
            <div className="space-y-4">
              <LabeledField label="Height (px)">
                <input
                  type="number"
                  value={parseInt(config.header.style?.height) || 80}
                  onChange={(e) =>
                    updateConfig("header.style.height", `${e.target.value}px`)
                  }
                  className={INPUT_CLS}
                />
              </LabeledField>
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={config.header.style?.sticky || false}
                  onChange={(e) =>
                    updateConfig("header.style.sticky", e.target.checked)
                  }
                  className="rounded border-gray-300 text-indigo-600"
                />
                <span className="text-sm text-gray-700">Sticky Header</span>
              </label>
              <ColorField
                label="Background Color"
                value={config.header.style?.backgroundColor || "#ffffff"}
                onChange={(v) =>
                  updateConfig("header.style.backgroundColor", v)
                }
              />
            </div>
          </SectionBlock>

          {/* Logo */}
          <SectionBlock title="Logo">
            {config.header.props.logo && (
              <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                <img
                  src={config.header.props.logo}
                  alt="Logo"
                  className="w-full h-20 object-contain"
                />
                <button
                  onClick={() => updateConfig("header.props.logo", "")}
                  className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded hover:bg-red-700"
                >
                  <X className="w-3 h-3" />
                </button>
              </div>
            )}
            <FileButton
              onClick={() => openFilePicker({ type: "header", field: "logo" })}
              label={config.header.props.logo ? "Change Logo" : "Upload Logo"}
            />
          </SectionBlock>

          {/* Navigation */}
          <SectionBlock
            title={`Navigation Menu (${config.header.props.menu?.length || 0})`}
            action={
              <button
                onClick={() =>
                  updateConfig("header.props.menu", [
                    ...(config.header.props.menu || []),
                    { id: Date.now().toString(), label: "New Link", url: "#" },
                  ])
                }
                className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
              >
                <Plus className="w-4 h-4" />
              </button>
            }
          >
            <div className="space-y-2">
              {(config.header.props.menu || []).map((item, idx) => (
                <div key={item.id || idx} className="bg-gray-50 p-3 rounded-lg">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-xs font-medium text-gray-600">
                      Link {idx + 1}
                    </span>
                    <button
                      onClick={() => {
                        const menu = [...config.header.props.menu];
                        menu.splice(idx, 1);
                        updateConfig("header.props.menu", menu);
                      }}
                      className="p-1 text-red-600 hover:bg-red-50 rounded"
                    >
                      <Trash2 className="w-3 h-3" />
                    </button>
                  </div>
                  <input
                    type="text"
                    placeholder="Label"
                    value={item.label}
                    onChange={(e) => {
                      const menu = [...config.header.props.menu];
                      menu[idx] = { ...menu[idx], label: e.target.value };
                      updateConfig("header.props.menu", menu);
                    }}
                    className={`${INPUT_CLS} mb-2`}
                  />
                  <input
                    type="text"
                    placeholder="URL"
                    value={item.url || item.link || ""}
                    onChange={(e) => {
                      const menu = [...config.header.props.menu];
                      menu[idx] = {
                        ...menu[idx],
                        url: e.target.value,
                        link: e.target.value,
                      };
                      updateConfig("header.props.menu", menu);
                    }}
                    className={INPUT_CLS}
                  />
                </div>
              ))}
            </div>
          </SectionBlock>

          {/* CTA */}
          <SectionBlock title="CTA Button">
            <input
              type="text"
              placeholder="Button Text"
              value={config.header.props.ctaButton?.text || ""}
              onChange={(e) =>
                updateConfig("header.props.ctaButton", {
                  ...config.header.props.ctaButton,
                  text: e.target.value,
                })
              }
              className={`${INPUT_CLS} mb-2`}
            />
            <input
              type="text"
              placeholder="Button Link"
              value={config.header.props.ctaButton?.link || ""}
              onChange={(e) =>
                updateConfig("header.props.ctaButton", {
                  ...config.header.props.ctaButton,
                  link: e.target.value,
                })
              }
              className={INPUT_CLS}
            />
          </SectionBlock>
        </div>

        <FilePicker
          show={showFilePicker}
          websiteId={selectedWebsite?.id}
          onClose={() => {
            setShowFilePicker(false);
            setCurrentImageField(null);
          }}
          onSelect={handleFileSelect}
        />
      </div>
    );
  }

  // ── Footer ────────────────────────────────────────────────────
  if (selectedFooter) {
    const fp = config.footer.props;
    return (
      <div className="h-full flex flex-col bg-white border-l border-gray-200">
        <PanelHeader
          title="Footer Settings"
          onClose={() => selectFooter(false)}
        />
        <div className="flex-1 overflow-y-auto p-4">
          {/* Style */}
          <SectionBlock title="Style">
            <div className="space-y-4">
              <ColorField
                label="Background Color"
                value={
                  fp.backgroundColor ||
                  config.footer.style?.backgroundColor ||
                  "#111827"
                }
                onChange={(v) =>
                  updateConfig("footer.style.backgroundColor", v)
                }
              />
              <ColorField
                label="Text Color"
                value={config.footer.style?.textColor || "#ffffff"}
                onChange={(v) => updateConfig("footer.style.textColor", v)}
              />
              <LabeledField label="Padding">
                <input
                  type="text"
                  value={config.footer.style?.padding || "3rem 0"}
                  onChange={(e) =>
                    updateConfig("footer.style.padding", e.target.value)
                  }
                  placeholder="3rem 0"
                  className={INPUT_CLS}
                />
              </LabeledField>
            </div>
          </SectionBlock>

          {/* Columns */}
          <SectionBlock
            title={`Footer Columns (${fp.columns?.length || 0})`}
            action={
              <button
                onClick={() =>
                  updateConfig("footer.props.columns", [
                    ...(fp.columns || []),
                    {
                      id: Date.now().toString(),
                      title: "New Column",
                      links: [],
                    },
                  ])
                }
                className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
              >
                <Plus className="w-4 h-4" />
              </button>
            }
          >
            <div className="space-y-3">
              {(fp.columns || []).map((col, idx) => (
                <div key={col.id || idx} className="bg-gray-50 p-3 rounded-lg">
                  <div className="flex items-center justify-between mb-2">
                    <input
                      type="text"
                      placeholder="Column Title"
                      value={col.title}
                      onChange={(e) => {
                        const cols = [...fp.columns];
                        cols[idx] = { ...cols[idx], title: e.target.value };
                        updateConfig("footer.props.columns", cols);
                      }}
                      className="flex-1 px-3 py-1.5 border border-gray-300 rounded text-sm font-medium"
                    />
                    <button
                      onClick={() => {
                        const cols = [...fp.columns];
                        cols.splice(idx, 1);
                        updateConfig("footer.props.columns", cols);
                      }}
                      className="ml-2 p-1 text-red-600 hover:bg-red-50 rounded"
                    >
                      <Trash2 className="w-3 h-3" />
                    </button>
                  </div>
                  <div className="space-y-1 mt-2">
                    {(col.links || []).map((link, lIdx) => (
                      <div key={lIdx} className="flex gap-1">
                        <input
                          type="text"
                          placeholder="Label"
                          value={link.label || link.text || ""}
                          onChange={(e) => {
                            const cols = [...fp.columns];
                            cols[idx].links[lIdx] = {
                              ...cols[idx].links[lIdx],
                              label: e.target.value,
                              text: e.target.value,
                            };
                            updateConfig("footer.props.columns", cols);
                          }}
                          className="flex-1 px-2 py-1 border border-gray-300 rounded text-xs"
                        />
                        <input
                          type="text"
                          placeholder="URL"
                          value={link.link || link.url || ""}
                          onChange={(e) => {
                            const cols = [...fp.columns];
                            cols[idx].links[lIdx] = {
                              ...cols[idx].links[lIdx],
                              link: e.target.value,
                              url: e.target.value,
                            };
                            updateConfig("footer.props.columns", cols);
                          }}
                          className="flex-1 px-2 py-1 border border-gray-300 rounded text-xs"
                        />
                        <button
                          onClick={() => {
                            const cols = [...fp.columns];
                            cols[idx].links.splice(lIdx, 1);
                            updateConfig("footer.props.columns", cols);
                          }}
                          className="p-1 text-red-600 hover:bg-red-50 rounded"
                        >
                          <X className="w-3 h-3" />
                        </button>
                      </div>
                    ))}
                    <button
                      onClick={() => {
                        const cols = [...fp.columns];
                        cols[idx].links = [
                          ...(cols[idx].links || []),
                          { label: "Link", link: "#" },
                        ];
                        updateConfig("footer.props.columns", cols);
                      }}
                      className="w-full px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-500 hover:border-indigo-500 hover:text-indigo-600"
                    >
                      + Add Link
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </SectionBlock>

          {/* Newsletter in footer */}
          <SectionBlock title="Newsletter">
            <div className="space-y-3">
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={!!fp.newsletter}
                  onChange={(e) => {
                    if (e.target.checked) {
                      updateConfig("footer.props.newsletter", {
                        title: "Stay Updated",
                        placeholder: "Enter your email",
                        buttonText: "Subscribe",
                      });
                    } else {
                      updateConfig("footer.props.newsletter", null);
                    }
                  }}
                  className="rounded border-gray-300 text-indigo-600"
                />
                <span className="text-sm text-gray-700">
                  Show newsletter signup
                </span>
              </label>
              {fp.newsletter && (
                <div className="space-y-2 pl-2">
                  <input
                    type="text"
                    placeholder="Section title"
                    value={fp.newsletter.title || ""}
                    onChange={(e) =>
                      updateConfig("footer.props.newsletter", {
                        ...fp.newsletter,
                        title: e.target.value,
                      })
                    }
                    className={INPUT_CLS}
                  />
                  <input
                    type="text"
                    placeholder="Input placeholder"
                    value={fp.newsletter.placeholder || ""}
                    onChange={(e) =>
                      updateConfig("footer.props.newsletter", {
                        ...fp.newsletter,
                        placeholder: e.target.value,
                      })
                    }
                    className={INPUT_CLS}
                  />
                  <input
                    type="text"
                    placeholder="Button text"
                    value={fp.newsletter.buttonText || ""}
                    onChange={(e) =>
                      updateConfig("footer.props.newsletter", {
                        ...fp.newsletter,
                        buttonText: e.target.value,
                      })
                    }
                    className={INPUT_CLS}
                  />
                </div>
              )}
            </div>
          </SectionBlock>

          {/* Social links in footer */}
          <SectionBlock
            title={`Social Links (${fp.socialLinks?.length || 0})`}
            action={
              <button
                onClick={() =>
                  updateConfig("footer.props.socialLinks", [
                    ...(fp.socialLinks || []),
                    { platform: "Twitter", link: "#" },
                  ])
                }
                className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
              >
                <Plus className="w-4 h-4" />
              </button>
            }
          >
            <div className="space-y-2">
              {(fp.socialLinks || []).map((social, idx) => (
                <div key={idx} className="flex gap-2">
                  <input
                    type="text"
                    placeholder="Platform"
                    value={social.platform}
                    onChange={(e) => {
                      const links = [...(fp.socialLinks || [])];
                      links[idx] = { ...links[idx], platform: e.target.value };
                      updateConfig("footer.props.socialLinks", links);
                    }}
                    className="w-1/3 px-2 py-1.5 border border-gray-300 rounded text-sm"
                  />
                  <input
                    type="text"
                    placeholder="URL"
                    value={social.link}
                    onChange={(e) => {
                      const links = [...(fp.socialLinks || [])];
                      links[idx] = { ...links[idx], link: e.target.value };
                      updateConfig("footer.props.socialLinks", links);
                    }}
                    className="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm"
                  />
                  <button
                    onClick={() => {
                      const links = [...(fp.socialLinks || [])];
                      links.splice(idx, 1);
                      updateConfig("footer.props.socialLinks", links);
                    }}
                    className="p-1.5 text-red-600 hover:bg-red-50 rounded"
                  >
                    <X className="w-3 h-3" />
                  </button>
                </div>
              ))}
            </div>
          </SectionBlock>

          {/* Copyright */}
          <SectionBlock title="Copyright Text">
            <textarea
              value={fp.copyright || ""}
              rows={2}
              onChange={(e) =>
                updateConfig("footer.props.copyright", e.target.value)
              }
              placeholder="© 2024 Your Company. All rights reserved."
              className={INPUT_CLS}
            />
          </SectionBlock>
        </div>
      </div>
    );
  }

  // ── Section ───────────────────────────────────────────────────
  const section = config.layout.sections.find((s) => s.id === selectedSection);
  if (!section) return null;

  const updateProp = (path, value) => {
    const keys = path.split(".");
    const newProps = { ...section.props };
    let cur = newProps;
    for (let i = 0; i < keys.length - 1; i++) {
      if (!cur[keys[i]]) cur[keys[i]] = {};
      cur = cur[keys[i]];
    }
    cur[keys[keys.length - 1]] = value;
    updateSection(section.id, { props: newProps });
  };

  const updateStyle = (path, value) => {
    const keys = path.split(".");
    const newStyle = { ...section.style };
    let cur = newStyle;
    for (let i = 0; i < keys.length - 1; i++) {
      if (!cur[keys[i]]) cur[keys[i]] = {};
      cur = cur[keys[i]];
    }
    cur[keys[keys.length - 1]] = value;
    updateSection(section.id, { style: newStyle });
  };

  const updateArrayItem = (arrayPath, index, itemPath, value) => {
    const array = [...(section.props[arrayPath] || [])];
    const keys = itemPath.split(".");
    let cur = array[index];
    for (let i = 0; i < keys.length - 1; i++) {
      if (!cur[keys[i]]) cur[keys[i]] = {};
      cur = cur[keys[i]];
    }
    cur[keys[keys.length - 1]] = value;
    updateProp(arrayPath, array);
  };

  const addArrayItem = (arrayPath, template) => {
    const array = section.props[arrayPath] || [];
    const newItem =
      typeof template === "string" ? template : { ...template, id: uuidv4() };
    updateProp(arrayPath, [...array, newItem]);
  };

  const removeArrayItem = (arrayPath, index) => {
    const array = [...(section.props[arrayPath] || [])];
    array.splice(index, 1);
    updateProp(arrayPath, array);
  };

  const renderInput = (label, value, onChange, type = "text") => (
    <div className="mb-4">
      <label className="block text-sm font-medium text-gray-700 mb-1.5">
        {label}
      </label>
      {type === "textarea" ? (
        <textarea
          value={value || ""}
          onChange={(e) => onChange(e.target.value)}
          className={INPUT_CLS}
          rows={4}
        />
      ) : type === "select" ? (
        <select
          value={value || ""}
          onChange={(e) => onChange(e.target.value)}
          className={INPUT_CLS}
        >
          {(onChange.options || []).map((opt) => (
            <option key={opt.value} value={opt.value}>
              {opt.label}
            </option>
          ))}
        </select>
      ) : type === "image" ? (
        <div>
          {value && (
            <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
              <img
                src={value}
                alt="Preview"
                className="w-full h-32 object-cover rounded"
              />
              <button
                onClick={() => onChange("")}
                className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded hover:bg-red-700"
              >
                <X className="w-3 h-3" />
              </button>
            </div>
          )}
          <FileButton
            onClick={() =>
              openFilePicker({
                sectionId: section.id,
                field: label.toLowerCase().replace(/\s/g, ""),
              })
            }
            label={value ? "Change Image" : "Upload Image"}
          />
        </div>
      ) : (
        <input
          type={type}
          value={value || ""}
          onChange={(e) => onChange(e.target.value)}
          className={INPUT_CLS}
        />
      )}
    </div>
  );

  const renderArrayEditor = (label, arrayPath, itemTemplate, renderItem) => {
    const items = section.props[arrayPath] || [];
    const isExpanded = expandedSections[arrayPath];
    return (
      <div className="mb-6 pb-6 border-b border-gray-200">
        <div className="flex items-center justify-between mb-3">
          <button
            onClick={() => toggleExpanded(arrayPath)}
            className="flex items-center gap-2 text-sm font-medium text-gray-900"
          >
            {isExpanded ? (
              <ChevronUp className="w-4 h-4" />
            ) : (
              <ChevronDown className="w-4 h-4" />
            )}
            {label} ({items.length})
          </button>
          <button
            onClick={() => addArrayItem(arrayPath, itemTemplate)}
            className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
          >
            <Plus className="w-4 h-4" />
          </button>
        </div>
        {isExpanded && (
          <div className="space-y-4 pl-4">
            {items.map((item, idx) => (
              <div
                key={item.id || idx}
                className="bg-gray-50 p-4 rounded-lg relative"
              >
                <button
                  onClick={() => removeArrayItem(arrayPath, idx)}
                  className="absolute top-2 right-2 p-1.5 text-red-600 hover:bg-red-50 rounded-lg"
                >
                  <Trash2 className="w-4 h-4" />
                </button>
                {renderItem(item, idx, (path, value) =>
                  updateArrayItem(arrayPath, idx, path, value),
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    );
  };

  // Carousel settings (reusable)
  const renderCarouselSettings = () => {
    const carousel = section.props.carousel;
    if (!carousel) return null;
    return (
      <SectionBlock
        title="Carousel Settings"
        icon={<Film className="w-4 h-4 text-indigo-500" />}
      >
        <div className="space-y-4">
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              checked={carousel.enabled || false}
              onChange={(e) => updateProp("carousel.enabled", e.target.checked)}
              className="rounded border-gray-300 text-indigo-600"
            />
            <span className="text-sm text-gray-700">Enable Carousel</span>
          </label>
          {carousel.enabled && (
            <>
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={carousel.autoplay || false}
                  onChange={(e) =>
                    updateProp("carousel.autoplay", e.target.checked)
                  }
                  className="rounded border-gray-300 text-indigo-600"
                />
                <span className="text-sm text-gray-700">Autoplay</span>
              </label>
              <LabeledField label="Interval (ms)">
                <input
                  type="number"
                  value={carousel.interval || 5000}
                  step={500}
                  min={1000}
                  onChange={(e) =>
                    updateProp("carousel.interval", parseInt(e.target.value))
                  }
                  className={INPUT_CLS}
                />
              </LabeledField>

              {/* Hero slides editor */}
              {section.type === "hero" && carousel.slides && (
                <div className="mt-2">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium text-gray-700">
                      Slides ({carousel.slides.length})
                    </span>
                    <button
                      onClick={() => {
                        const slides = [...(carousel.slides || [])];
                        slides.push({
                          id: uuidv4(),
                          image: "",
                          heading: `Slide ${slides.length + 1}`,
                          subheading: "",
                          ctaText: "Learn More",
                          ctaLink: "#",
                        });
                        updateProp("carousel.slides", slides);
                      }}
                      className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
                    >
                      <Plus className="w-4 h-4" />
                    </button>
                  </div>
                  <div className="space-y-4">
                    {carousel.slides.map((slide, idx) => (
                      <div
                        key={slide.id || idx}
                        className="bg-white border border-gray-200 p-3 rounded-lg relative"
                      >
                        <button
                          onClick={() => {
                            const slides = [...carousel.slides];
                            slides.splice(idx, 1);
                            updateProp("carousel.slides", slides);
                          }}
                          className="absolute top-2 right-2 p-1 text-red-500 hover:bg-red-50 rounded"
                        >
                          <Trash2 className="w-3.5 h-3.5" />
                        </button>
                        <p className="text-xs font-semibold text-gray-500 mb-2">
                          Slide {idx + 1}
                        </p>
                        {slide.image && (
                          <div className="relative border rounded-lg p-1 mb-2">
                            <img
                              src={slide.image}
                              alt=""
                              className="w-full h-16 object-cover rounded"
                            />
                            <button
                              onClick={() => {
                                const slides = [...carousel.slides];
                                slides[idx].image = "";
                                updateProp("carousel.slides", slides);
                              }}
                              className="absolute top-1 right-1 p-0.5 bg-red-600 text-white rounded"
                            >
                              <X className="w-2.5 h-2.5" />
                            </button>
                          </div>
                        )}
                        <button
                          onClick={() =>
                            openFilePicker({
                              sectionId: section.id,
                              arrayPath: "carousel.slides",
                              index: idx,
                              field: "image",
                            })
                          }
                          className="w-full mb-2 px-3 py-1.5 border border-dashed border-gray-300 rounded text-xs text-gray-500 hover:border-indigo-500 hover:text-indigo-600"
                        >
                          {slide.image ? "Change Image" : "Add Image"}
                        </button>
                        {["heading", "subheading", "ctaText", "ctaLink"].map(
                          (field) => (
                            <input
                              key={field}
                              type="text"
                              placeholder={field}
                              value={slide[field] || ""}
                              onChange={(e) => {
                                const slides = [...carousel.slides];
                                slides[idx] = {
                                  ...slides[idx],
                                  [field]: e.target.value,
                                };
                                updateProp("carousel.slides", slides);
                              }}
                              className={`${INPUT_CLS} mb-1.5`}
                            />
                          ),
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </>
          )}
        </div>
      </SectionBlock>
    );
  };

  // Variant selector
  const variants = SECTION_VARIANTS[section.type];
  const renderVariantSelector = () => {
    if (!variants) return null;

    const applyVariant = (value) => {
      // Build the complete new props in one shot — no separate updateProp calls
      // that would overwrite each other due to stale closure over section.props
      const newProps = { ...section.props, variant: value };

      // Sync carousel.enabled so SectionRenderer's isCarousel check works
      if (newProps.carousel) {
        newProps.carousel = {
          ...newProps.carousel,
          enabled: value === "carousel",
        };
      } else if (value === "carousel") {
        // Section doesn't have a carousel object yet — create a minimal one
        newProps.carousel = {
          enabled: true,
          autoplay: true,
          interval: 5000,
          slides: [],
        };
      }

      updateSection(section.id, { props: newProps });
    };

    const activeVariant = section.props.variant || variants[0].value;

    return (
      <SectionBlock
        title="Layout / Style"
        icon={<Layers className="w-4 h-4 text-indigo-500" />}
      >
        <div className="grid grid-cols-1 gap-1.5">
          {variants.map((v) => (
            <button
              key={v.value}
              onClick={() => applyVariant(v.value)}
              className={`px-3 py-2 rounded-lg text-sm text-left font-medium transition-all border-2 ${
                activeVariant === v.value
                  ? "border-indigo-500 bg-indigo-50 text-indigo-700"
                  : "border-gray-200 text-gray-700 hover:border-indigo-300"
              }`}
            >
              {v.label}
            </button>
          ))}
        </div>
      </SectionBlock>
    );
  };

  return (
    <div className="h-full flex flex-col bg-white border-l border-gray-200">
      <PanelHeader
        title="Section Properties"
        subtitle={`${section.type} section${section.props.carousel?.enabled ? " • Carousel" : ""}`}
        onClose={() => selectSection(null)}
      />

      <div className="flex-1 overflow-y-auto p-4">
        {/* Section ID */}
        <SectionBlock title="Section ID">
          <div className="flex items-center gap-2">
            <input
              type="text"
              value={section.id}
              readOnly
              className="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm"
            />
            <button
              onClick={() => navigator.clipboard.writeText(section.id)}
              className="px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm"
            >
              Copy
            </button>
          </div>
          <p className="text-xs text-gray-500 mt-1">
            Use #{section.id} for navigation links
          </p>
        </SectionBlock>

        {/* Layout variant */}
        {renderVariantSelector()}

        {/* Section style */}
        <SectionBlock title="Section Style">
          <div className="space-y-4">
            <LabeledField label="Background Type">
              <select
                value={section.style?.backgroundType || "color"}
                onChange={(e) => updateStyle("backgroundType", e.target.value)}
                className={INPUT_CLS}
              >
                <option value="color">Solid Color</option>
                <option value="gradient">Gradient</option>
                <option value="image">Image</option>
              </select>
            </LabeledField>
            {(!section.style?.backgroundType ||
              section.style.backgroundType === "color") && (
              <ColorField
                label="Background Color"
                value={section.style?.backgroundColor || "#ffffff"}
                onChange={(v) => updateStyle("backgroundColor", v)}
              />
            )}
            {section.style?.backgroundType === "gradient" && (
              <LabeledField label="Gradient CSS">
                <input
                  type="text"
                  value={
                    section.style?.backgroundGradient ||
                    "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
                  }
                  onChange={(e) =>
                    updateStyle("backgroundGradient", e.target.value)
                  }
                  placeholder="linear-gradient(...)"
                  className={INPUT_CLS}
                />
              </LabeledField>
            )}
            {section.style?.backgroundType === "image" && (
              <div>
                {section.style?.backgroundImage && (
                  <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                    <img
                      src={section.style.backgroundImage}
                      alt="Background"
                      className="w-full h-28 object-cover rounded"
                    />
                    <button
                      onClick={() => updateStyle("backgroundImage", "")}
                      className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </div>
                )}
                <FileButton
                  label={
                    section.style?.backgroundImage
                      ? "Change Image"
                      : "Upload Image"
                  }
                  onClick={() =>
                    openFilePicker({
                      sectionId: section.id,
                      field: "backgroundImage",
                      isStyle: true,
                    })
                  }
                />
                {section.style?.backgroundImage && (
                  <div className="mt-3">
                    <label className="block text-xs text-gray-600 mb-1">
                      Overlay Opacity
                    </label>
                    <input
                      type="range"
                      min={0}
                      max={100}
                      value={Math.round(
                        (section.style?.backgroundOverlay || 0) * 100,
                      )}
                      onChange={(e) =>
                        updateStyle("backgroundOverlay", e.target.value / 100)
                      }
                      className="w-full"
                    />
                    <span className="text-xs text-gray-500">
                      {Math.round(
                        (section.style?.backgroundOverlay || 0) * 100,
                      )}
                      %
                    </span>
                  </div>
                )}
              </div>
            )}
            <LabeledField label="Padding Top (rem)">
              <input
                type="number"
                step={0.5}
                value={parseFloat(section.style?.padding?.top) ?? 4}
                onChange={(e) =>
                  updateStyle("padding.top", `${e.target.value}rem`)
                }
                className={INPUT_CLS}
              />
            </LabeledField>
            <LabeledField label="Padding Bottom (rem)">
              <input
                type="number"
                step={0.5}
                value={parseFloat(section.style?.padding?.bottom) ?? 4}
                onChange={(e) =>
                  updateStyle("padding.bottom", `${e.target.value}rem`)
                }
                className={INPUT_CLS}
              />
            </LabeledField>
          </div>
        </SectionBlock>

        {/* Carousel block */}
        {renderCarouselSettings()}

        {/* Content */}
        <SectionBlock title="Content">
          {section.props.heading !== undefined &&
            renderInput("Heading", section.props.heading, (v) =>
              updateProp("heading", v),
            )}
          {section.props.subheading !== undefined &&
            renderInput(
              "Subheading",
              section.props.subheading,
              (v) => updateProp("subheading", v),
              "textarea",
            )}
          {section.props.content !== undefined &&
            renderInput(
              "Content (HTML)",
              section.props.content,
              (v) => updateProp("content", v),
              "textarea",
            )}
          {section.props.image !== undefined &&
            renderInput(
              "Image",
              section.props.image,
              (v) => updateProp("image", v),
              "image",
            )}
          {section.props.imagePosition !== undefined &&
            renderInput(
              "Image Position",
              section.props.imagePosition,
              Object.assign((v) => updateProp("imagePosition", v), {
                options: [
                  { value: "left", label: "Left" },
                  { value: "right", label: "Right" },
                ],
              }),
              "select",
            )}
          {section.props.ctaText !== undefined &&
            renderInput("CTA Text", section.props.ctaText, (v) =>
              updateProp("ctaText", v),
            )}
          {section.props.ctaLink !== undefined &&
            renderInput("CTA Link", section.props.ctaLink, (v) =>
              updateProp("ctaLink", v),
            )}
          {section.props.alignment !== undefined &&
            renderInput(
              "Text Alignment",
              section.props.alignment,
              Object.assign((v) => updateProp("alignment", v), {
                options: [
                  { value: "left", label: "Left" },
                  { value: "center", label: "Center" },
                  { value: "right", label: "Right" },
                ],
              }),
              "select",
            )}
          {section.props.columns !== undefined &&
            renderInput(
              "Columns",
              section.props.columns,
              (v) => updateProp("columns", parseInt(v)),
              "number",
            )}

          {section.props.primaryButton !== undefined && (
            <>
              <div className="mb-3 p-3 bg-gray-50 rounded-lg">
                <p className="text-xs font-semibold text-gray-600 mb-2">
                  Primary Button
                </p>
                <input
                  type="text"
                  placeholder="Text"
                  value={section.props.primaryButton?.text || ""}
                  onChange={(e) =>
                    updateProp("primaryButton.text", e.target.value)
                  }
                  className={`${INPUT_CLS} mb-2`}
                />
                <input
                  type="text"
                  placeholder="Link"
                  value={section.props.primaryButton?.link || "#"}
                  onChange={(e) =>
                    updateProp("primaryButton.link", e.target.value)
                  }
                  className={INPUT_CLS}
                />
              </div>
              <div className="mb-3 p-3 bg-gray-50 rounded-lg">
                <p className="text-xs font-semibold text-gray-600 mb-2">
                  Secondary Button
                </p>
                <input
                  type="text"
                  placeholder="Text"
                  value={section.props.secondaryButton?.text || ""}
                  onChange={(e) =>
                    updateProp("secondaryButton.text", e.target.value)
                  }
                  className={`${INPUT_CLS} mb-2`}
                />
                <input
                  type="text"
                  placeholder="Link"
                  value={section.props.secondaryButton?.link || "#"}
                  onChange={(e) =>
                    updateProp("secondaryButton.link", e.target.value)
                  }
                  className={INPUT_CLS}
                />
              </div>
            </>
          )}

          {section.props.submitText !== undefined &&
            renderInput("Submit Button Text", section.props.submitText, (v) =>
              updateProp("submitText", v),
            )}
          {section.props.placeholder !== undefined &&
            renderInput("Placeholder Text", section.props.placeholder, (v) =>
              updateProp("placeholder", v),
            )}
          {section.props.buttonText !== undefined &&
            renderInput("Button Text", section.props.buttonText, (v) =>
              updateProp("buttonText", v),
            )}
        </SectionBlock>

        {/* Arrays */}
        {section.props.features &&
          section.type !== "cta" &&
          renderArrayEditor(
            "Features",
            "features",
            {
              icon: "zap",
              title: "New Feature",
              description: "Feature description",
            },
            (item, idx, update) => (
              <>
                {renderInput("Icon", item.icon, (v) => update("icon", v))}
                {renderInput("Title", item.title, (v) => update("title", v))}
                {renderInput(
                  "Description",
                  item.description,
                  (v) => update("description", v),
                  "textarea",
                )}
              </>
            ),
          )}

        {section.props.features &&
          section.type === "cta" &&
          renderArrayEditor(
            "Features List",
            "features",
            "New Feature",
            (item, idx) => (
              <input
                type="text"
                value={item}
                onChange={(e) => {
                  const arr = [...section.props.features];
                  arr[idx] = e.target.value;
                  updateProp("features", arr);
                }}
                className={INPUT_CLS}
              />
            ),
          )}

        {section.props.benefits &&
          section.type !== "newsletter" &&
          renderArrayEditor(
            "Benefits",
            "benefits",
            {
              icon: "check-circle",
              title: "New Benefit",
              description: "Benefit description",
              metric: "",
            },
            (item, idx, update) => (
              <>
                {renderInput("Icon", item.icon, (v) => update("icon", v))}
                {renderInput("Title", item.title, (v) => update("title", v))}
                {renderInput(
                  "Description",
                  item.description,
                  (v) => update("description", v),
                  "textarea",
                )}
                {renderInput("Metric", item.metric || "", (v) =>
                  update("metric", v),
                )}
              </>
            ),
          )}

        {section.props.benefits &&
          section.type === "newsletter" &&
          renderArrayEditor(
            "Benefits",
            "benefits",
            "New Benefit",
            (item, idx) => (
              <input
                type="text"
                value={item}
                onChange={(e) => {
                  const arr = [...section.props.benefits];
                  arr[idx] = e.target.value;
                  updateProp("benefits", arr);
                }}
                className={INPUT_CLS}
              />
            ),
          )}

        {section.props.stats &&
          renderArrayEditor(
            "Statistics",
            "stats",
            { value: "0", label: "Stat Label", description: "" },
            (item, idx, update) => (
              <>
                {renderInput("Value", item.value, (v) => update("value", v))}
                {renderInput("Label", item.label, (v) => update("label", v))}
                {renderInput("Description", item.description || "", (v) =>
                  update("description", v),
                )}
              </>
            ),
          )}

        {section.props.steps &&
          renderArrayEditor(
            "Process Steps",
            "steps",
            {
              icon: "circle",
              title: "Step",
              description: "Description",
              duration: "",
              number: "",
            },
            (item, idx, update) => (
              <>
                {renderInput("Icon", item.icon, (v) => update("icon", v))}
                {renderInput("Number", item.number || "", (v) =>
                  update("number", v),
                )}
                {renderInput("Title", item.title, (v) => update("title", v))}
                {renderInput(
                  "Description",
                  item.description,
                  (v) => update("description", v),
                  "textarea",
                )}
                {renderInput("Duration", item.duration || "", (v) =>
                  update("duration", v),
                )}
              </>
            ),
          )}

        {section.props.logos &&
          renderArrayEditor(
            "Logos",
            "logos",
            { image: "", name: "Company", width: "120" },
            (item, idx, update) => (
              <>
                {renderInput("Company Name", item.name, (v) =>
                  update("name", v),
                )}
                <div className="mb-3">
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    Logo Image
                  </label>
                  {item.image && (
                    <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                      <img
                        src={item.image}
                        alt={item.name}
                        className="w-full h-16 object-contain"
                      />
                      <button
                        onClick={() => update("image", "")}
                        className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                      >
                        <X className="w-3 h-3" />
                      </button>
                    </div>
                  )}
                  <FileButton
                    label={item.image ? "Change Logo" : "Upload Logo"}
                    onClick={() =>
                      openFilePicker({
                        sectionId: section.id,
                        arrayPath: "logos",
                        index: idx,
                        field: "image",
                      })
                    }
                  />
                </div>
                {renderInput("Width (px)", item.width, (v) =>
                  update("width", v),
                )}
              </>
            ),
          )}

        {section.props.testimonials &&
          renderArrayEditor(
            "Testimonials",
            "testimonials",
            {
              name: "Name",
              role: "Role",
              content: "Testimonial content",
              avatar: "",
              rating: 5,
            },
            (item, idx, update) => (
              <>
                {renderInput("Name", item.name, (v) => update("name", v))}
                {renderInput("Role", item.role, (v) => update("role", v))}
                {renderInput(
                  "Content",
                  item.content,
                  (v) => update("content", v),
                  "textarea",
                )}
                <div className="mb-3">
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    Avatar
                  </label>
                  {item.avatar && (
                    <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                      <img
                        src={item.avatar}
                        alt="Avatar"
                        className="w-full h-24 object-cover rounded"
                      />
                      <button
                        onClick={() => update("avatar", "")}
                        className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                      >
                        <X className="w-3 h-3" />
                      </button>
                    </div>
                  )}
                  <FileButton
                    label={item.avatar ? "Change Avatar" : "Upload Avatar"}
                    onClick={() =>
                      openFilePicker({
                        sectionId: section.id,
                        arrayPath: "testimonials",
                        index: idx,
                        field: "avatar",
                      })
                    }
                  />
                </div>
                {renderInput(
                  "Rating (1–5)",
                  item.rating,
                  (v) => update("rating", parseInt(v)),
                  "number",
                )}
                {item.metric !== undefined &&
                  renderInput("Metric", item.metric, (v) =>
                    update("metric", v),
                  )}
              </>
            ),
          )}

        {section.props.plans &&
          renderArrayEditor(
            "Pricing Plans",
            "plans",
            {
              name: "Plan Name",
              price: "$0",
              period: "month",
              description: "",
              features: [],
              ctaText: "Get Started",
              ctaLink: "#",
              highlighted: false,
              badge: "",
              savings: "",
            },
            (item, idx, update) => (
              <>
                {renderInput("Name", item.name, (v) => update("name", v))}
                {renderInput("Price", item.price, (v) => update("price", v))}
                {renderInput("Period", item.period || "", (v) =>
                  update("period", v),
                )}
                {renderInput("Description", item.description || "", (v) =>
                  update("description", v),
                )}
                {renderInput("CTA Text", item.ctaText, (v) =>
                  update("ctaText", v),
                )}
                {renderInput("CTA Link", item.ctaLink, (v) =>
                  update("ctaLink", v),
                )}
                <div className="mb-3">
                  <label className="block text-xs font-medium text-gray-700 mb-1">
                    Features (one per line)
                  </label>
                  <textarea
                    value={(item.features || []).join("\n")}
                    rows={4}
                    onChange={(e) =>
                      update(
                        "features",
                        e.target.value.split("\n").filter((f) => f.trim()),
                      )
                    }
                    className={INPUT_CLS}
                  />
                </div>
                <label className="flex items-center gap-2 mb-3 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={item.highlighted || false}
                    onChange={(e) => update("highlighted", e.target.checked)}
                    className="rounded border-gray-300 text-indigo-600"
                  />
                  <span className="text-sm text-gray-700">
                    Highlighted Plan
                  </span>
                </label>
                {item.highlighted &&
                  renderInput("Badge Text", item.badge || "", (v) =>
                    update("badge", v),
                  )}
                {renderInput("Savings Tag", item.savings || "", (v) =>
                  update("savings", v),
                )}
              </>
            ),
          )}

        {section.props.fields &&
          renderArrayEditor(
            "Form Fields",
            "fields",
            { type: "text", label: "Field Label", required: false },
            (item, idx, update) => (
              <>
                {renderInput("Label", item.label, (v) => update("label", v))}
                {renderInput(
                  "Type",
                  item.type,
                  Object.assign((v) => update("type", v), {
                    options: [
                      { value: "text", label: "Text" },
                      { value: "email", label: "Email" },
                      { value: "tel", label: "Phone" },
                      { value: "textarea", label: "Textarea" },
                    ],
                  }),
                  "select",
                )}
                <label className="flex items-center gap-2 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={item.required || false}
                    onChange={(e) => update("required", e.target.checked)}
                    className="rounded border-gray-300 text-indigo-600"
                  />
                  <span className="text-sm text-gray-700">Required</span>
                </label>
              </>
            ),
          )}

        {section.props.faqs &&
          renderArrayEditor(
            "FAQ Items",
            "faqs",
            { question: "Question?", answer: "Answer" },
            (item, idx, update) => (
              <>
                {renderInput("Question", item.question, (v) =>
                  update("question", v),
                )}
                {renderInput(
                  "Answer",
                  item.answer,
                  (v) => update("answer", v),
                  "textarea",
                )}
              </>
            ),
          )}

        {section.props.questions &&
          renderArrayEditor(
            "Questions",
            "questions",
            { question: "Question?", answer: "Answer" },
            (item, idx, update) => (
              <>
                {renderInput("Question", item.question, (v) =>
                  update("question", v),
                )}
                {renderInput(
                  "Answer",
                  item.answer,
                  (v) => update("answer", v),
                  "textarea",
                )}
              </>
            ),
          )}

        {section.props.members &&
          renderArrayEditor(
            "Team Members",
            "members",
            {
              name: "Name",
              role: "Role",
              bio: "Short bio",
              image: "",
              socials: {},
            },
            (item, idx, update) => (
              <>
                {renderInput("Name", item.name, (v) => update("name", v))}
                {renderInput("Role", item.role, (v) => update("role", v))}
                {renderInput(
                  "Bio",
                  item.bio,
                  (v) => update("bio", v),
                  "textarea",
                )}
                <div className="mb-3">
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    Photo
                  </label>
                  {item.image && (
                    <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                      <img
                        src={item.image}
                        alt="Preview"
                        className="w-full h-28 object-cover rounded"
                      />
                      <button
                        onClick={() => update("image", "")}
                        className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                      >
                        <X className="w-3 h-3" />
                      </button>
                    </div>
                  )}
                  <FileButton
                    label={item.image ? "Change Photo" : "Upload Photo"}
                    onClick={() =>
                      openFilePicker({
                        sectionId: section.id,
                        arrayPath: "members",
                        index: idx,
                        field: "image",
                      })
                    }
                  />
                </div>
              </>
            ),
          )}

        {/* Case studies */}
        {section.props.studies &&
          renderArrayEditor(
            "Case Studies",
            "studies",
            {
              title: "Case Study",
              client: "Client",
              description: "Overview",
              image: "",
              link: "#",
              results: [],
              metrics: [],
            },
            (item, idx, update) => (
              <>
                {renderInput("Title", item.title, (v) => update("title", v))}
                {renderInput("Client", item.client || "", (v) =>
                  update("client", v),
                )}
                {renderInput(
                  "Description",
                  item.description || "",
                  (v) => update("description", v),
                  "textarea",
                )}
                {renderInput("Link", item.link || "#", (v) =>
                  update("link", v),
                )}
                <div className="mb-3">
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    Cover Image
                  </label>
                  {item.image && (
                    <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                      <img
                        src={item.image}
                        alt="Cover"
                        className="w-full h-28 object-cover rounded"
                      />
                      <button
                        onClick={() => update("image", "")}
                        className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                      >
                        <X className="w-3 h-3" />
                      </button>
                    </div>
                  )}
                  <FileButton
                    label={item.image ? "Change Image" : "Upload Image"}
                    onClick={() =>
                      openFilePicker({
                        sectionId: section.id,
                        arrayPath: "studies",
                        index: idx,
                        field: "image",
                      })
                    }
                  />
                </div>
                <div className="mb-3">
                  <label className="block text-xs font-medium text-gray-700 mb-1">
                    Results (one per line)
                  </label>
                  <textarea
                    value={(item.results || []).join("\n")}
                    rows={3}
                    onChange={(e) =>
                      update(
                        "results",
                        e.target.value.split("\n").filter((r) => r.trim()),
                      )
                    }
                    className={INPUT_CLS}
                  />
                </div>
              </>
            ),
          )}

        {/* Trust badges */}
        {section.props.badges &&
          renderArrayEditor(
            "Trust Badges",
            "badges",
            {
              icon: "shield",
              title: "Certification",
              description: "Description",
            },
            (item, idx, update) => (
              <>
                {renderInput("Icon", item.icon, (v) => update("icon", v))}
                {renderInput("Title", item.title, (v) => update("title", v))}
                {renderInput("Description", item.description || "", (v) =>
                  update("description", v),
                )}
              </>
            ),
          )}

        {/* Trust awards */}
        {section.props.awards !== undefined && (
          <div className="mb-6 pb-6 border-b border-gray-200">
            <div className="flex items-center justify-between mb-3">
              <span className="text-sm font-medium text-gray-900">
                Awards / Accolades ({(section.props.awards || []).length})
              </span>
              <button
                onClick={() =>
                  updateProp("awards", [
                    ...(section.props.awards || []),
                    "New Award",
                  ])
                }
                className="p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg"
              >
                <Plus className="w-4 h-4" />
              </button>
            </div>
            <div className="space-y-2">
              {(section.props.awards || []).map((award, idx) => (
                <div key={idx} className="flex gap-2">
                  <input
                    type="text"
                    value={award}
                    onChange={(e) => {
                      const arr = [...section.props.awards];
                      arr[idx] = e.target.value;
                      updateProp("awards", arr);
                    }}
                    className={`${INPUT_CLS} flex-1`}
                  />
                  <button
                    onClick={() => {
                      const arr = [...section.props.awards];
                      arr.splice(idx, 1);
                      updateProp("awards", arr);
                    }}
                    className="p-2 text-red-500 hover:bg-red-50 rounded"
                  >
                    <X className="w-3.5 h-3.5" />
                  </button>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Gallery items */}
        {section.props.items &&
          section.type === "gallery" &&
          renderArrayEditor(
            "Gallery Items",
            "items",
            { image: "", title: "New Item", category: "", description: "" },
            (item, idx, update) => (
              <>
                {renderInput("Title", item.title, (v) => update("title", v))}
                {renderInput("Category", item.category || "", (v) =>
                  update("category", v),
                )}
                <div className="mb-3">
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    Image
                  </label>
                  {item.image && (
                    <div className="relative border-2 border-gray-200 rounded-lg p-2 mb-2">
                      <img
                        src={item.image}
                        alt={item.title}
                        className="w-full h-28 object-cover rounded"
                      />
                      <button
                        onClick={() => update("image", "")}
                        className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded"
                      >
                        <X className="w-3 h-3" />
                      </button>
                    </div>
                  )}
                  <FileButton
                    label={item.image ? "Change Image" : "Upload Image"}
                    onClick={() =>
                      openFilePicker({
                        sectionId: section.id,
                        arrayPath: "items",
                        index: idx,
                        field: "image",
                      })
                    }
                  />
                </div>
                {renderInput(
                  "Description",
                  item.description || "",
                  (v) => update("description", v),
                  "textarea",
                )}
              </>
            ),
          )}
      </div>

      <FilePicker
        show={showFilePicker}
        websiteId={selectedWebsite?.id}
        onClose={() => {
          setShowFilePicker(false);
          setCurrentImageField(null);
        }}
        onSelect={handleFileSelect}
      />
    </div>
  );
}

// ── Small reusable sub-components ────────────────────────────────

const INPUT_CLS =
  "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500";

function PanelHeader({ title, subtitle, onClose }) {
  return (
    <div className="p-4 border-b border-gray-200">
      <div className="flex items-center justify-between mb-1">
        <h3 className="text-sm font-semibold text-gray-900">{title}</h3>
        <button
          onClick={onClose}
          className="p-1.5 hover:bg-gray-100 rounded-lg transition-colors"
        >
          <X className="w-4 h-4 text-gray-500" />
        </button>
      </div>
      {subtitle && (
        <p className="text-xs text-gray-500 capitalize">{subtitle}</p>
      )}
    </div>
  );
}

function SectionBlock({ title, children, action, icon }) {
  return (
    <div className="mb-6 pb-6 border-b border-gray-200">
      <div className="flex items-center justify-between mb-3">
        <h4 className="flex items-center gap-1.5 text-xs font-semibold text-gray-500 uppercase tracking-wide">
          {icon}
          {title}
        </h4>
        {action}
      </div>
      {children}
    </div>
  );
}

function LabeledField({ label, children }) {
  return (
    <div>
      <label className="block text-sm font-medium text-gray-700 mb-1.5">
        {label}
      </label>
      {children}
    </div>
  );
}

function ColorField({ label, value, onChange }) {
  return (
    <LabeledField label={label}>
      <div className="flex gap-2">
        <input
          type="color"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          className="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
        />
        <input
          type="text"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"
        />
      </div>
    </LabeledField>
  );
}

function FileButton({ label, onClick }) {
  return (
    <button
      onClick={onClick}
      className="w-full px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all flex items-center justify-center gap-2 text-sm text-gray-600"
    >
      <ImageIcon className="w-4 h-4" />
      {label}
    </button>
  );
}

function FilePicker({ show, websiteId, onClose, onSelect }) {
  if (!show || !websiteId) return null;
  return (
    <FilePickerModal
      isOpen={show}
      onClose={onClose}
      onSelectFile={onSelect}
      websiteId={websiteId}
      allowedTypes={["image"]}
    />
  );
}

SectionRenderer.jsx:
import { SECTION_TYPES } from "../../../utils/sectionLibrary";
import * as LucideIcons from "lucide-react";
import { useState, useEffect } from "react";

export default function SectionRenderer({
  section,
  themeColors,
  selectedTemplate,
}) {
  const [currentSlide, setCurrentSlide] = useState(0);
  const carousel = section.props.carousel;
  const variant = section.props.variant || "default";

  // Reset slide index whenever variant changes so we never land on a stale index
  useEffect(() => {
    setCurrentSlide(0);
  }, [variant]);

  // Derived helpers
  const primaryColor = themeColors?.primary || "#6366f1";
  const isCarousel = variant === "carousel" || carousel?.enabled === true;
  const isSplit = variant === "split";
  const isList = variant === "list";

  // For section types that use their main items array as carousel slides
  const getCarouselItems = () => {
    if (section.props.testimonials) return section.props.testimonials;
    if (section.props.items) return section.props.items;
    if (section.props.logos) return section.props.logos;
    return [];
  };

  useEffect(() => {
    let interval;
    if (isCarousel && carousel?.autoplay) {
      const slides =
        carousel.slides?.length > 0 ? carousel.slides : getCarouselItems();
      if (slides.length > 1) {
        interval = setInterval(() => {
          setCurrentSlide((p) => (p + 1) % slides.length);
        }, carousel.interval || 5000);
      }
    }
    return () => clearInterval(interval);
  }, [isCarousel, carousel?.autoplay, carousel?.interval]);

  const getIcon = (iconName) => {
    if (!iconName) return null;
    const pascal = iconName
      .split("-")
      .map((w, i) => (i === 0 ? w : w.charAt(0).toUpperCase() + w.slice(1)))
      .join("");
    return LucideIcons[pascal] || LucideIcons.Box;
  };

  const getSectionStyle = () => {
    // Debug to see what's coming from the store
    console.log("Raw section.style.padding:", section.style?.padding);

    const style = {
      position: "relative",
    };

    // Explicitly check for padding values
    if (section.style?.padding) {
      // Only set padding if the value exists and is not undefined/null
      if (
        section.style.padding.top !== undefined &&
        section.style.padding.top !== null
      ) {
        style.paddingTop = section.style.padding.top;
      } else {
        style.paddingTop = "4rem";
      }

      if (
        section.style.padding.bottom !== undefined &&
        section.style.padding.bottom !== null
      ) {
        style.paddingBottom = section.style.padding.bottom;
      } else {
        style.paddingBottom = "4rem";
      }

      if (
        section.style.padding.left !== undefined &&
        section.style.padding.left !== null
      ) {
        style.paddingLeft = section.style.padding.left;
      }

      if (
        section.style.padding.right !== undefined &&
        section.style.padding.right !== null
      ) {
        style.paddingRight = section.style.padding.right;
      }
    } else {
      // No padding object at all, use defaults
      style.paddingTop = "4rem";
      style.paddingBottom = "4rem";
    }

    // Handle background based on type
    if (section.style?.backgroundType === "color") {
      style.backgroundColor = section.style?.backgroundColor || "transparent";
    } else if (section.style?.backgroundType === "gradient") {
      style.background =
        section.style?.backgroundGradient ||
        "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
    } else if (
      section.style?.backgroundType === "image" &&
      section.style?.backgroundImage
    ) {
      style.backgroundImage = `url(${section.style.backgroundImage})`;
      style.backgroundSize = "cover";
      style.backgroundPosition = "center";
      style.backgroundRepeat = "no-repeat";
    }

    console.log("Final style:", style);
    return style;
  };
  const getOverlayStyle = () => {
    if (
      section.style?.backgroundType === "image" &&
      section.style?.backgroundImage &&
      section.style?.backgroundOverlay > 0
    ) {
      return {
        position: "absolute",
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        backgroundColor: `rgba(0,0,0,${section.style.backgroundOverlay})`,
        zIndex: 1,
      };
    }
    return null;
  };

  const textOnBg = (fallback = "#111827") =>
    section.style?.backgroundType === "image" ? "#ffffff" : fallback;

  // ── Carousel UI helpers ─────────────────────────────────────
  const CarouselDots = ({ slides, current, onDotClick }) => {
    if (!slides || slides.length <= 1) return null;
    return (
      <div className="absolute bottom-6 left-0 right-0 flex justify-center gap-2 z-20">
        {slides.map((_, i) => (
          <button
            key={i}
            onClick={() => onDotClick(i)}
            className={`rounded-full transition-all ${i === current ? "w-8 h-2.5 bg-white" : "w-2.5 h-2.5 bg-white/50 hover:bg-white/80"}`}
          />
        ))}
      </div>
    );
  };

  const CarouselArrows = ({ slides, onPrev, onNext }) => {
    if (!slides || slides.length <= 1) return null;
    return (
      <>
        <button
          onClick={onPrev}
          className="absolute left-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-all"
        >
          <LucideIcons.ChevronLeft className="w-5 h-5" />
        </button>
        <button
          onClick={onNext}
          className="absolute right-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-all"
        >
          <LucideIcons.ChevronRight className="w-5 h-5" />
        </button>
      </>
    );
  };

  const prev = (len) => setCurrentSlide((p) => (p - 1 + len) % len);
  const next = (len) => setCurrentSlide((p) => (p + 1) % len);

  // ══════════════════════════════════════════════════════════════
  // HERO
  // ══════════════════════════════════════════════════════════════
  const renderHero = () => {
    const {
      heading,
      subheading,
      ctaText,
      ctaLink,
      secondaryCtaText,
      secondaryCtaLink,
      image,
      alignment = "center",
    } = section.props;
    const overlayStyle = getOverlayStyle();
    const hasImage = image && image.trim() !== "";

    // Carousel variant
    if (isCarousel && carousel?.slides?.length > 0) {
      const slides = carousel.slides;
      const slide = slides[currentSlide] || {};
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="relative min-h-[600px] flex items-center overflow-hidden">
            {slide.image && (
              <div className="absolute inset-0">
                <img
                  src={slide.image}
                  alt=""
                  className="w-full h-full object-cover"
                />
                <div className="absolute inset-0 bg-black/50" />
              </div>
            )}
            <CarouselDots
              slides={slides}
              current={currentSlide}
              onDotClick={setCurrentSlide}
            />
            <CarouselArrows
              slides={slides}
              onPrev={() => prev(slides.length)}
              onNext={() => next(slides.length)}
            />
            <div className="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white w-full">
              <h1 className="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight">
                {slide.heading || heading || "Slide Heading"}
              </h1>
              <p className="text-xl md:text-2xl mb-10 max-w-3xl mx-auto text-white/90">
                {slide.subheading || subheading || ""}
              </p>
              {slide.ctaText && (
                <a
                  href={slide.ctaLink || "#"}
                  className="inline-block px-10 py-4 bg-white text-gray-900 rounded-xl font-semibold text-lg hover:bg-gray-100 transition-all shadow-lg"
                >
                  {slide.ctaText}
                </a>
              )}
            </div>
          </div>
        </div>
      );
    }

    // Split variant (text + image side by side)
    if (isSplit || (hasImage && variant !== "centered")) {
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
              <div>
                <h1
                  className="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 leading-tight"
                  style={{ color: textOnBg() }}
                >
                  {heading || "Hero Heading"}
                </h1>
                <p
                  className="text-lg md:text-xl mb-8 leading-relaxed"
                  style={{ color: textOnBg("#6b7280") }}
                >
                  {subheading || "Hero subheading goes here"}
                </p>
                <div className="flex flex-wrap gap-4">
                  {ctaText && (
                    <a
                      href={ctaLink || "#"}
                      className="inline-block px-8 py-4 rounded-xl font-semibold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1"
                      style={{
                        backgroundColor: primaryColor,
                        color: "#ffffff",
                      }}
                    >
                      {ctaText}
                    </a>
                  )}
                  {secondaryCtaText && (
                    <a
                      href={secondaryCtaLink || "#"}
                      className="inline-block px-8 py-4 border-2 border-gray-900 text-gray-900 rounded-xl font-semibold hover:bg-gray-900 hover:text-white transition-all"
                    >
                      {secondaryCtaText}
                    </a>
                  )}
                </div>
              </div>
              <div className="relative">
                {hasImage ? (
                  <>
                    <div className="absolute -inset-4 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-3xl opacity-20 blur-2xl" />
                    <img
                      src={image}
                      alt={heading}
                      className="relative w-full h-auto rounded-2xl shadow-2xl"
                    />
                  </>
                ) : (
                  <div className="w-full aspect-video rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                    <LucideIcons.Image className="w-16 h-16 text-gray-300" />
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Centered (default)
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div
          className={`max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-${alignment} relative z-10`}
        >
          <h1
            className="text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold mb-8 leading-tight"
            style={{ color: textOnBg() }}
          >
            {heading || "Hero Heading"}
          </h1>
          <p
            className="text-xl md:text-2xl mb-10 max-w-3xl mx-auto leading-relaxed"
            style={{ color: textOnBg("#6b7280") }}
          >
            {subheading || "Hero subheading goes here"}
          </p>
          <div
            className={`flex flex-wrap gap-4 justify-${alignment === "center" ? "center" : "start"}`}
          >
            {ctaText && (
              <a
                href={ctaLink || "#"}
                className="inline-block px-10 py-4 rounded-xl font-semibold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1"
                style={{ backgroundColor: primaryColor, color: "#ffffff" }}
              >
                {ctaText}
              </a>
            )}
            {secondaryCtaText && (
              <a
                href={secondaryCtaLink || "#"}
                className="inline-block px-10 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:border-gray-900 hover:text-gray-900 transition-all"
              >
                {secondaryCtaText}
              </a>
            )}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // FEATURES
  // ══════════════════════════════════════════════════════════════
  const renderFeatures = () => {
    const { heading, subheading, features = [], columns = 3 } = section.props;
    const overlayStyle = getOverlayStyle();

    const gridCls = `grid grid-cols-1 ${columns >= 2 ? "md:grid-cols-2" : ""} ${columns >= 3 ? "lg:grid-cols-3" : ""} ${columns >= 4 ? "xl:grid-cols-4" : ""} gap-8`;

    // List variant
    if (isList) {
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <SectionHeading
              heading={heading || "Features"}
              subheading={subheading}
              textColor={textOnBg()}
            />
            <div className="space-y-6">
              {features.map((feature) => {
                const Icon = getIcon(feature.icon);
                return (
                  <div
                    key={feature.id}
                    className="flex items-start gap-5 p-6 bg-white rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-all"
                  >
                    {Icon && (
                      <div
                        className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                        style={{ backgroundColor: primaryColor }}
                      >
                        <Icon className="w-6 h-6 text-white" />
                      </div>
                    )}
                    <div>
                      <h3 className="text-lg font-semibold text-gray-900 mb-1">
                        {feature.title}
                      </h3>
                      <p className="text-gray-600 leading-relaxed">
                        {feature.description}
                      </p>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    // Grid (default)
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Features"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div className={gridCls}>
            {features.map((feature) => {
              const Icon = getIcon(feature.icon);
              return (
                <div
                  key={feature.id}
                  className="group text-center p-8 rounded-2xl transition-all hover:shadow-xl border border-gray-100 bg-white"
                >
                  {Icon && (
                    <div
                      className="w-14 h-14 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-md"
                      style={{ backgroundColor: primaryColor }}
                    >
                      <Icon className="w-7 h-7 text-white" />
                    </div>
                  )}
                  <h3 className="text-xl font-semibold text-gray-900 mb-3">
                    {feature.title}
                  </h3>
                  <p className="text-gray-600 leading-relaxed">
                    {feature.description}
                  </p>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // STATS
  // ══════════════════════════════════════════════════════════════
  const renderStats = () => {
    const { heading, subheading, stats = [] } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          {(heading || subheading) && (
            <SectionHeading
              heading={heading}
              subheading={subheading}
              textColor={textOnBg()}
            />
          )}
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-8">
            {stats.map((stat) => (
              <div key={stat.id} className="text-center group">
                <div
                  className="text-4xl md:text-5xl lg:text-6xl font-black mb-2 group-hover:scale-110 transition-transform"
                  style={{ color: primaryColor }}
                >
                  {stat.value}
                </div>
                <div
                  className="text-lg font-semibold text-gray-900 mb-1"
                  style={{ color: textOnBg() }}
                >
                  {stat.label}
                </div>
                {stat.description && (
                  <div
                    className="text-sm text-gray-500"
                    style={{ color: textOnBg("#6b7280") }}
                  >
                    {stat.description}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // PROCESS
  // ══════════════════════════════════════════════════════════════
  const renderProcess = () => {
    const { heading, subheading, steps = [] } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Our Process"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div
            className={`grid grid-cols-1 ${steps.length <= 3 ? "md:grid-cols-3" : "md:grid-cols-2 lg:grid-cols-4"} gap-8`}
          >
            {steps.map((step, idx) => {
              const Icon = getIcon(step.icon);
              return (
                <div key={step.id} className="relative group">
                  <div
                    className="text-5xl font-black mb-3"
                    style={{ color: primaryColor, opacity: 0.15 }}
                  >
                    {step.number || String(idx + 1).padStart(2, "0")}
                  </div>
                  <div
                    className="w-14 h-14 rounded-2xl flex items-center justify-center mb-5"
                    style={{ backgroundColor: primaryColor }}
                  >
                    {Icon && <Icon className="w-7 h-7 text-white" />}
                  </div>
                  <h3
                    className="text-xl font-bold mb-2"
                    style={{ color: textOnBg() }}
                  >
                    {step.title}
                  </h3>
                  <p
                    className="leading-relaxed"
                    style={{ color: textOnBg("#6b7280") }}
                  >
                    {step.description}
                  </p>
                  {step.duration && (
                    <p
                      className="text-sm font-medium mt-3"
                      style={{ color: primaryColor }}
                    >
                      ⏱ {step.duration}
                    </p>
                  )}
                </div>
              );
            })}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // CONTENT
  // ══════════════════════════════════════════════════════════════
  const renderContent = () => {
    const { heading, content, image, imagePosition = "right" } = section.props;
    const overlayStyle = getOverlayStyle();
    const hasImage = image && image.trim() !== "";

    if (isSplit || hasImage) {
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
              <div className={imagePosition === "left" ? "lg:order-2" : ""}>
                <h2
                  className="text-3xl md:text-4xl lg:text-5xl font-bold mb-8"
                  style={{ color: textOnBg() }}
                >
                  {heading || "Content Heading"}
                </h2>
                <div
                  className="prose prose-lg prose-gray max-w-none"
                  style={{ color: textOnBg("#374151") }}
                  dangerouslySetInnerHTML={{
                    __html: content || "<p>Content goes here...</p>",
                  }}
                />
              </div>
              <div className={imagePosition === "left" ? "lg:order-1" : ""}>
                {hasImage ? (
                  <div className="relative">
                    <div className="absolute -inset-4 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-3xl opacity-20 blur-2xl" />
                    <img
                      src={image}
                      alt={heading}
                      className="relative w-full h-auto rounded-2xl shadow-2xl"
                    />
                  </div>
                ) : (
                  <div className="w-full aspect-video rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                    <LucideIcons.Image className="w-16 h-16 text-gray-300" />
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Text only
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <h2
            className="text-3xl md:text-4xl lg:text-5xl font-bold mb-10"
            style={{ color: textOnBg() }}
          >
            {heading || "Content Heading"}
          </h2>
          <div
            className="prose prose-lg prose-gray max-w-none"
            style={{ color: textOnBg("#374151") }}
            dangerouslySetInnerHTML={{
              __html: content || "<p>Content goes here...</p>",
            }}
          />
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // GALLERY
  // ══════════════════════════════════════════════════════════════
  const renderGallery = () => {
    const { heading, subheading, items = [], columns = 3 } = section.props;
    const overlayStyle = getOverlayStyle();

    const gridCls = `grid grid-cols-1 ${columns >= 2 ? "sm:grid-cols-2" : ""} ${columns >= 3 ? "lg:grid-cols-3" : ""} ${columns >= 4 ? "xl:grid-cols-4" : ""} gap-8`;

    const GalleryItem = ({ item, idx }) => (
      <div
        key={item.id || idx}
        className="group relative aspect-square bg-gray-200 rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all transform hover:-translate-y-2"
      >
        {item.image ? (
          <img
            src={item.image}
            alt={item.title || `Gallery ${idx + 1}`}
            className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
          />
        ) : (
          <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300" />
        )}
        {item.title && (
          <div className="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-6">
            <div className="text-white">
              <h3 className="text-xl font-bold mb-1">{item.title}</h3>
              {item.category && (
                <p className="text-sm text-gray-300">{item.category}</p>
              )}
            </div>
          </div>
        )}
      </div>
    );

    // Carousel variant
    if (isCarousel && items.length > 0) {
      const slide = items[currentSlide] || {};
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <SectionHeading
              heading={heading || "Gallery"}
              subheading={subheading}
              textColor={textOnBg()}
            />
            <div className="relative overflow-hidden rounded-2xl">
              <div className="aspect-video relative">
                {slide.image ? (
                  <img
                    src={slide.image}
                    alt={slide.title}
                    className="w-full h-full object-cover"
                  />
                ) : (
                  <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300" />
                )}
                {slide.title && (
                  <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-8">
                    <h3 className="text-2xl font-bold text-white">
                      {slide.title}
                    </h3>
                    {slide.category && (
                      <p className="text-gray-300 mt-1">{slide.category}</p>
                    )}
                  </div>
                )}
              </div>
              <CarouselDots
                slides={items}
                current={currentSlide}
                onDotClick={setCurrentSlide}
              />
              <CarouselArrows
                slides={items}
                onPrev={() => prev(items.length)}
                onNext={() => next(items.length)}
              />
            </div>
            {/* Thumbnails */}
            {items.length > 1 && (
              <div className="flex gap-3 mt-4 overflow-x-auto pb-2">
                {items.map((item, idx) => (
                  <button
                    key={idx}
                    onClick={() => setCurrentSlide(idx)}
                    className={`flex-shrink-0 w-20 h-16 rounded-lg overflow-hidden border-2 transition-all ${idx === currentSlide ? "border-indigo-500 opacity-100" : "border-transparent opacity-60 hover:opacity-100"}`}
                  >
                    {item.image ? (
                      <img
                        src={item.image}
                        alt=""
                        className="w-full h-full object-cover"
                      />
                    ) : (
                      <div className="w-full h-full bg-gray-200" />
                    )}
                  </button>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    }

    // Grid (default)
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Gallery"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div className={gridCls}>
            {items.length > 0
              ? items.map((item, idx) => (
                  <GalleryItem key={item.id || idx} item={item} idx={idx} />
                ))
              : Array(6)
                  .fill(0)
                  .map((_, idx) => (
                    <div
                      key={idx}
                      className="aspect-square bg-gradient-to-br from-gray-200 to-gray-300 rounded-2xl"
                    />
                  ))}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // TESTIMONIALS
  // ══════════════════════════════════════════════════════════════
  const renderTestimonials = () => {
    const { heading, subheading, testimonials = [] } = section.props;
    const overlayStyle = getOverlayStyle();

    // Carousel variant
    if (isCarousel && testimonials.length > 0) {
      const slide = testimonials[currentSlide] || {};
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <SectionHeading
              heading={heading || "Testimonials"}
              subheading={subheading}
              textColor={textOnBg()}
            />
            <div className="relative bg-white rounded-3xl p-10 md:p-14 shadow-2xl">
              <CarouselDots
                slides={testimonials}
                current={currentSlide}
                onDotClick={setCurrentSlide}
              />
              <div className="text-center">
                <div className="flex justify-center mb-5">
                  {[...Array(slide.rating || 5)].map((_, i) => (
                    <LucideIcons.Star
                      key={i}
                      className="w-6 h-6 fill-current text-yellow-400"
                    />
                  ))}
                </div>
                <p className="text-xl md:text-2xl text-gray-700 mb-8 italic leading-relaxed">
                  "{slide.content}"
                </p>
                <div className="flex items-center justify-center gap-4">
                  <div className="w-16 h-16 bg-gradient-to-br from-indigo-400 to-purple-400 rounded-full overflow-hidden">
                    {slide.avatar && (
                      <img
                        src={slide.avatar}
                        alt={slide.name}
                        className="w-full h-full object-cover"
                      />
                    )}
                  </div>
                  <div className="text-left">
                    <p className="font-bold text-gray-900 text-lg">
                      {slide.name}
                    </p>
                    <p className="text-gray-500">{slide.role}</p>
                    {slide.metric && (
                      <p
                        className="font-bold mt-1"
                        style={{ color: primaryColor }}
                      >
                        {slide.metric}
                      </p>
                    )}
                  </div>
                </div>
              </div>
            </div>
            {/* Nav arrows below card */}
            {testimonials.length > 1 && (
              <div className="flex justify-center gap-3 mt-6">
                <button
                  onClick={() => prev(testimonials.length)}
                  className="w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center hover:border-indigo-500 transition-colors"
                >
                  <LucideIcons.ChevronLeft className="w-5 h-5 text-gray-600" />
                </button>
                <button
                  onClick={() => next(testimonials.length)}
                  className="w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center hover:border-indigo-500 transition-colors"
                >
                  <LucideIcons.ChevronRight className="w-5 h-5 text-gray-600" />
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Grid (default)
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Testimonials"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            {testimonials.map((test) => (
              <div
                key={test.id}
                className="p-8 bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all"
              >
                <div className="flex mb-4">
                  {[...Array(test.rating || 5)].map((_, i) => (
                    <LucideIcons.Star
                      key={i}
                      className="w-5 h-5 fill-current"
                      style={{ color: primaryColor }}
                    />
                  ))}
                </div>
                <p className="text-gray-700 mb-6 text-lg leading-relaxed italic">
                  "{test.content}"
                </p>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-12 h-12 bg-gray-200 rounded-full overflow-hidden">
                      {test.avatar && (
                        <img
                          src={test.avatar}
                          alt={test.name}
                          className="w-full h-full object-cover"
                        />
                      )}
                    </div>
                    <div>
                      <p className="font-semibold text-gray-900">{test.name}</p>
                      <p className="text-sm text-gray-500">{test.role}</p>
                    </div>
                  </div>
                  {test.metric && (
                    <span
                      className="text-xl font-bold"
                      style={{ color: primaryColor }}
                    >
                      {test.metric}
                    </span>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // LOGOS
  // ══════════════════════════════════════════════════════════════
  const renderLogos = () => {
    const { heading, subheading, logos = [], columns = 4 } = section.props;
    const overlayStyle = getOverlayStyle();

    // Scrolling carousel variant
    if (isCarousel && logos.length > 0) {
      const doubled = [...logos, ...logos]; // duplicate for infinite scroll effect
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="relative z-10">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <SectionHeading
                heading={heading || "Trusted by Industry Leaders"}
                subheading={subheading}
                textColor={textOnBg()}
              />
            </div>
            <div className="relative overflow-hidden">
              {/* Fade edges */}
              <div
                className="absolute left-0 top-0 bottom-0 w-24 z-10 pointer-events-none"
                style={{
                  background: `linear-gradient(to right, ${section.style?.backgroundColor || "#fff"}, transparent)`,
                }}
              />
              <div
                className="absolute right-0 top-0 bottom-0 w-24 z-10 pointer-events-none"
                style={{
                  background: `linear-gradient(to left, ${section.style?.backgroundColor || "#fff"}, transparent)`,
                }}
              />
              <div
                className="flex gap-12 animate-scroll"
                style={{ animationDuration: `${logos.length * 3}s` }}
              >
                {doubled.map((logo, idx) => (
                  <div
                    key={idx}
                    className="flex-shrink-0 flex items-center justify-center h-20 px-6"
                  >
                    {logo.image ? (
                      <img
                        src={logo.image}
                        alt={logo.name}
                        className="max-h-12 w-auto object-contain grayscale hover:grayscale-0 transition-all"
                      />
                    ) : (
                      <div className="px-6 py-3 bg-gray-100 rounded-lg text-gray-500 text-sm font-medium whitespace-nowrap">
                        {logo.name}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Grid (default)
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Trusted by Industry Leaders"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div
            className={`grid grid-cols-2 md:grid-cols-${Math.min(columns, 6)} gap-10 items-center`}
          >
            {logos.map((logo) => (
              <div key={logo.id} className="flex justify-center">
                {logo.image ? (
                  <img
                    src={logo.image}
                    alt={logo.name}
                    className="max-h-14 w-auto object-contain grayscale hover:grayscale-0 transition-all"
                  />
                ) : (
                  <div className="px-6 py-3 bg-gray-100 rounded-lg text-gray-500 text-sm font-medium">
                    {logo.name}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // BENEFITS
  // ══════════════════════════════════════════════════════════════
  const renderBenefits = () => {
    const { heading, subheading, benefits = [] } = section.props;
    const overlayStyle = getOverlayStyle();

    // List variant
    if (isList) {
      return (
        <div style={getSectionStyle()}>
          {overlayStyle && <div style={overlayStyle} />}
          <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <SectionHeading
              heading={heading || "Benefits"}
              subheading={subheading}
              textColor={textOnBg()}
            />
            <div className="space-y-4">
              {benefits.map((b) => {
                const Icon = getIcon(b.icon);
                return (
                  <div
                    key={b.id}
                    className="flex items-start gap-4 p-5 bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-all"
                  >
                    {Icon && (
                      <div
                        className="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0"
                        style={{ backgroundColor: primaryColor }}
                      >
                        <Icon className="w-5 h-5 text-white" />
                      </div>
                    )}
                    <div className="flex-1">
                      <h3 className="font-semibold text-gray-900 mb-1">
                        {b.title}
                      </h3>
                      <p className="text-gray-600 text-sm leading-relaxed">
                        {b.description}
                      </p>
                    </div>
                    {b.metric && (
                      <span
                        className="text-xl font-black flex-shrink-0"
                        style={{ color: primaryColor }}
                      >
                        {b.metric}
                      </span>
                    )}
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    // Grid (default)
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Benefits"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            {benefits.map((b) => {
              const Icon = getIcon(b.icon);
              return (
                <div
                  key={b.id}
                  className="flex gap-5 p-7 bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all"
                >
                  <div className="flex-shrink-0">
                    <div
                      className="w-14 h-14 rounded-xl flex items-center justify-center"
                      style={{ backgroundColor: primaryColor }}
                    >
                      {Icon && <Icon className="w-7 h-7 text-white" />}
                    </div>
                  </div>
                  <div className="flex-1">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-xl font-bold text-gray-900">
                        {b.title}
                      </h3>
                      {b.metric && (
                        <span
                          className="text-2xl font-black"
                          style={{ color: primaryColor }}
                        >
                          {b.metric}
                        </span>
                      )}
                    </div>
                    <p className="text-gray-600 leading-relaxed">
                      {b.description}
                    </p>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // CTA
  // ══════════════════════════════════════════════════════════════
  const renderCTA = () => {
    const { heading, subheading, primaryButton, secondaryButton, features } =
      section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
          <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold mb-8 text-white leading-tight">
            {heading || "Ready to get started?"}
          </h2>
          {subheading && (
            <p className="text-lg md:text-xl mb-12 text-white/90 max-w-2xl mx-auto">
              {subheading}
            </p>
          )}
          <div className="flex flex-col sm:flex-row gap-4 justify-center mb-8">
            {primaryButton?.text && (
              <a
                href={primaryButton.link || "#"}
                className="px-10 py-4 bg-white rounded-xl font-semibold text-lg transition-all shadow-xl hover:shadow-2xl transform hover:-translate-y-1"
                style={{ color: primaryColor }}
              >
                {primaryButton.text}
              </a>
            )}
            {secondaryButton?.text && (
              <a
                href={secondaryButton.link || "#"}
                className="px-10 py-4 border-2 border-white text-white rounded-xl font-semibold hover:bg-white/10 transition-all"
              >
                {secondaryButton.text}
              </a>
            )}
          </div>
          {features?.length > 0 && (
            <div className="flex flex-wrap gap-6 justify-center text-white/80 text-sm">
              {features.map((f, idx) => (
                <div key={idx} className="flex items-center gap-2">
                  <LucideIcons.Check className="w-4 h-4" />
                  <span>{f}</span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // PRICING
  // ══════════════════════════════════════════════════════════════
  const renderPricing = () => {
    const { heading, subheading, plans = [] } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Pricing"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {plans.map((plan) => (
              <div
                key={plan.id}
                className={`relative rounded-3xl p-9 transition-all hover:shadow-2xl ${plan.highlighted ? "ring-4 shadow-2xl lg:scale-105 z-10 bg-white" : "border-2 border-gray-200 bg-white hover:border-gray-300"}`}
                style={plan.highlighted ? { ringColor: primaryColor } : {}}
              >
                {plan.badge && plan.highlighted && (
                  <div
                    className="absolute -top-5 left-1/2 -translate-x-1/2 px-5 py-1.5 rounded-full text-white text-sm font-bold shadow-lg"
                    style={{ backgroundColor: primaryColor }}
                  >
                    {plan.badge}
                  </div>
                )}
                {plan.savings && (
                  <div className="absolute -top-3 -right-3 px-3 py-1 bg-green-500 text-white rounded-full text-xs font-bold shadow">
                    {plan.savings}
                  </div>
                )}
                <h3 className="text-2xl font-bold text-gray-900 mb-1">
                  {plan.name}
                </h3>
                {plan.description && (
                  <p className="text-sm text-gray-500 mb-6">
                    {plan.description}
                  </p>
                )}
                <div className="mb-8">
                  <span className="text-5xl font-bold text-gray-900">
                    {plan.price}
                  </span>
                  {plan.period && (
                    <span className="text-gray-500 ml-1">/{plan.period}</span>
                  )}
                </div>
                <ul className="space-y-4 mb-10">
                  {plan.features.map((f, i) => (
                    <li
                      key={i}
                      className="flex items-start gap-3 text-gray-700"
                    >
                      <LucideIcons.Check className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
                      <span>{f}</span>
                    </li>
                  ))}
                </ul>
                <a
                  href={plan.ctaLink || "#"}
                  className={`block w-full py-4 rounded-xl font-bold text-lg text-center transition-all ${plan.highlighted ? "text-white shadow-lg hover:shadow-xl transform hover:-translate-y-1" : "bg-gray-100 text-gray-900 hover:bg-gray-200"}`}
                  style={
                    plan.highlighted ? { backgroundColor: primaryColor } : {}
                  }
                >
                  {plan.ctaText}
                </a>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // CONTACT
  // ══════════════════════════════════════════════════════════════
  const renderContact = () => {
    const { heading, subheading, fields = [], submitText } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Contact Us"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <form className="space-y-6 bg-white p-10 rounded-3xl shadow-2xl">
            {fields.map((field) => (
              <div key={field.id}>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  {field.label}
                  {field.required && (
                    <span className="text-red-500 ml-1">*</span>
                  )}
                </label>
                {field.type === "textarea" ? (
                  <textarea
                    rows={5}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none transition-colors resize-none"
                  />
                ) : (
                  <input
                    type={field.type}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none transition-colors"
                  />
                )}
              </div>
            ))}
            <button
              className="w-full py-4 text-white rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1"
              style={{ backgroundColor: primaryColor }}
            >
              {submitText || "Submit"}
            </button>
          </form>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // TEAM
  // ══════════════════════════════════════════════════════════════
  const renderTeam = () => {
    const { heading, subheading, members = [], columns = 3 } = section.props;
    const overlayStyle = getOverlayStyle();
    const gridCls = `grid grid-cols-1 ${columns >= 2 ? "sm:grid-cols-2" : ""} ${columns >= 3 ? "lg:grid-cols-3" : ""} ${columns >= 4 ? "xl:grid-cols-4" : ""} gap-10`;
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Our Team"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div className={gridCls}>
            {members.map((m) => (
              <div key={m.id} className="text-center group">
                <div className="relative mb-6 inline-block">
                  <div className="w-40 h-40 bg-gradient-to-br from-gray-200 to-gray-300 rounded-full mx-auto overflow-hidden shadow-xl group-hover:shadow-2xl transition-shadow">
                    {m.image && (
                      <img
                        src={m.image}
                        alt={m.name}
                        className="w-full h-full object-cover"
                      />
                    )}
                  </div>
                </div>
                <h3
                  className="text-xl font-semibold mb-1"
                  style={{ color: textOnBg() }}
                >
                  {m.name}
                </h3>
                <p className="font-medium mb-3" style={{ color: primaryColor }}>
                  {m.role}
                </p>
                <p
                  className="text-sm leading-relaxed"
                  style={{ color: textOnBg("#6b7280") }}
                >
                  {m.bio}
                </p>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // FAQ
  // ══════════════════════════════════════════════════════════════
  const renderFAQ = () => {
    const { heading, subheading, faqs = [], questions = [] } = section.props;
    const items = faqs.length > 0 ? faqs : questions;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "FAQ"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div className="space-y-4">
            {items.map((q) => (
              <div
                key={q.id}
                className="bg-white border-2 border-gray-200 rounded-2xl p-7 hover:shadow-lg hover:border-transparent transition-all"
              >
                <h3 className="text-lg font-bold text-gray-900 mb-3 flex items-start gap-3">
                  <span
                    className="flex-shrink-0 w-7 h-7 rounded-full flex items-center justify-center text-white text-xs font-bold"
                    style={{ backgroundColor: primaryColor }}
                  >
                    Q
                  </span>
                  <span className="flex-1">{q.question}</span>
                </h3>
                <p className="text-gray-600 leading-relaxed pl-10">
                  {q.answer}
                </p>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // NEWSLETTER
  // ══════════════════════════════════════════════════════════════
  const renderNewsletter = () => {
    const {
      heading,
      subheading,
      placeholder,
      buttonText,
      benefits = [],
    } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center">
          <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-6">
            {heading || "Stay Updated"}
          </h2>
          {subheading && (
            <p className="text-lg text-white/90 mb-10">{subheading}</p>
          )}
          <div className="flex flex-col sm:flex-row gap-3 max-w-xl mx-auto mb-8">
            <input
              type="email"
              placeholder={placeholder || "Enter your email"}
              className="flex-1 px-5 py-4 rounded-xl border-2 border-transparent focus:border-white focus:outline-none text-base bg-white/10 text-white placeholder-white/60"
            />
            <button
              className="px-8 py-4 bg-white text-gray-900 rounded-xl font-bold hover:bg-gray-100 transition-all shadow-lg whitespace-nowrap"
              style={{ color: primaryColor }}
            >
              {buttonText || "Subscribe"}
            </button>
          </div>
          {benefits.length > 0 && (
            <div className="flex flex-wrap gap-5 justify-center text-white/80 text-sm">
              {benefits.map((b, i) => (
                <div key={i} className="flex items-center gap-2">
                  <LucideIcons.Check className="w-4 h-4" />
                  <span>{b}</span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // CASE STUDIES
  // ══════════════════════════════════════════════════════════════
  const renderCaseStudies = () => {
    const { heading, subheading, studies = [] } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Success Stories"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
            {studies.map((study) => (
              <div
                key={study.id}
                className="group bg-white rounded-3xl overflow-hidden shadow-xl hover:shadow-2xl transition-all transform hover:-translate-y-2"
              >
                <div className="relative h-56 overflow-hidden">
                  {study.image ? (
                    <img
                      src={study.image}
                      alt={study.title}
                      className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                    />
                  ) : (
                    <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300" />
                  )}
                  <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-6">
                    <a
                      href={study.link || "#"}
                      className="text-white font-semibold flex items-center gap-2"
                    >
                      View Case Study{" "}
                      <LucideIcons.ArrowRight className="w-4 h-4" />
                    </a>
                  </div>
                </div>
                <div className="p-7">
                  <div className="flex items-start justify-between mb-3">
                    <h3 className="text-xl font-bold text-gray-900">
                      {study.title}
                    </h3>
                    {study.client && (
                      <span className="px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-500 flex-shrink-0 ml-3">
                        {study.client}
                      </span>
                    )}
                  </div>
                  <p className="text-gray-600 mb-5 leading-relaxed">
                    {study.description}
                  </p>
                  {study.results?.length > 0 && (
                    <div className="flex flex-wrap gap-2 mb-4">
                      {study.results.map((r, i) => (
                        <span
                          key={i}
                          className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium"
                        >
                          {r}
                        </span>
                      ))}
                    </div>
                  )}
                  {study.metrics?.length > 0 && (
                    <div className="grid grid-cols-3 gap-4 pt-5 border-t border-gray-100">
                      {study.metrics.map((m, i) => (
                        <div key={i} className="text-center">
                          <div
                            className="text-2xl font-bold"
                            style={{ color: primaryColor }}
                          >
                            {m.value}
                          </div>
                          <div className="text-xs text-gray-500 mt-0.5">
                            {m.label}
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // TRUST
  // ══════════════════════════════════════════════════════════════
  const renderTrust = () => {
    const {
      heading,
      subheading,
      badges = [],
      testimonials = [],
      awards = [],
    } = section.props;
    const overlayStyle = getOverlayStyle();
    return (
      <div style={getSectionStyle()}>
        {overlayStyle && <div style={overlayStyle} />}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <SectionHeading
            heading={heading || "Trusted & Secure"}
            subheading={subheading}
            textColor={textOnBg()}
          />
          {badges.length > 0 && (
            <div className="grid grid-cols-2 md:grid-cols-4 gap-8 mb-14">
              {badges.map((b) => {
                const Icon = getIcon(b.icon);
                return (
                  <div key={b.id} className="text-center">
                    <div className="w-18 h-18 bg-indigo-50 rounded-2xl flex items-center justify-center mx-auto mb-4 w-16 h-16">
                      {Icon && (
                        <Icon
                          className="w-8 h-8"
                          style={{ color: primaryColor }}
                        />
                      )}
                    </div>
                    <h3 className="font-bold text-gray-900 mb-1">{b.title}</h3>
                    <p className="text-sm text-gray-500">{b.description}</p>
                  </div>
                );
              })}
            </div>
          )}
          {testimonials.length > 0 && (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-7 mb-12">
              {testimonials.map((t, i) => (
                <div
                  key={i}
                  className="bg-white p-7 rounded-2xl shadow-md border border-gray-100"
                >
                  <div className="flex gap-1 mb-4">
                    {[...Array(t.rating || 5)].map((_, j) => (
                      <LucideIcons.Star
                        key={j}
                        className="w-4 h-4 fill-current text-yellow-400"
                      />
                    ))}
                  </div>
                  <p className="text-gray-700 italic mb-5">
                    "{t.quote || t.content}"
                  </p>
                  <p className="font-bold text-gray-900">
                    {t.author || t.name}
                  </p>
                </div>
              ))}
            </div>
          )}
          {awards.length > 0 && (
            <div className="text-center">
              <p className="text-xs font-semibold text-gray-400 uppercase tracking-widest mb-5">
                Recognized by
              </p>
              <div className="flex flex-wrap justify-center gap-3">
                {awards.map((award, i) => (
                  <span
                    key={i}
                    className="px-5 py-2.5 bg-white border-2 border-gray-200 rounded-full text-gray-700 font-medium text-sm"
                  >
                    🏆 {award}
                  </span>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    );
  };

  // ══════════════════════════════════════════════════════════════
  // SWITCH
  // ══════════════════════════════════════════════════════════════
  switch (section.type) {
    case SECTION_TYPES.HERO:
      return renderHero();
    case SECTION_TYPES.FEATURES:
      return renderFeatures();
    case SECTION_TYPES.CTA:
      return renderCTA();
    case SECTION_TYPES.CONTENT:
      return renderContent();
    case SECTION_TYPES.GALLERY:
      return renderGallery();
    case SECTION_TYPES.TESTIMONIALS:
      return renderTestimonials();
    case SECTION_TYPES.PRICING:
      return renderPricing();
    case SECTION_TYPES.CONTACT:
      return renderContact();
    case SECTION_TYPES.TEAM:
      return renderTeam();
    case SECTION_TYPES.FAQ:
      return renderFAQ();
    case SECTION_TYPES.STATS:
      return renderStats();
    case SECTION_TYPES.NEWSLETTER:
      return renderNewsletter();
    case SECTION_TYPES.PROCESS:
      return renderProcess();
    case SECTION_TYPES.BENEFITS:
      return renderBenefits();
    case SECTION_TYPES.LOGOS:
      return renderLogos();
    case SECTION_TYPES.CASE_STUDIES:
      return renderCaseStudies();
    case SECTION_TYPES.TRUST:
      return renderTrust();
    default:
      return (
        <div className="py-16 text-center text-gray-400 bg-gray-50">
          Unknown section type: {section.type}
        </div>
      );
  }
}

// ── Shared heading block ─────────────────────────────────────────
function SectionHeading({ heading, subheading, textColor }) {
  if (!heading && !subheading) return null;
  return (
    <div className="text-center mb-16">
      {heading && (
        <h2
          className="text-3xl md:text-4xl lg:text-5xl font-bold mb-5 leading-tight"
          style={{ color: textColor || "#111827" }}
        >
          {heading}
        </h2>
      )}
      {subheading && (
        <p
          className="text-lg text-gray-600 max-w-3xl mx-auto leading-relaxed"
          style={{
            color: textColor !== "#111827" ? `${textColor}cc` : undefined,
          }}
        >
          {subheading}
        </p>
      )}
    </div>
  );
}

SortableSection.jsx:
import { useSortable } from "@dnd-kit/sortable";
import { CSS } from "@dnd-kit/utilities";
import { GripVertical, Trash2, Copy, Eye, MoreVertical } from "lucide-react";
import { useEditorStore } from "../../../store/store";
import SectionRenderer from "./SectionRenderer";
import { useState, useRef, useEffect } from "react";

export default function SortableSection({ section, onSelect, themeColors }) {
  const { deleteSection, selectedSection, updateSection } = useEditorStore();
  const [showMenu, setShowMenu] = useState(false);
  const menuRef = useRef(null);

  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: section.id });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
    opacity: isDragging ? 0.5 : 1,
  };

  const isSelected = selectedSection === section.id;

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (menuRef.current && !menuRef.current.contains(event.target)) {
        setShowMenu(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const handleDuplicate = (e) => {
    e.stopPropagation();
    const newSection = {
      ...section,
      id: `section-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
    };
    const { config, reorderSections } = useEditorStore.getState();
    const sectionIndex = config.layout.sections.findIndex(
      (s) => s.id === section.id,
    );
    const newSections = [...config.layout.sections];
    newSections.splice(sectionIndex + 1, 0, newSection);
    reorderSections(newSections);
    setShowMenu(false);
  };

  const handleDelete = (e) => {
    e.stopPropagation();
    if (confirm("Are you sure you want to delete this section?")) {
      deleteSection(section.id);
    }
    setShowMenu(false);
  };

  const toggleVisibility = (e) => {
    e.stopPropagation();
    updateSection(section.id, {
      props: {
        ...section.props,
        hidden: !section.props.hidden,
      },
    });
    setShowMenu(false);
  };

  const toggleMenu = (e) => {
    e.stopPropagation();
    setShowMenu(!showMenu);
  };

  return (
    <div
      ref={setNodeRef}
      style={style}
      className={`relative group ${section.props.hidden ? "opacity-50" : ""} ${
        isSelected ? "ring-2 ring-indigo-500" : ""
      }`}
      onClick={onSelect}
    >
      <div className="absolute -left-10 top-2 opacity-0 group-hover:opacity-100 transition-opacity z-20 flex items-center gap-1">
        <button
          {...attributes}
          {...listeners}
          className="p-1.5 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 cursor-grab active:cursor-grabbing"
          title="Drag to reorder"
        >
          <GripVertical className="w-4 h-4 text-gray-600" />
        </button>

        <div className="relative" ref={menuRef}>
          <button
            onClick={toggleMenu}
            className="p-1.5 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 transition-colors"
            title="More options"
          >
            <MoreVertical className="w-4 h-4 text-gray-600" />
          </button>

          {showMenu && (
            <div className="absolute left-full top-0 ml-1 bg-white border border-gray-300 rounded-lg shadow-lg py-1 min-w-[140px] z-30">
              <button
                onClick={toggleVisibility}
                className="w-full px-3 py-2 text-left hover:bg-gray-50 flex items-center gap-2"
              >
                <Eye
                  className={`w-4 h-4 ${section.props.hidden ? "text-gray-400" : "text-gray-600"}`}
                />
                <span>{section.props.hidden ? "Show" : "Hide"}</span>
              </button>
              <button
                onClick={handleDuplicate}
                className="w-full px-3 py-2 text-left hover:bg-gray-50 flex items-center gap-2"
              >
                <Copy className="w-4 h-4 text-gray-600" />
                <span>Duplicate</span>
              </button>
              <button
                onClick={handleDelete}
                className="w-full px-3 py-2 text-left hover:bg-red-50 text-red-600 flex items-center gap-2"
              >
                <Trash2 className="w-4 h-4" />
                <span>Delete</span>
              </button>
            </div>
          )}
        </div>
      </div>

      <div className={isSelected ? "ring-2 ring-indigo-500 ring-inset" : ""}>
        <SectionRenderer section={section} themeColors={themeColors} />
      </div>
    </div>
  );
}

sectionLibrary.jsx(utils):
import { v4 as uuidv4 } from "uuid";

export const SECTION_TYPES = {
  HERO: "hero",
  FEATURES: "features",
  CTA: "cta",
  CONTENT: "content",
  GALLERY: "gallery",
  TESTIMONIALS: "testimonials",
  PRICING: "pricing",
  CONTACT: "contact",
  TEAM: "team",
  FAQ: "faq",
  STATS: "stats",
  NEWSLETTER: "newsletter",
  PROCESS: "process",
  BENEFITS: "benefits",
  LOGOS: "logos",
  CASE_STUDIES: "case-studies",
  TRUST: "trust",
};

// Variant options for section types — used by PropertiesPanel to render a "Layout" selector
export const SECTION_VARIANTS = {
  [SECTION_TYPES.HERO]: [
    { value: "centered", label: "Centered" },
    { value: "split", label: "Split (with image)" },
    { value: "carousel", label: "Carousel / Slideshow" },
  ],
  [SECTION_TYPES.FEATURES]: [
    { value: "grid", label: "Grid" },
    { value: "list", label: "List" },
  ],
  [SECTION_TYPES.GALLERY]: [
    { value: "grid", label: "Grid" },
    { value: "carousel", label: "Carousel" },
  ],
  [SECTION_TYPES.TESTIMONIALS]: [
    { value: "grid", label: "Grid" },
    { value: "carousel", label: "Carousel" },
  ],
  [SECTION_TYPES.LOGOS]: [
    { value: "grid", label: "Grid" },
    { value: "carousel", label: "Scrolling Carousel" },
  ],
  [SECTION_TYPES.PROCESS]: [
    { value: "timeline", label: "Timeline" },
    { value: "grid", label: "Grid" },
  ],
  [SECTION_TYPES.BENEFITS]: [
    { value: "grid", label: "Grid (with metrics)" },
    { value: "list", label: "List" },
  ],
  [SECTION_TYPES.CTA]: [
    { value: "simple", label: "Simple" },
    { value: "features", label: "With Features List" },
  ],
  [SECTION_TYPES.CONTENT]: [
    { value: "text", label: "Text Only" },
    { value: "image", label: "Text + Image" },
  ],
  [SECTION_TYPES.STATS]: [
    { value: "row", label: "Row" },
    { value: "headline", label: "With Headline" },
  ],
};

export const SECTION_LIBRARY = [
  {
    id: "hero",
    type: SECTION_TYPES.HERO,
    name: "Hero",
    icon: "layout",
    defaultProps: {
      variant: "centered",
      heading: "Transform Your Digital Presence",
      subheading:
        "Build amazing websites in minutes with our intuitive platform",
      ctaText: "Get Started Free",
      ctaLink: "#",
      secondaryCtaText: "Watch Demo",
      secondaryCtaLink: "#demo",
      alignment: "center",
      image: "",
      carousel: {
        enabled: false,
        autoplay: true,
        interval: 5000,
        slides: [
          {
            id: uuidv4(),
            image: "",
            heading: "Transform Your Digital Presence",
            subheading: "Build amazing websites in minutes",
            ctaText: "Get Started",
            ctaLink: "#",
          },
          {
            id: uuidv4(),
            image: "",
            heading: "Powerful Features",
            subheading: "Everything you need to succeed online",
            ctaText: "Learn More",
            ctaLink: "#",
          },
        ],
      },
    },
  },
  {
    id: "features",
    type: SECTION_TYPES.FEATURES,
    name: "Features",
    icon: "zap",
    defaultProps: {
      variant: "grid",
      heading: "Everything You Need",
      subheading: "Powerful features to help you succeed",
      features: [
        {
          id: uuidv4(),
          icon: "zap",
          title: "Lightning Fast",
          description: "Optimized for speed with instant load times",
        },
        {
          id: uuidv4(),
          icon: "shield",
          title: "Secure & Safe",
          description: "Enterprise-grade security built-in",
        },
        {
          id: uuidv4(),
          icon: "smartphone",
          title: "Mobile Ready",
          description: "Perfect on every device and screen size",
        },
        {
          id: uuidv4(),
          icon: "globe",
          title: "Global CDN",
          description: "Fast delivery worldwide",
        },
        {
          id: uuidv4(),
          icon: "code",
          title: "Developer Friendly",
          description: "Custom code when you need it",
        },
        {
          id: uuidv4(),
          icon: "trending-up",
          title: "SEO Optimized",
          description: "Rank higher in search results",
        },
      ],
      columns: 3,
    },
  },
  {
    id: "stats",
    type: SECTION_TYPES.STATS,
    name: "Stats & Numbers",
    icon: "bar-chart",
    defaultProps: {
      variant: "row",
      heading: "Our Impact",
      subheading: "Numbers speak louder than words",
      stats: [
        {
          id: uuidv4(),
          value: "100K+",
          label: "Active Users",
          description: "Worldwide",
        },
        {
          id: uuidv4(),
          value: "99.9%",
          label: "Uptime",
          description: "Guaranteed",
        },
        {
          id: uuidv4(),
          value: "4.9/5",
          label: "Rating",
          description: "Customer satisfaction",
        },
        {
          id: uuidv4(),
          value: "24/7",
          label: "Support",
          description: "Always available",
        },
      ],
    },
  },
  {
    id: "process",
    type: SECTION_TYPES.PROCESS,
    name: "Process",
    icon: "clock",
    defaultProps: {
      variant: "timeline",
      heading: "How It Works",
      subheading: "Simple steps to get started",
      steps: [
        {
          id: uuidv4(),
          icon: "edit",
          title: "Plan",
          description: "Define your goals and requirements",
          duration: "1–2 days",
          number: "01",
        },
        {
          id: uuidv4(),
          icon: "code",
          title: "Build",
          description: "Create your website with our tools",
          duration: "3–5 days",
          number: "02",
        },
        {
          id: uuidv4(),
          icon: "rocket",
          title: "Launch",
          description: "Deploy and go live instantly",
          duration: "Same day",
          number: "03",
        },
      ],
    },
  },
  {
    id: "content",
    type: SECTION_TYPES.CONTENT,
    name: "Content / About",
    icon: "file-text",
    defaultProps: {
      variant: "text",
      heading: "Our Story",
      content:
        "<p>We believe in building tools that empower everyone to create amazing websites. Our platform combines simplicity with powerful features.</p><p>Join thousands of creators who have already transformed their online presence.</p>",
      image: "",
      imagePosition: "right",
    },
  },
  {
    id: "gallery",
    type: SECTION_TYPES.GALLERY,
    name: "Gallery / Portfolio",
    icon: "image",
    defaultProps: {
      variant: "grid",
      heading: "Our Work",
      subheading: "Explore our latest projects",
      items: [
        {
          id: uuidv4(),
          image: "",
          title: "Project Alpha",
          category: "Design",
          description: "A modern web design project",
        },
        {
          id: uuidv4(),
          image: "",
          title: "Project Beta",
          category: "Development",
          description: "Custom web application",
        },
        {
          id: uuidv4(),
          image: "",
          title: "Project Gamma",
          category: "Branding",
          description: "Complete brand identity",
        },
        {
          id: uuidv4(),
          image: "",
          title: "Project Delta",
          category: "Marketing",
          description: "Digital marketing campaign",
        },
        {
          id: uuidv4(),
          image: "",
          title: "Project Epsilon",
          category: "E-commerce",
          description: "Online store platform",
        },
        {
          id: uuidv4(),
          image: "",
          title: "Project Zeta",
          category: "Mobile",
          description: "Cross-platform app",
        },
      ],
      columns: 3,
      carousel: { enabled: false, autoplay: true, interval: 5000 },
    },
  },
  {
    id: "testimonials",
    type: SECTION_TYPES.TESTIMONIALS,
    name: "Testimonials",
    icon: "message-square",
    defaultProps: {
      variant: "grid",
      heading: "What Our Customers Say",
      subheading: "Real feedback from real people",
      testimonials: [
        {
          id: uuidv4(),
          name: "Sarah Mitchell",
          role: "Creative Director",
          content: "This platform transformed how we build websites.",
          avatar: "",
          rating: 5,
        },
        {
          id: uuidv4(),
          name: "James Chen",
          role: "Startup Founder",
          content: "Finally, a website builder that doesn't limit creativity.",
          avatar: "",
          rating: 5,
        },
        {
          id: uuidv4(),
          name: "Emily Rodriguez",
          role: "Marketing Manager",
          content: "The ROI has been incredible. We launched in days.",
          avatar: "",
          rating: 5,
          metric: "300% increase",
        },
      ],
      carousel: { enabled: false, autoplay: true, interval: 5000 },
    },
  },
  {
    id: "logos",
    type: SECTION_TYPES.LOGOS,
    name: "Logos / Partners",
    icon: "shield",
    defaultProps: {
      variant: "grid",
      heading: "Trusted by Industry Leaders",
      subheading: "Join thousands of companies using our platform",
      logos: [
        { id: uuidv4(), image: "", name: "Company 1", width: "120" },
        { id: uuidv4(), image: "", name: "Company 2", width: "120" },
        { id: uuidv4(), image: "", name: "Company 3", width: "120" },
        { id: uuidv4(), image: "", name: "Company 4", width: "120" },
        { id: uuidv4(), image: "", name: "Company 5", width: "120" },
        { id: uuidv4(), image: "", name: "Company 6", width: "120" },
      ],
      columns: 4,
      carousel: { enabled: false, autoplay: true, interval: 3000 },
    },
  },
  {
    id: "benefits",
    type: SECTION_TYPES.BENEFITS,
    name: "Benefits",
    icon: "award",
    defaultProps: {
      variant: "grid",
      heading: "Why Choose Us",
      subheading: "The advantages of working with us",
      benefits: [
        {
          id: uuidv4(),
          icon: "zap",
          title: "Lightning Fast",
          description: "10x faster performance",
          metric: "99.9%",
        },
        {
          id: uuidv4(),
          icon: "shield",
          title: "Bank Level Security",
          description: "Enterprise encryption",
          metric: "256-bit",
        },
        {
          id: uuidv4(),
          icon: "headphones",
          title: "24/7 Support",
          description: "Always here to help",
          metric: "< 5min",
        },
        {
          id: uuidv4(),
          icon: "trending-up",
          title: "Proven Results",
          description: "Average 3x ROI",
          metric: "+300%",
        },
      ],
    },
  },
  {
    id: "cta",
    type: SECTION_TYPES.CTA,
    name: "Call to Action",
    icon: "target",
    defaultProps: {
      variant: "simple",
      heading: "Ready to Get Started?",
      subheading: "Join thousands of satisfied customers today",
      primaryButton: { text: "Start Free Trial", link: "#" },
      secondaryButton: { text: "Contact Sales", link: "#" },
      features: [
        "No credit card required",
        "14-day free trial",
        "Cancel anytime",
      ],
    },
  },
  {
    id: "pricing",
    type: SECTION_TYPES.PRICING,
    name: "Pricing",
    icon: "dollar-sign",
    defaultProps: {
      heading: "Choose Your Plan",
      subheading: "Flexible pricing that grows with you",
      plans: [
        {
          id: uuidv4(),
          name: "Starter",
          price: "$12",
          period: "month",
          description: "Perfect for individuals",
          features: ["5 Projects", "10GB Storage", "Basic Support"],
          ctaText: "Get Started",
          ctaLink: "#",
          highlighted: false,
        },
        {
          id: uuidv4(),
          name: "Pro",
          price: "$39",
          period: "month",
          description: "For professionals",
          features: [
            "Unlimited Projects",
            "100GB Storage",
            "Priority Support",
            "Advanced Features",
          ],
          ctaText: "Start Trial",
          ctaLink: "#",
          highlighted: true,
          badge: "Most Popular",
        },
        {
          id: uuidv4(),
          name: "Enterprise",
          price: "Custom",
          period: "",
          description: "For large teams",
          features: [
            "Everything in Pro",
            "Unlimited Storage",
            "Dedicated Support",
            "Custom Features",
          ],
          ctaText: "Contact Us",
          ctaLink: "#",
          highlighted: false,
        },
      ],
    },
  },
  {
    id: "contact",
    type: SECTION_TYPES.CONTACT,
    name: "Contact Form",
    icon: "mail",
    defaultProps: {
      heading: "Get In Touch",
      subheading: "We'd love to hear from you",
      fields: [
        { id: uuidv4(), type: "text", label: "Name", required: true },
        { id: uuidv4(), type: "email", label: "Email", required: true },
        { id: uuidv4(), type: "textarea", label: "Message", required: true },
      ],
      submitText: "Send Message",
    },
  },
  {
    id: "team",
    type: SECTION_TYPES.TEAM,
    name: "Team",
    icon: "users",
    defaultProps: {
      heading: "Meet Our Team",
      subheading: "The people behind the product",
      members: [
        {
          id: uuidv4(),
          name: "Olivia Chen",
          role: "Creative Director",
          bio: "Leading design with passion and precision",
          image: "",
          socials: {},
        },
        {
          id: uuidv4(),
          name: "Marcus Thompson",
          role: "Head of Product",
          bio: "Building tools that empower creators",
          image: "",
          socials: {},
        },
        {
          id: uuidv4(),
          name: "Yuki Tanaka",
          role: "Lead Engineer",
          bio: "Crafting elegant technical solutions",
          image: "",
          socials: {},
        },
      ],
      columns: 3,
    },
  },
  {
    id: "faq",
    type: SECTION_TYPES.FAQ,
    name: "FAQ",
    icon: "help-circle",
    defaultProps: {
      heading: "Frequently Asked Questions",
      subheading: "Everything you need to know",
      faqs: [
        {
          id: uuidv4(),
          question: "Do I need coding knowledge?",
          answer: "Not at all! Our platform is designed for everyone.",
        },
        {
          id: uuidv4(),
          question: "Can I use my own domain?",
          answer:
            "Yes! You can connect any domain you own or purchase a new one.",
        },
        {
          id: uuidv4(),
          question: "What kind of websites can I build?",
          answer: "Anything you can imagine! From portfolios to online stores.",
        },
      ],
    },
  },
  {
    id: "newsletter",
    type: SECTION_TYPES.NEWSLETTER,
    name: "Newsletter",
    icon: "mail",
    defaultProps: {
      heading: "Stay Updated",
      subheading: "Get the latest news and updates delivered to your inbox",
      placeholder: "Enter your email",
      buttonText: "Subscribe",
      benefits: ["Weekly insights", "Exclusive content", "Early access"],
    },
  },
  {
    id: "case-studies",
    type: SECTION_TYPES.CASE_STUDIES,
    name: "Case Studies",
    icon: "book-open",
    defaultProps: {
      heading: "Success Stories",
      subheading: "See how our clients have grown",
      studies: [
        {
          id: uuidv4(),
          title: "Platform Redesign",
          client: "Acme Inc.",
          description:
            "Complete redesign resulting in 3x conversion improvement.",
          image: "",
          link: "#",
          results: ["3x Conversion", "50% Bounce Reduction"],
          metrics: [
            { value: "+300%", label: "Conversion" },
            { value: "-50%", label: "Bounce Rate" },
            { value: "2mo", label: "Timeline" },
          ],
        },
        {
          id: uuidv4(),
          title: "E-Commerce Launch",
          client: "ShopCo",
          description:
            "Launched a new online store from zero to $1M ARR in six months.",
          image: "",
          link: "#",
          results: ["$1M ARR", "100K Users"],
          metrics: [
            { value: "$1M", label: "ARR" },
            { value: "100K", label: "Users" },
            { value: "6mo", label: "To Launch" },
          ],
        },
      ],
    },
  },
  {
    id: "trust",
    type: SECTION_TYPES.TRUST,
    name: "Trust & Security",
    icon: "shield-check",
    defaultProps: {
      heading: "Trusted & Secure",
      subheading: "Your data is safe with us",
      badges: [
        {
          id: uuidv4(),
          icon: "shield",
          title: "SOC 2 Certified",
          description: "Enterprise security standards",
        },
        {
          id: uuidv4(),
          icon: "lock",
          title: "256-bit Encryption",
          description: "Bank-level data protection",
        },
        {
          id: uuidv4(),
          icon: "check-circle",
          title: "GDPR Compliant",
          description: "Full privacy regulation adherence",
        },
        {
          id: uuidv4(),
          icon: "award",
          title: "ISO 27001",
          description: "International security certification",
        },
      ],
      testimonials: [],
      awards: ["G2 Leader 2024", "Product Hunt #1", "Forbes Top 100"],
    },
  },
];

export const createNewSection = (libraryItem) => {
  return {
    id: `section-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
    type: libraryItem.type,
    templateId: libraryItem.id,
    props: JSON.parse(JSON.stringify(libraryItem.defaultProps)),
    style: {
      padding: { top: "4rem", bottom: "4rem" },
      backgroundType: "color",
      backgroundColor: "transparent",
      backgroundGradient: "",
      backgroundImage: "",
      backgroundOverlay: 0,
    },
  };
};

Canvs.jsx:
import { useState } from "react";
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
} from "@dnd-kit/core";
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  verticalListSortingStrategy,
} from "@dnd-kit/sortable";
import { useEditorStore } from "../../../store/store";
import SortableSection from "./SortableSection";
import { Inbox, Menu as MenuIcon, X } from "lucide-react";

export default function Canvas({ selectedTemplate }) {
  const { config, reorderSections, selectSection, selectHeader, selectFooter } =
    useEditorStore();
  const sections = config.layout?.sections || [];
  const themeColors = config.theme?.colors;
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  const sensors = useSensors(
    useSensor(PointerSensor, { activationConstraint: { distance: 8 } }),
    useSensor(KeyboardSensor, { coordinateGetter: sortableKeyboardCoordinates }),
  );

  const handleDragEnd = (event) => {
    const { active, over } = event;
    if (active.id !== over?.id) {
      const oldIndex = sections.findIndex((s) => s.id === active.id);
      const newIndex = sections.findIndex((s) => s.id === over.id);
      reorderSections(arrayMove(sections, oldIndex, newIndex));
    }
  };

  const getHeaderStyle = () => {
    const style = {
      height: config.header?.style?.height || "80px",
      backgroundColor: config.header?.style?.backgroundColor || "#ffffff",
    };
    if (config.header?.style?.sticky) {
      style.position = "sticky";
      style.top = "0";
      style.zIndex = "50";
    }
    style.borderBottom = "1px solid #e5e7eb";
    return style;
  };

  const getFooterStyle = () => ({
    backgroundColor: config.footer?.style?.backgroundColor || "#111827",
    color: config.footer?.style?.textColor || "#ffffff",
    padding: config.footer?.style?.padding || "3rem 0",
  });

  const handleNavClick = (e, url) => {
    e.preventDefault();
    if (url?.startsWith("#")) {
      const el = document.getElementById(url.substring(1));
      if (el) el.scrollIntoView({ behavior: "smooth" });
    }
  };

  return (
    <div className="h-full overflow-y-auto bg-white">
      <div className="w-full">
        {/* ── Header ── */}
        <div
          style={getHeaderStyle()}
          className="cursor-pointer hover:ring-2 hover:ring-indigo-500 transition-all relative"
          onClick={() => selectHeader()}
        >
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex items-center justify-between">
            <div className="flex items-center justify-between w-full">
              {config.header?.props?.logo ? (
                <a href="/" className="flex-shrink-0" onClick={(e) => e.preventDefault()}>
                  <img src={config.header.props.logo} alt="Logo" className="h-10 object-contain" />
                </a>
              ) : (
                <a href="/" className="text-lg font-bold text-gray-900" onClick={(e) => e.preventDefault()}>
                  Logo
                </a>
              )}

              <div className="md:hidden">
                <button
                  onClick={(e) => { e.stopPropagation(); setMobileMenuOpen(!mobileMenuOpen); }}
                  className="p-2 text-gray-700 hover:text-gray-900"
                >
                  {mobileMenuOpen ? <X className="w-6 h-6" /> : <MenuIcon className="w-6 h-6" />}
                </button>
              </div>
            </div>

            <nav className="hidden md:flex items-center gap-8">
              {(config.header?.props?.menu || []).map((item, idx) => (
                <a key={idx} href={item.link || item.url}
                  onClick={(e) => handleNavClick(e, item.link || item.url)}
                  className="text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors">
                  {item.label}
                </a>
              ))}
            </nav>

            <div className="hidden md:flex items-center gap-4">
              {config.header?.props?.ctaButton?.text && (
                <a
                  href={config.header.props.ctaButton.link}
                  onClick={(e) => handleNavClick(e, config.header.props.ctaButton.link)}
                  className="px-6 py-2.5 rounded-lg text-sm font-semibold transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
                  style={{ backgroundColor: themeColors?.primary || "#6366f1", color: "#ffffff" }}
                >
                  {config.header.props.ctaButton.text}
                </a>
              )}
            </div>
          </div>

          {/* Mobile menu */}
          {mobileMenuOpen && (
            <div className="md:hidden absolute top-full left-0 right-0 bg-white shadow-lg border-t border-gray-200 z-50 p-4">
              <div className="flex flex-col space-y-3">
                {(config.header?.props?.menu || []).map((item, idx) => (
                  <a key={idx} href={item.link || item.url}
                    onClick={(e) => handleNavClick(e, item.link || item.url)}
                    className="text-sm font-medium text-gray-700 hover:text-gray-900 py-2 px-4 hover:bg-gray-50 rounded">
                    {item.label}
                  </a>
                ))}
                {config.header?.props?.ctaButton?.text && (
                  <a
                    href={config.header.props.ctaButton.link}
                    className="px-6 py-2.5 rounded-lg text-sm font-semibold text-center"
                    style={{ backgroundColor: themeColors?.primary || "#6366f1", color: "#ffffff" }}
                  >
                    {config.header.props.ctaButton.text}
                  </a>
                )}
              </div>
            </div>
          )}
        </div>

        {/* ── Canvas body ── */}
        {sections.length === 0 ? (
          <div className="h-[500px] flex items-center justify-center bg-gray-50">
            <div className="text-center">
              <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Inbox className="w-8 h-8 text-gray-400" />
              </div>
              <h3 className="text-lg font-semibold text-gray-900 mb-2">Your canvas is empty</h3>
              <p className="text-sm text-gray-500">Add sections from the library or choose a template</p>
              <button
                onClick={() => window.dispatchEvent(new CustomEvent("open-template-modal"))}
                className="mt-4 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
              >
                Choose Template
              </button>
            </div>
          </div>
        ) : (
          <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
            <SortableContext items={sections.map((s) => s.id)} strategy={verticalListSortingStrategy}>
              <div>
                {sections.map((section) => (
                  <div key={section.id} id={section.id}>
                    <SortableSection
                      section={section}
                      onSelect={() => selectSection(section.id)}
                      themeColors={themeColors}
                      selectedTemplate={selectedTemplate}
                    />
                  </div>
                ))}
              </div>
            </SortableContext>
          </DndContext>
        )}

        {/* ── Footer ── */}
        <div
          style={getFooterStyle()}
          className="cursor-pointer hover:ring-2 hover:ring-indigo-500 transition-all"
          onClick={() => selectFooter()}
        >
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className={`grid gap-8 mb-8 ${
              (config.footer?.props?.columns?.length || 0) <= 1 ? "grid-cols-1"
              : (config.footer?.props?.columns?.length || 0) === 2 ? "grid-cols-1 md:grid-cols-2"
              : (config.footer?.props?.columns?.length || 0) === 3 ? "grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
              : "grid-cols-1 md:grid-cols-2 lg:grid-cols-4"
            }`}>
              {(config.footer?.props?.columns || []).map((column, idx) => (
                <div key={idx}>
                  <h4 className="font-semibold mb-4 text-lg">{column.title}</h4>
                  <ul className="space-y-3">
                    {(column.links || []).map((link, lIdx) => (
                      <li key={lIdx}>
                        <a href={link.link || link.url || "#"}
                          onClick={(e) => handleNavClick(e, link.link || link.url || "#")}
                          className="text-sm opacity-80 hover:opacity-100 transition-opacity">
                          {link.label || link.text}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}

              {config.footer?.props?.newsletter && (
                <div className="col-span-full mt-4">
                  <h4 className="font-semibold mb-4 text-lg">{config.footer.props.newsletter.title}</h4>
                  <div className="flex gap-2 max-w-md">
                    <input type="email" placeholder={config.footer.props.newsletter.placeholder}
                      className="flex-1 px-4 py-2 rounded-lg border border-gray-600 bg-transparent text-white placeholder-gray-400 focus:ring-2 focus:ring-indigo-500" />
                    <button
                      className="px-6 py-2 rounded-lg font-medium transition-colors"
                      style={{ backgroundColor: themeColors?.primary || "#6366f1", color: "#ffffff" }}
                    >
                      {config.footer.props.newsletter.buttonText}
                    </button>
                  </div>
                </div>
              )}

              {config.footer?.props?.socialLinks?.length > 0 && (
                <div className="col-span-full mt-4">
                  <div className="flex gap-4">
                    {config.footer.props.socialLinks.map((social, idx) => (
                      <a key={idx} href={social.link} target="_blank" rel="noopener noreferrer"
                        className="opacity-80 hover:opacity-100 transition-opacity text-sm font-medium">
                        {social.platform}
                      </a>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {config.footer?.props?.copyright && (
              <div
                className="pt-6 border-t border-opacity-20 text-center text-sm opacity-70"
                style={{ borderColor: config.footer?.style?.textColor || "#ffffff" }}
              >
                {config.footer.props.copyright}
              </div>
            )}

            {/* CreatorSpace attribution */}
            <div
              className="pt-4 text-center text-xs opacity-40 hover:opacity-70 transition-opacity"
              style={{ borderTop: "1px solid rgba(255,255,255,0.08)", marginTop: "1rem", paddingTop: "1rem" }}
            >
              Made with{" "}
              <a
                href={import.meta.env.VITE_APP_URL || "/"}
                target="_blank"
                rel="noopener noreferrer"
                className="underline underline-offset-2 hover:opacity-100"
                onClick={(e) => e.stopPropagation()}
              >
                CreatorSpace
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

editorStore.js:
import { create } from "zustand";

export const useEditorStore = create((set, get) => ({
  config: {
    template_name: null,
    previewMode: false,
    header: {
      type: "default",
      props: {
        logo: "",
        menu: [],
        ctaButton: { text: "", link: "" },
      },
      style: {
        height: "80px",
        sticky: false,
        backgroundColor: "#ffffff",
      },
    },
    footer: {
      type: "default",
      props: {
        columns: [],
        copyright: "",
      },
      style: {
        backgroundColor: "#111827",
        textColor: "#ffffff",
        padding: "3rem 0",
      },
    },
    layout: {
      sections: [],
    },
    theme: {
      colors: {
        primary: "#6366f1",
        secondary: "#8b5cf6",
        accent: "#ec4899",
        background: "#ffffff",
        text: "#111827",
      },
      fonts: {
        heading: "Inter",
        body: "Inter",
      },
    },
  },
  
  selectedSection: null,
  selectedHeader: false,
  selectedFooter: false,
  selectedBlock: null,
  history: [],
  historyIndex: -1,
  isDirty: false,

  setConfig: (config) => {
    set({ config, isDirty: false });
    get().addToHistory(config);
  },

  updateConfig: (path, value) => {
    const newConfig = { ...get().config };
    const keys = path.split(".");
    let current = newConfig;
    
    for (let i = 0; i < keys.length - 1; i++) {
      if (!current[keys[i]]) current[keys[i]] = {};
      current = current[keys[i]];
    }
    
    current[keys[keys.length - 1]] = value;
    set({ config: newConfig, isDirty: true });
    get().addToHistory(newConfig);
  },

  addSection: (section) => {
    const config = get().config;
    const newConfig = {
      ...config,
      layout: {
        ...config.layout,
        sections: [...config.layout.sections, section],
      },
    };
    set({ config: newConfig, isDirty: true });
    get().addToHistory(newConfig);
  },

  updateSection: (sectionId, updates) => {
    const config = get().config;
    const newConfig = {
      ...config,
      layout: {
        ...config.layout,
        sections: config.layout.sections.map((section) =>
          section.id === sectionId ? { ...section, ...updates } : section
        ),
      },
    };
    set({ config: newConfig, isDirty: true });
    get().addToHistory(newConfig);
  },

  deleteSection: (sectionId) => {
    const config = get().config;
    const newConfig = {
      ...config,
      layout: {
        ...config.layout,
        sections: config.layout.sections.filter((section) => section.id !== sectionId),
      },
    };
    set({ config: newConfig, isDirty: true, selectedSection: null });
    get().addToHistory(newConfig);
  },

  reorderSections: (sections) => {
    const config = get().config;
    const newConfig = {
      ...config,
      layout: {
        ...config.layout,
        sections,
      },
    };
    set({ config: newConfig, isDirty: true });
    get().addToHistory(newConfig);
  },

  selectSection: (sectionId) => {
    set({ selectedSection: sectionId, selectedHeader: false, selectedFooter: false, selectedBlock: null });
  },

  selectHeader: (value = true) => {
    set({ selectedHeader: value, selectedSection: null, selectedFooter: false, selectedBlock: null });
  },

  selectFooter: (value = true) => {
    set({ selectedFooter: value, selectedSection: null, selectedHeader: false, selectedBlock: null });
  },

  selectBlock: (sectionId, blockId) => {
    set({ selectedSection: sectionId, selectedBlock: blockId, selectedHeader: false, selectedFooter: false });
  },

  setTemplate: (templateName) => {
    set((state) => ({
      config: {
        ...state.config,
        template_name: templateName,
      },
      isDirty: true,
    }));
    get().addToHistory({
      ...get().config,
      template_name: templateName,
    });
  },

  addToHistory: (config) => {
    const { history, historyIndex } = get();
    const newHistory = history.slice(0, historyIndex + 1);
    newHistory.push(JSON.parse(JSON.stringify(config)));
    
    if (newHistory.length > 50) {
      newHistory.shift();
    }
    
    set({
      history: newHistory,
      historyIndex: newHistory.length - 1,
    });
  },

  undo: () => {
    const { history, historyIndex } = get();
    if (historyIndex > 0) {
      const newIndex = historyIndex - 1;
      set({
        config: JSON.parse(JSON.stringify(history[newIndex])),
        historyIndex: newIndex,
        isDirty: true,
      });
    }
  },

  redo: () => {
    const { history, historyIndex } = get();
    if (historyIndex < history.length - 1) {
      const newIndex = historyIndex + 1;
      set({
        config: JSON.parse(JSON.stringify(history[newIndex])),
        historyIndex: newIndex,
        isDirty: true,
      });
    }
  },

  canUndo: () => {
    return get().historyIndex > 0;
  },

  canRedo: () => {
    const { history, historyIndex } = get();
    return historyIndex < history.length - 1;
  },

  resetDirty: () => {
    set({ isDirty: false });
  },
}));

themeStore.js:
import { create } from "zustand";
import axiosInstance from "./../../api/axiosInstance";
import { useEffect, useState } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { useEditorStore } from "../store";
import { createNewSection } from "../../utils/sectionLibrary";

export const useThemeStore = create((set, get) => ({
  themes: [],
  currentTheme: null,
  templates: [],
  loading: false,
  error: null,

  fetchThemes: async (websiteId) => {
    set({ loading: true, error: null });
    try {
      const response = await axiosInstance.get(
        `/themes?website_id=${websiteId}`,
      );
      const themes = response.data.data.themes || [];
      set({ themes, loading: false });
      return themes;
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to load themes",
        loading: false,
      });
      throw error;
    }
  },

  fetchTemplates: async () => {
    set({ loading: true, error: null });
    try {
      const response = await axiosInstance.get("/themes/templates");
      const templates = response.data.data.templates || [];
      set({ templates, loading: false });
      return templates;
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to load templates",
        loading: false,
      });
      throw error;
    }
  },

  createTheme: async (data) => {
    set({ loading: true, error: null });
    try {
      const response = await axiosInstance.post("/themes/create", data);
      const newTheme = response.data.data.theme;
      set((state) => ({
        themes: [newTheme, ...state.themes],
        loading: false,
      }));
      return newTheme;
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to create theme",
        loading: false,
      });
      throw error;
    }
  },

  updateTheme: async (themeId, data) => {
    set({ loading: true, error: null });
    try {
      const response = await axiosInstance.put(`/themes/${themeId}`, data);
      const updatedTheme = response.data.data.theme;
      set((state) => ({
        themes: state.themes.map((t) => (t.id === themeId ? updatedTheme : t)),
        currentTheme:
          state.currentTheme?.id === themeId
            ? updatedTheme
            : state.currentTheme,
        loading: false,
      }));
      return updatedTheme;
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to update theme",
        loading: false,
      });
      throw error;
    }
  },

  deleteTheme: async (themeId) => {
    set({ loading: true, error: null });
    try {
      await axiosInstance.delete(`/themes/${themeId}`);
      set((state) => ({
        themes: state.themes.filter((t) => t.id !== themeId),
        currentTheme:
          state.currentTheme?.id === themeId ? null : state.currentTheme,
        loading: false,
      }));
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to delete theme",
        loading: false,
      });
      throw error;
    }
  },

  setActiveTheme: async (themeId, websiteId) => {
    try {
      await axiosInstance.post(`/themes/${themeId}/set-active`, {
        website_id: websiteId,
      });
      set((state) => ({
        themes: state.themes.map((t) => ({
          ...t,
          is_active: t.id === themeId ? 1 : 0,
        })),
      }));
    } catch (error) {
      throw error;
    }
  },

  getTheme: async (themeSlug) => {
    set({ loading: true, error: null });
    try {
      const response = await axiosInstance.get(`/themes/${themeSlug}`);
      const theme = response.data.data.theme;
      set({ currentTheme: theme, loading: false });
      return theme;
    } catch (error) {
      set({
        error: error.response?.data?.message || "Failed to load theme",
        loading: false,
      });
      throw error;
    }
  },

  setCurrentTheme: (theme) => set({ currentTheme: theme }),

  useThemeEditor: () => {
    const { themeSlug } = useParams();
    const navigate = useNavigate();
    const { getTheme, updateTheme, loading, fetchTemplates, templates } = get();
    const {
      config,
      setConfig,
      addSection,
      undo,
      redo,
      canUndo,
      canRedo,
      isDirty,
      resetDirty,
    } = useEditorStore();

    const [theme, setTheme] = useState(null);
    const [saving, setSaving] = useState(false);
    const [showSettings, setShowSettings] = useState(false);
    const [selectedTemplate, setSelectedTemplate] = useState(null);
    const [showTemplateModal, setShowTemplateModal] = useState(false);
    const [isLoading, setIsLoading] = useState(true);
    const [originalSlug, setOriginalSlug] = useState(themeSlug);

    useEffect(() => {
      loadTemplates();
    }, []);

    useEffect(() => {
      loadTheme();
    }, [themeSlug]);

    const loadTemplates = async () => {
      try {
        await fetchTemplates();
      } catch (error) {
        console.error("Failed to load templates:", error);
      }
    };

    const loadTheme = async () => {
      try {
        const themeData = await getTheme(themeSlug);
        setTheme(themeData);
        setOriginalSlug(themeData.slug);

        let configData = themeData.config_json;
        if (typeof configData === "string") {
          configData = JSON.parse(configData);
        }

        setConfig(configData);

        if (configData.template_id) {
          const template = templates.find(
            (t) => t.id === configData.template_id,
          );
          if (template) {
            setSelectedTemplate(template.name);
          }
        }
      } catch (error) {
        console.error("Failed to load theme:", error);
        navigate("/website-builder");
      } finally {
        setIsLoading(false);
      }
    };

    const handleSave = async () => {
      setSaving(true);
      try {
        const template = templates.find((t) => t.name === selectedTemplate);
        const updatedConfig = {
          ...config,
          template_id: template?.id || null,
          template_name: selectedTemplate,
        };

        const response = await updateTheme(theme.id, {
          config_json: JSON.stringify(updatedConfig),
          name: theme.name,
        });

        setConfig(updatedConfig);
        resetDirty();

        return response;
      } catch (error) {
        console.error("Failed to save theme:", error);
        throw error;
      } finally {
        setSaving(false);
      }
    };

    const handleAddSection = (libraryItem) => {
      const newSection = createNewSection(libraryItem);
      addSection(newSection);
    };

    const handlePreview = () => {
      const template = templates.find((t) => t.name === selectedTemplate);
      const currentConfig = {
        ...config,
        template_id: template?.id || null,
        template_name: selectedTemplate,
        previewMode: true,
      };

      useEditorStore.getState().setConfig(currentConfig);

      if (isDirty) {
        if (confirm("You have unsaved changes. Save before previewing?")) {
          handleSave().then(() => {
            window.open(
              `${import.meta.env.VITE_APP_URL}/t/${theme.slug}?preview=true`,
              "_blank",
            );
          });
        } else {
          window.open(
            `${import.meta.env.VITE_APP_URL}/t/${theme.slug}?preview=true`,
            "_blank",
          );
        }
      } else {
        window.open(
          `${import.meta.env.VITE_APP_URL}/t/${theme.slug}?preview=true`,
          "_blank",
        );
      }
    };

    const handleClose = () => {
      if (isDirty) {
        if (
          confirm("You have unsaved changes. Are you sure you want to leave?")
        ) {
          navigate("/website-builder");
        }
      } else {
        navigate("/website-builder");
      }
    };

    const applyTemplate = (templateId) => {
      const template = templates.find((t) => t.id === templateId);
      if (!template) {
        console.error("Template not found:", templateId);
        return;
      }

      if (config.layout.sections.length > 0) {
        if (
          !confirm(
            "Applying a new template will replace your current layout. Continue?",
          )
        ) {
          return;
        }
      }

      setSelectedTemplate(template.name);
      setShowTemplateModal(false);

      // Parse the base_config_json if it's a string
      const baseConfig =
        typeof template.base_config_json === "string"
          ? JSON.parse(template.base_config_json)
          : template.base_config_json;

      // Create new config with template structure
      const newConfig = {
        ...config,
        template_id: template.id,
        template_name: template.name,
        header: baseConfig.header || config.header,
        footer: baseConfig.footer || config.footer,
        layout: {
          sections: baseConfig.layout?.sections || [],
        },
        theme: baseConfig.theme || config.theme,
      };

      // Update the editor store
      useEditorStore.getState().setConfig(newConfig);
      useEditorStore.getState().resetDirty();

      // Also update the local state if needed
      setConfig(newConfig);
    };

    const handleThemeChange = (updatedTheme) => {
      setTheme(updatedTheme);
    };

    return {
      theme,
      config,
      saving,
      loading,
      isLoading,
      isDirty,
      selectedTemplate,
      showSettings,
      showTemplateModal,
      canUndo: canUndo(),
      canRedo: canRedo(),
      originalSlug,
      templates,
      setShowSettings,
      setShowTemplateModal,
      handleSave,
      handleAddSection,
      handlePreview,
      handleClose,
      applyTemplate,
      handleThemeChange,
      undo,
      redo,
    };
  },
}));


Prompt:
this si not complete, i want the header should come from the SectionLibrary Not pre create in the canvas
 the header i can choose maybe i want logo or not and i can choose the posiiton of the nav and  footer to i can allow logo or Not
 and the header  i can make it transparent and blur u get like modern once
 and also the header nav can have sub nav u get and also search also u have to position it well,  some need  icon to make it responsive
  and remove the watch demo in the hero it is static i wanr evetyhing to be dynamic here everything from the PropertiesPanel
  and also the form where will it submit to? like newletter or contact form,etc i need to  set where it will be submitted to or it will accept  submission.
  and also create a place enviromental  variable where they can set url and can use it u get 
  and also they can choose to have start loader  u get they  can set picture or svg or spinner u get and color
  and also don;t set static color for anything i must be able to control it in the PropertiesPanel